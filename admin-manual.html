
<!DOCTYPE html>


<html lang="fr" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Manuel administrateur &#8212; Documentation GeoNature 2.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=94f178cf"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/translations.js?v=041d0952"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'admin-manual';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Développement" href="development.html" />
    <link rel="prev" title="Manuel utilisateur" href="user-manual.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="2.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/LogoGeonature.jpg" class="logo__image only-light" alt="Documentation GeoNature 2.0 - Home"/>
    <img src="_static/LogoGeonature.jpg" class="logo__image only-dark pst-js-only" alt="Documentation GeoNature 2.0 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PnX-SI/GeoNature" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">Manuel utilisateur</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Manuel administrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Développement</a></li>

<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Auteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-references.html">API REFERENCES</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Dépôt source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature/blob/master/docs/admin-manual.rst?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/admin-manual.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Manuel administrateur</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture">Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#base-de-donnees">Base de données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#administration-avec-alembic">Administration avec Alembic</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#description-des-branches">Description des branches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-droits">Gestion des droits</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-a-geonature-et-cruved">Accès à GeoNature et CRUVED</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cas-particulier-de-l-action-c">Cas particulier de l’action « C »</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-d-administrateur">Permissions d’administrateur</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recapitulatif">Récapitulatif</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nomenclatures">Nomenclatures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metadonnees">Métadonnées</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#donnees-sig">Données SIG</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#profils-de-taxons">Profils de taxons</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-et-parametrage">Configuration et paramétrage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calcul-des-phenologies">Calcul des phénologies</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fonctions">Fonctions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tables-transversales">Tables transversales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triggers-vers-la-synthese">Triggers vers la synthèse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triggers-dans-la-synthese">Triggers dans la synthèse</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularite">Modularité</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-generale-de-l-application">Configuration générale de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-d-un-gn-module">Configuration d’un gn_module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploitation">Exploitation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logs">Logs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commandes-geonature">Commandes GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demarrer-arreter-les-api">Démarrer / arrêter les API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervision-des-services">Supervision des services</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maintenance">Maintenance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametres-gunicorn">Paramètres Gunicorn</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sauvegarde-et-restauration">Sauvegarde et restauration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sauvegarde">Sauvegarde</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restauration">Restauration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customisation">Customisation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrer-son-logo">Intégrer son logo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-le-contenu">Customiser le contenu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-la-page-de-connexion">Customiser la page de connexion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-l-aspect-esthetique">Customiser l’aspect esthétique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-les-noms-et-pictos-des-modules">Customiser les noms et pictos des modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-les-exports-pdf">Customiser les exports PDF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrer-des-donnees">Intégrer des données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referentiel-geographique">Référentiel géographique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#affichage-des-referentiels-geographiques-dans-geonature">Affichage des référentiels géographiques dans GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#donnees-externes">Données externes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-niveau-1">IMPORT NIVEAU 1</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#importer-la-donnee-source-dans-la-bdd-avec-qgis">Importer la donnée source dans la BDD avec QGIS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-les-metadonnees">Créer les métadonnées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#insertion-des-donnees-dans-la-synthese">Insertion des données dans la Synthèse</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#insertion-depuis-un-shapefile">Insertion depuis un shapefile</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-niveau-2">IMPORT NIVEAU 2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-du-fichier-csv">1 - Import du fichier CSV</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-de-la-nouvelle-table-contenant-les-donnees-importees">2 - Préparation de la nouvelle table contenant les données importées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-des-metadonnees">3 - Création des métadonnées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-du-mapping-source-cible">4 - Création du mapping (source –&gt; cible)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#construire-la-requete-d-import">5 - Construire la requête d’import</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#chargement-des-donnees-dans-la-table-de-destination-synthese-ici">6 - Chargement des données dans la table de destination (synthese ici)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#deplacement-de-la-table-importee-facultatif">7 - Déplacement de la table importée (facultatif)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#resultat-final">RESULTAT FINAL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authentification">Authentification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demande-de-creation-de-compte">Demande de création de compte</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#customisation-du-formulaire">Customisation du formulaire</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#espace-utilisateur">Espace utilisateur</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-public">Accès public</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-public-automatique">Accès public automatique</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-la-sensibilite">Gestion de la sensibilité</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criteres-de-sensibilite">Critères de sensibilité</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#niveaux-de-sensibilite">Niveaux de sensibilité</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-plus-d-informations">Pour plus d’informations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-dans-geonature">Intégration dans GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stockage-des-regles-en-base">Stockage des règles en base</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution-aux-observations-de-la-synthese">Attribution aux observations de la synthèse</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-du-referentiel">Gestion du référentiel</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnalisation">Personnalisation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#traitement-des-problematiques-lies-aux-zonages">Traitement des problématiques liés aux zonages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-occtax">Module OCCTAX</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installer-le-module">Installer le module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module">Configuration du module</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#afficher-masquer-des-champs-du-formulaire">Afficher/masquer des champs du formulaire</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modifier-le-champ-observateurs">Modifier le champ Observateurs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module">Personnaliser la liste des taxons et habitats saisissables dans le module</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gerer-les-valeurs-par-defaut-des-nomenclatures">Gérer les valeurs par défaut des nomenclatures</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnaliser-l-interface-map-list">Personnaliser l’interface Map-list</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte">Ajouter une contrainte d’échelle de saisie sur la carte</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supprimer-le-remplissage-automatique-de-la-date">Supprimer le remplissage automatique de la date</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-exports">Gestion des exports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attribuer-des-permissions">Attribuer des permissions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dupliquer-le-module-occtax">Dupliquer le module Occtax</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#associer-des-jeux-de-donnees-et-des-champs-additionnels">Associer des jeux de données et des champs additionnels</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes">Ajouter le nouveau module dans la liste des modules implémentés</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-admin">Module Admin</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#administration-des-champs-additionnels">Administration des champs additionnels</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee-des-champs">Configuration avancée des champs</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taxhub">TaxHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-occhab">Module OCCHAB</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Installer le module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Base de données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#formulaire">Formulaire</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-synthese">Module SYNTHESE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-validation">Module VALIDATION</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#liste-des-champs-visibles">Liste des champs visibles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#e-mail">E-mail</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-automatique">Validation automatique</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#activation">Activation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions-de-validation-automatique">Conditions de validation automatique</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-de-la-periodicite-de-la-validation-automatique">Modification de la périodicité de la validation automatique</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-de-la-fonction-de-validation-automatique">Modification de la fonction de validation automatique</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-taxhub">Module TaxHub</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-permissions">Gestion des permissions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commandes-taxhub">Commandes TaxHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-import">Module Import</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts">Concepts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#faire-un-import-le-minimum-requis">Faire un import, le minimum requis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deroulement-dun-import">Déroulement d’un import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module-dimport">Configuration du module d’import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-de-limport">Permissions de l’import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-et-suppression-d-un-import">Modification et Suppression d’un import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controles-de-donnees">Contrôles de données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee">Configuration avancée</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature">Contrôle de données dans les destinations venant avec GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modele-de-donnees">Modèle de données</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="manuel-administrateur">
<h1>Manuel administrateur<a class="headerlink" href="#manuel-administrateur" title="Lien vers cette rubrique">#</a></h1>
<section id="architecture">
<h2>Architecture<a class="headerlink" href="#architecture" title="Lien vers cette rubrique">#</a></h2>
<p>GeoNature possède une architecture modulaire et s’appuie sur plusieurs « services » indépendants pour fonctionner :</p>
<ul class="simple">
<li><p>UsersHub et son sous-module d’authentification Flask (<a class="github reference external" href="https://github.com/PnX-SI/UsersHub-authentification-module">PnX-SI/UsersHub-authentification-module</a>) sont utilisés pour gérer le schéma de BDD <code class="docutils literal notranslate"><span class="pre">ref_users</span></code> (actuellement nommé <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>) et l’authentification. UsersHub permet une gestion centralisée de ses utilisateurs (listes, organismes, applications), utilisable par les différentes applications de son système d’informations.</p></li>
<li><p>TaxHub (<a class="github reference external" href="https://github.com/PnX-SI/TaxHub">PnX-SI/TaxHub</a>) est utilisé pour la gestion du schéma de BDD <code class="docutils literal notranslate"><span class="pre">ref_taxonomy</span></code> (actuellement nommé <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>). L’API de TaxHub est utilisée pour récupérer des informations sur les espèces et la taxonomie en général. TaxHub est intégré à GeoNature depuis sa version 2.15.</p></li>
<li><p>Un sous-module Flask (<a class="github reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">PnX-SI/Nomenclature-api-module</a>) a été créé pour une gestion centralisée des nomenclatures (<a class="github reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">PnX-SI/Nomenclature-api-module</a>), il pilote le schéma <code class="docutils literal notranslate"><span class="pre">ref_nomenclature</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> est le schéma de base de données qui gère le référentiel géographique. Il est utilisé pour gérer les zonages, les communes, le MNT, le calcul automatique d’altitude et les intersections spatiales.</p></li>
</ul>
<p>GeoNature a également une séparation claire entre le backend (API: intéraction avec la base de données) et le frontend (interface utilisateur). Le backend peut être considéré comme un « service » dont se sert le frontend pour récupérer ou poster des données.
NB : Le backend et le frontend se lancent séparément dans GeoNature.</p>
<img alt="_images/design-geonature.png" src="_images/design-geonature.png" />
</section>
<section id="base-de-donnees">
<h2>Base de données<a class="headerlink" href="#base-de-donnees" title="Lien vers cette rubrique">#</a></h2>
<p>Dans la continuité de sa version 1, GeoNature V2 utilise le SGBD PostgreSQL et sa cartouche spatiale PostGIS. Cependant l’architecture du modèle de données a été complétement revue.</p>
<p>La base de données a notamment été refondue pour s’appuyer au maximum sur des standards, comme le standard d’Occurrences de taxons du SINP (Voir <a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/occurrences-de-taxons/">http://standards-sinp.mnhn.fr/category/standards/occurrences-de-taxons/</a>).</p>
<p>La base de données a également été traduite en Anglais et supporte désormais le multilangue.</p>
<p>Les préfixes des schémas de BDD sont désormais standardisés : <code class="docutils literal notranslate"><span class="pre">ref_</span></code> concerne les référentiels externes, <code class="docutils literal notranslate"><span class="pre">gn_</span></code> concerne les schémas du coeur de GeoNature et <code class="docutils literal notranslate"><span class="pre">pr_</span></code> les schémas des protocoles.</p>
<p>Autres standards :</p>
<ul class="simple">
<li><p>Noms de tables, commentaires et fonctions en anglais</p></li>
<li><p>Pas de nom de table dans les noms de champs</p></li>
<li><p>Nom de schema éventuellement dans nom de table</p></li>
</ul>
<p>Schéma simplifié de la BDD :</p>
<img alt="http://geonature.fr/docs/img/admin-manual/GN-schema-BDD.jpg" src="http://geonature.fr/docs/img/admin-manual/GN-schema-BDD.jpg" />
<ul class="simple">
<li><p>En jaune, les schémas des réferentiels.</p></li>
<li><p>En rose, les schémas du coeur de GeoNature</p></li>
<li><p>En bleu, les schémas des protocoles et sources de données</p></li>
<li><p>En vert, les schémas des applications pouvant interagir avec le coeur de GeoNature</p></li>
</ul>
<p>Depuis la version 2.0.0-rc.4, il faut noter que les permissions (CRUVED) ont été retirées du schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> (<code class="docutils literal notranslate"><span class="pre">ref_users</span></code>) de UsersHub pour l’intégrer dans GeoNature dans un schéma <code class="docutils literal notranslate"><span class="pre">gn_permissions</span></code>, à ajouter en rose.</p>
<p>Modèle simplifié de la BDD (2017-12-15) :</p>
<img alt="_images/2017-12-15-GN2-MCD-simplifie.jpg" src="_images/2017-12-15-GN2-MCD-simplifie.jpg" />
<p>Dernière version complète de la base de données (GeoNature 2.1 / 2019-08) :</p>
<img alt="_images/2019-08-GN2-1-MCD.png" src="_images/2019-08-GN2-1-MCD.png" />
<p>Les relations complexes entre les schémas ont été grisées pour faciliter la lisibilité.</p>
<section id="administration-avec-alembic">
<h3>Administration avec Alembic<a class="headerlink" href="#administration-avec-alembic" title="Lien vers cette rubrique">#</a></h3>
<p>À partir de la version 2.7.5 de GeoNature, la gestion du schéma de la base de données se fait avec l’outil <a class="reference external" href="https://alembic.sqlalchemy.org/en/latest/">Alembic</a>.
Celui-ci fonctionne grâce à des fichiers de migration qui sont appliqués de manière atomique (via une transaction) à la base de données, leur application étant enregistré dans la table <code class="docutils literal notranslate"><span class="pre">public.alembic_version</span></code> permettant en chaque instant de savoir dans quel état la base de données se trouve.</p>
<p>Les fichiers de migrations de GeoNature se trouve dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/geonature/migrations/versions/</span></code>.
Il est possible pour n’importe quelle dépendance ou module GeoNature de fournir également des fichiers de migrations. Pour que ceux-ci soient détectés par Alembic, il suffira de définir un point d’entrée dans le <code class="docutils literal notranslate"><span class="pre">setup.py</span></code> de la dépendance ou du module concerné :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>setuptools.setup(
    …,
    entry_points={
        &#39;alembic&#39;: [
            &#39;migrations = my_module:migrations&#39;,
        ],
    },
    …
)
</pre></div>
</div>
<p>Il est également possible de spécifier l’emplacement de révisions Alembic manuellement dans la configuration de GeoNature. Cela est nécessaire entre autre pour UsersHub afin de pouvoir manipuler son schéma alors que UsersHub n’est usuellement pas installé dans le venv de GeoNature (seul UsersHub-authentification-module l’est) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ALEMBIC</span><span class="p">]</span>
<span class="n">VERSION_LOCATIONS</span> <span class="o">=</span> <span class="s1">&#39;/path/to/usershub/app/migrations/versions&#39;</span>
</pre></div>
</div>
<p>Chaque fichier de migration est caractérisé par :</p>
<ul class="simple">
<li><p>un identifiant, <cite>e.g.</cite> <code class="docutils literal notranslate"><span class="pre">f06cc80cc8ba</span></code></p></li>
<li><p>une branche : Les branches permettent de séparer les fichiers de migrations afin de pouvoir les appliquer séparément. Par exemple, pour un déploiement de TaxHub sans GeoNature, il peut être intéressant de créer le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> sans créer les schémas de GeoNature, et ainsi gérer indépendamment les migrations de chaque schéma.</p></li>
<li><p>un ancêtre : Lorsqu’un fichier de migration représente l’évolution d’un état antérieur de la base de données, l’ancêtre indique dans quelle version la base de données doit se trouver avant d’appliquer le-dis fichier de migration.</p></li>
<li><p>des dépendances : Il est possible d’indiquer qu’une migration nécessite qu’une ou plusieurs autres migrations aient été préalablement appliquées. Par exemple, ceci permet d’indiquer que le schéma de GeoNature nécessite les schémas <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>.</p></li>
</ul>
<p>Les commandes Alembic sont disponibles grâce à la sous-commande <code class="docutils literal notranslate"><span class="pre">db</span></code> de la commande <code class="docutils literal notranslate"><span class="pre">geonature</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db --help
</pre></div>
</div>
<p>Les deux sous-commandes <code class="docutils literal notranslate"><span class="pre">status</span></code> et <code class="docutils literal notranslate"><span class="pre">autoupgrade</span></code> sont spécifiques à GeoNature afin d’aider à l’utilisation d’Alembic.</p>
<p>La commande <code class="docutils literal notranslate"><span class="pre">status</span></code> permet de visualiser les branches et l’ensemble de leurs révisions.
Pour chaque révision est indiqué si celle-ci est appliquée à la base de données.
Si une branche a au moins sa première révision d’appliquée, alors un petit symbole indique si cette branche est à jour, c’est-à-dire si toutes les révisions de la branche ont été appliquées (<code class="docutils literal notranslate"><span class="pre">✓</span></code>) ou si la branche est en retard, c’est-à-dire que celle-ci contient des révisions qui ne sont pas encore appliquées à la base de données (<code class="docutils literal notranslate"><span class="pre">×</span></code>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[geonature ✓]
  [x] ┰ f06cc80cc8ba geonature schemas 2.7.5
  [x] ┃ c0fdf2ee7f4f auto update cor_area_synthese
  [x] ┃ 7077aa76da3d bump dependencies
  [x] ┃ 2a2e5c519fd1 fix gn_synthese.get_default_nomenclature_value
  [x] ┃ 5f4c4b644844 delete cascade on  cor_dataset_territory and cor_dataset_protocol
  [x] ┃ 2aa558b1be3a add schema gn_profiles
  [x] ┃ 1eb624249f2b add default value in additionalFields bib
  [x] ┃ 7471f51011c8 change index_vm_valid_profiles_cd_ref to unique index
  [x] ┃ 9a9f4971edcd fix altitude trigger
  [x] ┃ 6f7d5549d49e delete view v_synthese_validation_forwebapp
  [x] ┣┓ dde31e76ce45 remove old profile function
  [x]  ┃ 61e46813d621 Update synthese sensitivity
  [x]  ┃ dfec5f64ac73 Fix sensitivity algorithm
  [x]  ┃ ac08dcf3f27b Do not auto-compute diffusion_level
  [x] ┃ 30edd97ae582 Remove gn_export.t_config_exports
  [x] ┗┛ 1dbc45309d6e Merge sensitivity
[geonature-samples ✓]
  [x] ─ 3d0bf4ee67d1 geonature samples
[habitats ✓]
  [x] ─ 62e63cd6135d create ref_habitats schema
[habitats_inpn_data ✓]
  [x] ┰ 46e91e738845 insert inpn data in ref_habitats schema
  [x] ┸ 805442837a68 correction on habref data
[ign_bd_alti ✓]
  [x] ─ 1715cf31a75d Insert default French DEM (IGN 250m BD alti)
[ign_bd_alti_vector]
  [ ] ─ 87651375c2e8 Vectorize French DEM
[nomenclatures ✓]
  [x] ┰ 6015397d686a create ref_nomenclature schema 1.3.9
  [x] ┃ 11e7741319fd fix ref_nomenclatures.get_default_nomenclature_value
  [x] ┃ f8c2c8482419 fix ref_nomenclatures.get_default_nomenclature_value
  [x] ┸ b820c66d8daa fix ref_nomenclatures.get_nomenclature_label
[nomenclatures_inpn_data ✓]
  [x] ─ 96a713739fdd insert inpn data in ref_nomenclatures
[nomenclatures_taxonomie ✓]
  [x] ─ f5436084bf17 add support for taxonomy into ref_nomenclatures
[nomenclatures_taxonomie_inpn_data ✓]
  [x] ─ a763fb554ff2 insert taxonomic inpn data in ref_nomenclatures
[occhab ✓]
  [x] ─ 2984569d5df6 create occhab schema
[occhab-samples]
  [ ] ─ 21f661247023 insert occhab sample data
[occtax ✓]
  [x] ┰ 29c199e07eaa create occtax schema
  [x] ┃ addb71d8efad create occtax export view
  [x] ┃ f57107d2d0ad fix get_default_nomenclature_value
  [x] ┃ 494cb2245a43 trigger comportement
  [x] ┸ 944072911ff7 update synthese data (bug occtax trigger)
[occtax-samples ✓]
  [x] ─ cce08a64eb4f insert occtax sample data
[occtax-samples-test]
  [ ] ─ 2a0ab7644e1c occtax sample test
[ref_geo ✓]
  [x] ┰ 6afe74833ed0 ref_geo schema
  [x] ┃ e0ac4c9f5c0a add indexes on FK referencing l_areas.id_area
  [x] ┸ 4882d6141a41 add regions in area types
[ref_geo_fr_departments ✓]
  [x] ─ 3fdaa1805575 Insert French departments in ref_geo
[ref_geo_fr_municipalities ✓]
  [x] ─ 0dfdbfbccd63 Insert French municipalities in ref_geo
[ref_geo_fr_regions ✓]
  [x] ─ d02f4563bebe Insert French regions in ref_geo
[ref_geo_fr_regions_1970 ✓]
  [x] ─ 05a0ae652c13 Insert French regions 1970-2016 in ref_geo
[ref_geo_inpn_grids_1 ✓]
  [x] ─ 586613e2faeb Insert INPN 1×1 grids in ref_geo
[ref_geo_inpn_grids_10 ✓]
  [x] ─ ede150d9afd9 Insert INPN 10×10 grids in ref_geo
[ref_geo_inpn_grids_5 ✓]
  [x] ─ 7d6e98441e4c Insert INPN 5×5 grids in ref_geo
[ref_sensitivity_inpn ✓]
  [x] ─ 7dfd0a813f86 Insert INPN rules in sensitivity referential
[sql_utils ✓]
  [x] ─ 3842a6d800a0 Add public shared functions
[taxhub ✓]
  [x] ─ fa5a90853c45 taxhub
[taxhub-admin ✓]
  [x] ─ 3fe8c07741be taxhub
[taxonomie ✓]
  [x] ┰ 9c2c0254aadc create taxonomie schema version 1.8.1
  [x] ┃ 7540702c6407 cd_ref utility functions
  [x] ┃ 98035939bc0d find_all_taxons_parents
  [x] ┃ c93cbb35cfe4 set default value for id_liste
  [x] ┸ 4fb7e197d241 create taxonomie.v_bdc_status view
[taxonomie_attributes_example]
  [ ] ─ aa7533601e41 add attributes exemple to taxonomie
[taxonomie_inpn_data ✓]
  [x] ─ f61f95136ec3 insert inpn data in taxonomie schema
[taxonomie_taxons_example]
  [ ] ─ 8222017dc3f6 add taxons exemple to taxonomie
[usershub ✓]
  [x] ┰ 9445a69f2bed UsersHub
  [x] ┸ 6ec215fe023e upgrade utilisateurs schema
[usershub-samples ✓]
  [x] ─ f63a8f44c969 UsersHub samples data
[utilisateurs ✓]
  [x] ┰ fa35dfe5ff27 utilisateurs schema 1.4.7 (usershub 2.1.3)
  [x] ┃ 830cc8f4daef add additional_data field to bib_organismes
  [x] ┃ 5b334b77f5f5 fix v_roleslist_forall_applications
  [x] ┃ 951b8270a1cf add unique constraint on bib_organismes.uuid_organisme
  [x] ┸ 10e87bc144cd get_id_role_by_name()
[utilisateurs-samples ✓]
  [x] ─ 72f227e37bdf utilisateurs sample data
</pre></div>
</div>
<p>La commande <code class="docutils literal notranslate"><span class="pre">autoupgrade</span></code> permet de mettre automatiquement à jour toutes les branches dont au moins une révision est appliquée lorsque celles-ci possèdent une ou plusieurs révisions non appliquées.
Cette commande est appelée par le script <code class="docutils literal notranslate"><span class="pre">migration.sh</span></code> lors d’une mise à jour de la base de données.
Elle accepte également les paramètres <code class="docutils literal notranslate"><span class="pre">-x</span></code> qui sont alors fournis à la commande <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> lorsque appelée sur chaque branche en retard.</p>
<p>La commande <code class="docutils literal notranslate"><span class="pre">heads</span></code> permet de lister l’ensemble des branches disponibles, ainsi que la dernière révision disponible pour chaque branche :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db heads
e0ac4c9f5c0a (ref_geo) (effective head)
7077aa76da3d (geonature) (head)
586613e2faeb (ref_geo_inpn_grids_1) (head)
1715cf31a75d (ign_bd_alti) (effective head)
3d0bf4ee67d1 (geonature-samples) (head)
0dfdbfbccd63 (ref_geo_fr_municipalities) (head)
7d6e98441e4c (ref_geo_inpn_grids_5) (head)
87651375c2e8 (ign_bd_alti_vector) (head)
3fdaa1805575 (ref_geo_fr_departments) (effective head)
ede150d9afd9 (ref_geo_inpn_grids_10) (head)
3842a6d800a0 (sql_utils) (effective head)
951b8270a1cf (utilisateurs) (effective head)
72f227e37bdf (utilisateurs-samples) (effective head)
f5436084bf17 (nomenclatures_taxonomie) (effective head)
6015397d686a (nomenclatures) (effective head)
96a713739fdd (nomenclatures_inpn_data) (effective head)
a763fb554ff2 (nomenclatures_taxonomie_inpn_data) (effective head)
4fb7e197d241 (taxonomie) (effective head)
aa7533601e41 (taxonomie_attributes_example) (head)
3fe8c07741be (taxhub-admin) (head)
8222017dc3f6 (taxonomie_taxons_example) (head)
f61f95136ec3 (taxonomie_inpn_data) (effective head)
fa5a90853c45 (taxhub) (effective head)
46e91e738845 (habitats_inpn_data) (effective head)
62e63cd6135d (habitats) (effective head)
</pre></div>
</div>
<p>La commande <code class="docutils literal notranslate"><span class="pre">history</span></code> permet de lister l’ensemble de fichier de révisions. Il est également possible de lister les révisions devant être appliquées pour passer d’un état à un autre. Par exemple, voici la liste des révisions à appliquer pour passer d’une base de données vierge (<code class="docutils literal notranslate"><span class="pre">base</span></code>) à une base avec la branche <code class="docutils literal notranslate"><span class="pre">nomenclatures_inpn_data</span></code> à jour (<code class="docutils literal notranslate"><span class="pre">head</span></code>) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db history -r base:nomenclatures_inpn_data@head
&lt;base&gt; (6015397d686a) -&gt; 96a713739fdd (nomenclatures_inpn_data) (effective head), insert inpn data in ref_nomenclatures
&lt;base&gt; (fa35dfe5ff27, 3842a6d800a0) -&gt; 6015397d686a (nomenclatures) (effective head), create ref_nomenclature schema 1.3.9
&lt;base&gt; -&gt; 3842a6d800a0 (sql_utils) (effective head), Add public shared functions
&lt;base&gt; -&gt; fa35dfe5ff27 (utilisateurs), utilisateurs schema 1.4.7 (usershub 2.1.3)
</pre></div>
</div>
<p>Si vous avez déjà une base de données existante correspondant à une installation de GeoNature en version 2.7.5 et que vous passez à Alembic, vous pouvez l’indiquer grâce à la commande suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db stamp f06cc80cc8ba
</pre></div>
</div>
<p>Il est possible que votre base de données contienne quelques données supplémentaires (référentiel géographique des communes, …), qu’il faut donc indiquer à Alembic aussi.
Reportez-vous aux notes de versions de la release 2.8.0 de GeoNature afin de consulter la liste des révisions à éventuellement « <cite>stamper</cite> ».</p>
<p>Vous pouvez demander à Alembic dans quel état se trouve votre base de données avec la commande <code class="docutils literal notranslate"><span class="pre">current</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db current
62e63cd6135d (effective head)
f06cc80cc8ba
3842a6d800a0 (effective head)
9c2c0254aadc
72f227e37bdf (effective head)
fa35dfe5ff27
6015397d686a (effective head)
6afe74833ed0
a763fb554ff2 (effective head)
f5436084bf17 (effective head)
46e91e738845 (effective head)
f61f95136ec3 (effective head)
96a713739fdd (effective head)
</pre></div>
</div>
<p>La liste obtenue contient, pour chaque branche, la dernière migration appliquée.
Notons toutefois que Alembic ne stocke pas l’ensemble de cette liste dans la table <code class="docutils literal notranslate"><span class="pre">public.alembic_revision</span></code>, mais se restreint uniquement aux migrations dont l’application ne peut être déduit des indications de dépendances.</p>
<p>Il est possible de n’afficher que les informations liées à une révision avec la commande <code class="docutils literal notranslate"><span class="pre">show</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db show f06cc80cc8ba
Rev: f06cc80cc8ba
Parent: &lt;base&gt;
Also depends on: 72f227e37bdf, a763fb554ff2, 46e91e738845, 6afe74833ed0
Branch names: geonature
Path: backend/geonature/migrations/versions/f06cc80cc8ba_2_7_5.py

    geonature schemas 2.7.5

    Revision ID: f06cc80cc8ba
    Create Date: 2021-08-10 14:23:55.144250
</pre></div>
</div>
<p>L’absence de l’indication <code class="docutils literal notranslate"><span class="pre">(head)</span></code> à côté du numéro de révision indique qu’il ne s’agit pas de la dernière révision disponible pour la branche <code class="docutils literal notranslate"><span class="pre">geonature</span></code>.
Vous pouvez alors mettre à jour cette branche avec la commande <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db upgrade geonature@head
</pre></div>
</div>
<p>Il est possible de monter des branches optionnelles pour, par exemple, bénéficier des mailles 10×10 dans son référentiel géographique :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db upgrade ref_geo_inpn_grids_10@head -x data-directory=./tmp_geo
</pre></div>
</div>
<p>L’ensemble des branches disponibles est décrit dans la sous-section ci-après.</p>
<p>L’argument <code class="docutils literal notranslate"><span class="pre">-x</span></code> permet de fournir des variables à usage des fichiers de migrations. Dans le cas des migrations de données de zones géographiques, celles-ci supporte la variable <code class="docutils literal notranslate"><span class="pre">data-directory</span></code> permettant de spécifier où doivent être cherchées et éventuellement téléchargées les données géographiques. Si l’argument n’est pas spécifié, un dossier temporaire, supprimé à la fin de la procédure, sera utilisé.</p>
<p>Pour supprimer les mailles 10×10 de son référentiel géographique, on utilisera :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db downgrade ref_geo_inpn_grids_10@base
</pre></div>
</div>
<p>Dans le cas d’une branche contenant plusieurs migrations, on pourra appliquer ou désappliquer chaque migration individuellement avec <code class="docutils literal notranslate"><span class="pre">upgrade</span> <span class="pre">branch&#64;+1</span></code> ou <code class="docutils literal notranslate"><span class="pre">downgrade</span> <span class="pre">branch&#64;-1</span></code>. Il est également possible de référencer directement un numéro de migration.</p>
<p>Si l’on souhaite appliquer une migration manuellement, ou si l’on souhaite la modifier, il est possible de passer l’argument <code class="docutils literal notranslate"><span class="pre">--sql</span></code> aux commandes <code class="docutils literal notranslate"><span class="pre">upgrade</span></code> et <code class="docutils literal notranslate"><span class="pre">downgrade</span></code> afin de récupérer le code SQL de la migration. Cela ne fonctionne toutefois pas avec certaines migrations telles que les migrations de données géographiques, en raison d’import SQL nécessitant de manipuler directement le curseur SQLAlchemy.</p>
<p>Pour créer un nouveau fichier de migration afin d’y placer ses évolutions de la base de données, on utilisera la commande suivante :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db revision -m &quot;add table gn_commons.t_foo&quot; --head geonature@head
  Generating […]/backend/geonature/migrations/versions/31250092bce3_add_table_gn_commons_t_foo.py ...  done
</pre></div>
</div>
<p>La <a class="reference external" href="https://alembic.sqlalchemy.org/en/latest/ops.html">documentation d’Alembic</a> liste les opérations prises en charge.
Certaines opérations complexes telles que la création de trigger ne sont pas prévues, mais il reste toujours possible d’exécuter du SQL directement avec l’opérateur <code class="docutils literal notranslate"><span class="pre">op.execute</span></code>.</p>
<section id="description-des-branches">
<h4>Description des branches<a class="headerlink" href="#description-des-branches" title="Lien vers cette rubrique">#</a></h4>
<p>Cette section liste les branches Alembic disponibles et leur impact sur la base de données.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">sql_utils</span></code> : Fournit quelques fonctions SQl utilitaires dans le schéma <code class="docutils literal notranslate"><span class="pre">public</span></code>. Fourni par Utils-Flask-SQLAlchemy.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span></code> : Créé les schémas propres à GeoNature (<code class="docutils literal notranslate"><span class="pre">gn_commons</span></code>, <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code>, …).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature-samples</span></code> : Insère quelques données d’exemple en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> : Créé le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>. Fournie par TaxHub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures</span></code> : Crée le schéma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code>. Fourni par Nomenclature-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_inpn_data</span></code> : Insère le référentiel des nomenclatures de l’INPN en base. Fourni par Nomenclature-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_taxonomie</span></code> : Complète le schéma <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures</span></code> pour accueillir les nomenclatures liées à la taxonomie.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">nomenclatures_taxonomie_inpn_data</span></code> : Insère les nomenclatures liées à la taxonomie en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> : Installe le schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>. Fournie par UsersHub-authentification-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">utilisateurs-samples</span></code> : Insère des données d’exemples (utilisateurs, groupes) dans le schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>. Fourni par UsersHub-authentification-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">habitats</span></code> : Créé le schéma <code class="docutils literal notranslate"><span class="pre">ref_habitats</span></code>. Fourni par Habref-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">habitats_inpn_data</span></code> : Insère le référentiel HABREF de l’INPN en base. Fourni par Habref-api-module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> : Créé le schéma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code>. Fourni par RefGeo.</p></li>
</ul>
<p>Si vous utilisez UsersHub, vous pouvez être intéressé par les branches suivantes :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">usershub</span></code> : Déclare l’application UsersHub dans la liste des applications. Fourni par UsersHub.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">usershub-samples</span></code> : Associe le groupe « Grp_admin » issue des données d’exemple à l’application UsersHub et au profil « Administrateur » permettant aux utilisateurs du groupe de se connecter à UsersHub. Fourni par UsersHub.</p></li>
</ul>
<p>Les branches ci-après sont totalement optionnelles :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_1</span></code> : Insère les mailles 1×1 km (INPN) dans le référentiel géographique (type de zone <code class="docutils literal notranslate"><span class="pre">M1</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_5</span></code> : Insère les mailles 5×5 km (INPN) dans le référentiel géographique (type de zone <code class="docutils literal notranslate"><span class="pre">M5</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_inpn_grids_10</span></code> : Insère les mailles 10×10 km (INPN) dans le référentiel géographique (type de zone <code class="docutils literal notranslate"><span class="pre">M10</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_fr_municipalities</span></code> : Insère les communes françaises (IGN février 2020) dans le référentiel géographique (type de zone <code class="docutils literal notranslate"><span class="pre">COM</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ref_geo_fr_departments</span></code> : Insère les départements français (IGN février 2020) dans le référentiel géographique (type de zone <code class="docutils literal notranslate"><span class="pre">DEP</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ign_bd_alti</span></code> : Insère le modèle numérique de terrain (MNT) de l’IGN en base.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ign_bd_alti_vector</span></code> : Vectorise le MNT.</p></li>
</ul>
<p>Note : pour plusieurs fichiers de révision, notamment liés au référentiel géographique ou nécessitant des données INPN, il est nécessaire de télécharger des ressources externes. Il est possible d’enregistrer les données téléchargées (et ne pas les re-télécharger si elles sont déjà présentes) avec <code class="docutils literal notranslate"><span class="pre">-x</span> <span class="pre">data-directory=…</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ geonature db upgrade …@head -x data-directory=./data/
</pre></div>
</div>
</section>
</section>
<section id="gestion-des-droits">
<h3>Gestion des droits<a class="headerlink" href="#gestion-des-droits" title="Lien vers cette rubrique">#</a></h3>
<section id="acces-a-geonature-et-cruved">
<h4>Accès à GeoNature et CRUVED<a class="headerlink" href="#acces-a-geonature-et-cruved" title="Lien vers cette rubrique">#</a></h4>
<p>Les comptes des utilisateurs, leur mot de passe, email, groupes et leur accès à l’application GeoNature sont gérés de manière centralisée dans l’application UsersHub. Pour qu’un rôle (utilisateur ou groupe) ait accès à GeoNature, il faut lui attribuer un profil de « Lecteur » dans l’application GeoNature, grâce à l’application UsersHub qui va modifier la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>.</p>
<p>La gestion des droits (permissions) des rôles, spécifique à GeoNature, est ensuite gérée dans un schéma (<code class="docutils literal notranslate"><span class="pre">gn_permissions</span></code>) depuis le module ADMIN de GeoNature. Voir <a class="reference external" href="https://docs.geonature.fr/user-manual.html#gestion-des-permissions">https://docs.geonature.fr/user-manual.html#gestion-des-permissions</a>.</p>
<p>La gestion des permissions dans GeoNature, comme dans beaucoup d’applications, est liée à des actions (Create / Read / Update / Delete aka CRUD). Pour les besoins métier de l’application, nous avons rajouté deux actions : « Exporter » et « Valider » (non utilisée), ce qui donne le CRUVED : Create / Read / Update / Validate / Export / Delete.</p>
<p>Chaque module peut utiliser toutes ou certaines de ces actions.</p>
<p>Selon les modules, on peut appliquer des filtres sur ces actions. Notamment des filtres d’appartenance (portée / scope) :</p>
<ul class="simple">
<li><p>Portée 1 = Seulement mes données. Cela concerne les données sur lesquels je suis :</p>
<ul>
<li><p>observateur</p></li>
<li><p>personne ayant effectuée la saisie de la donnée</p></li>
<li><p>personnellement acteur du jeu de données de la donnée</p></li>
<li><p>personne ayant saisi le JDD de la donnée</p></li>
</ul>
</li>
<li><p>Portée 2 = Les données de mon organisme. Portée 1 + :</p>
<ul>
<li><p>les données sur lesquelles mon organisme est acteur du JDD de la donnée</p></li>
</ul>
</li>
</ul>
<p>Exemple :</p>
<ul class="simple">
<li><p>Utilisateur 1 peut effectuer l’action « DELETE » sur « SES DONNEES »</p></li>
<li><p>Utilisateur Admin peut effectuer l’action « UPDATE » sur « TOUTES LES DONNEES » (sans filtre d’appartenance)</p></li>
</ul>
<p>Ces permissions sont attribuées module par module, et éventuellement sur des objets de certains modules.</p>
</section>
<section id="cas-particulier-de-l-action-c">
<h4>Cas particulier de l’action « C »<a class="headerlink" href="#cas-particulier-de-l-action-c" title="Lien vers cette rubrique">#</a></h4>
<div class="line-block">
<div class="line">Dans les modules de saisie (comme Occtax), on veut que des utilisateurs puissent saisir uniquement dans certains JDD.</div>
<div class="line">La liste des JDD ouverts à la saisie est contrôlée par l’action « CREATE » du module dans lequel on se trouve.</div>
<div class="line">Comme il n’est pas « normal » de pouvoir saisir dans des JDD sur lesquels on n’a pas les permissions de lecture, la portée de l’action « CREATE » vient simplement réduire la liste des JDD sur lesquels on a les permissions de lecture (« READ »).</div>
<div class="line">Même si la portée de l’action « CREATE » sur le module est supérieure à celle de l’action « READ », l’utilisateur ne verra que les JDD sur lesquels il a des permissions de lecture.</div>
</div>
</section>
<section id="permissions-d-administrateur">
<h4>Permissions d’administrateur<a class="headerlink" href="#permissions-d-administrateur" title="Lien vers cette rubrique">#</a></h4>
<p>Chaque module (ou sous-module) définit ses permissions disponibles lors de son installation. Cependant une fois installé, aucun utilisateur n’a de permission sur un nouveau module. Il faut les définir explicitement.</p>
<p>Une commande dédiée permet d’ajouter toutes les permissions sur tous les modules à un groupe ou utilisateur ayant le rôle d’administrateur. Cette commande peut être relancée après l’installation d’un nouveau module :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># changer &quot;Grp_Admin&quot; par le nom de votre groupe d&#39;administrateur si vous l&#39;avez changé</span>
geonature<span class="w"> </span>permissions<span class="w"> </span>supergrant<span class="w"> </span>--group<span class="w"> </span>--nom<span class="w"> </span><span class="s2">&quot;Grp_admin&quot;</span>
</pre></div>
</div>
</section>
<section id="recapitulatif">
<h4>Récapitulatif<a class="headerlink" href="#recapitulatif" title="Lien vers cette rubrique">#</a></h4>
<ul class="simple">
<li><p>Dans GeoNature on peut attribuer à un role des actions possibles dans un module, sur lesquels on peut ajouter des filtres (définis dans la table <code class="docutils literal notranslate"><span class="pre">gn_permissions.t_permissions</span></code>).</p></li>
<li><p>6 actions sont possibles dans GeoNature : Create / Read / Update / Validate / Export / Delete (aka CRUVED).</p></li>
<li><p>Différents types de filtre existent. Le plus courant est le filtre d’appartenance (portée) : 2 filtres d’appartenance sont attribuables à des actions : Mes données / Les données de mon organisme. La synthèse dispose aussi d’un filtre de sensibilité.</p></li>
<li><p>Des fonctions PostgreSQL ont aussi été intégrées pour faciliter la récupération de ces informations (<code class="docutils literal notranslate"><span class="pre">gn_permissions.cruved_for_user_in_module</span></code>, <code class="docutils literal notranslate"><span class="pre">gn_permissions.does_user_have_scope_permission</span></code>, …)</p></li>
<li><p>Si un utilisateur n’a aucune permission sur un module, alors il ne lui sera pas affiché dans le menu latéral et il ne pourra pas y accéder</p></li>
<li><p>Il est aussi possible de ne pas utiliser UsersHub pour gérer les utilisateurs et de connecter GeoNature à un CAS (voir configuration). Actuellement ce paramétrage est fonctionnel en se connectant au CAS de l’INPN (MNHN)</p></li>
</ul>
<p>A noter que toutes les actions et tous les filtres n’ont pas été implémentées dans tous les modules. Elles le sont en fonction des besoins de chaque module. Chaque module définit la liste de ses permissions disponibles (actions et filtres).</p>
</section>
</section>
<section id="nomenclatures">
<h3>Nomenclatures<a class="headerlink" href="#nomenclatures" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Toutes les valeurs des listes déroulantes sont gérées dans une table générique <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.t_nomenclatures</span></code></p></li>
<li><p>Elles s’appuient sur les nomenclatures du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/nomenclature/">http://standards-sinp.mnhn.fr/nomenclature/</a>) qui peuvent être désactivées ou completées</p></li>
<li><p>Chaque nomenclature est associée à un type (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.bib_nomenclatures_types</span></code>), et une vue par type de nomenclature a été ajoutée pour simplifier leur usage</p></li>
<li><p>Ces nomenclatures sont gérées dans un sous-module pour pouvoir les réutiliser (ainsi que leur mécanisme) dans d’autres applications : <a class="github reference external" href="https://github.com/PnX-SI/Nomenclature-api-module/">PnX-SI/Nomenclature-api-module</a></p></li>
<li><p>Les identifiants des nomenclatures et des types de nomenclature sont des serials (entiers auto-incrémentés) et ne sont pas prédéfinis lors de l’installation, ni utilisées en dur dans le code des applications. En effet, les nomenclatures peuvent varier en fonction des structures. On utilise le <code class="docutils literal notranslate"><span class="pre">cd_nomenclature</span></code> et le <code class="docutils literal notranslate"><span class="pre">mnémonique</span></code> du type de nomenclature pour retrouver dynamiquement l”<code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> d’une nomenclature. C’est cependant cet identifiant qu’on stocke au niveau des données pour garantir l’intégrité référentielle</p></li>
<li><p>Chaque nomenclature peut être associée à un règne ou un group2inpn (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.cor_taxref_nomenclature</span></code>) pour proposer des nomenclatures correspondants à un taxon</p></li>
<li><p>Il est possible de désactiver des nomenclatures en passant la valeur de la colonne <code class="docutils literal notranslate"><span class="pre">active</span></code> en <cite>false</cite>.</p></li>
<li><p>Les valeurs par défaut sont définies dans chaque module</p></li>
<li><p>Pour Occtax c’est dans <code class="docutils literal notranslate"><span class="pre">pr_occtax.defaults_nomenclatures_value</span></code>. Elles peuvent être définies pour chaque type de nomenclature ainsi que par organisme, règne et/ou group2inpn</p></li>
<li><p>Si organisme = 0 alors la valeur par défaut s’applique à tous les organismes. Idem pour les règnes et group2inpn</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">pr_occtax.get_default_nomenclature_value</span></code> permet de renvoyer l’id de la nomenclature par défaut</p></li>
<li><p>Ces valeurs par défaut sont aussi utilisées pour certains champs qui sont cachés (statut_observation, floutage, statut_validation…) mais ne sont donc pas modifiables par l’utilisateur</p></li>
<li><p>Il existe aussi une table pour définir des valeurs par défaut générales de nomenclature (<code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.defaults_nomenclatures_value</span></code>)</p></li>
<li><p>Elles peuvent être administrées dans le module Admin de GeoNature.</p></li>
</ul>
</section>
<section id="metadonnees">
<h3>Métadonnées<a class="headerlink" href="#metadonnees" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Elles sont gérées dans le schéma <code class="docutils literal notranslate"><span class="pre">gn_meta</span></code> basé sur le standard Métadonnées du SINP (<a class="reference external" href="http://standards-sinp.mnhn.fr/category/standards/metadonnees/">http://standards-sinp.mnhn.fr/category/standards/metadonnees/</a>).</p></li>
<li><p>Elles permettent de gérer des jeux de données, des cadres d’acquisition, des acteurs (propriétaire, financeur, producteur…) et des protocoles.</p></li>
<li><p>Elles peuvent être administrées dans le module Métadonnées de GeoNature.</p></li>
<li><p>Les acteurs sont quant à eux gérés dans la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.bib_organismes</span></code> et donc paramétrables dans UsersHub.</p></li>
</ul>
</section>
<section id="donnees-sig">
<h3>Données SIG<a class="headerlink" href="#donnees-sig" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Le schéma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> permet de gérer les données SIG (zonages, communes, MNT…) de manière centralisée, potentiellement partagé avec d’autres BDD</p></li>
<li><p>Il contient une table des zonages, des types de zonages, des communes, des grilles (mailles) et un MNT raster ou vectorisé (<a class="github reference external" href="https://github.com/PnX-SI/GeoNature/issues/235">PnX-SI/GeoNature#235</a>)</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">ref_geo.fct_get_area_intersection</span></code> permet de renvoyer les zonages intersectés par une observation en fournissant sa géométrie</p></li>
<li><p>La fonction <code class="docutils literal notranslate"><span class="pre">ref_geo.fct_get_altitude_intersection</span></code> permet de renvoyer l’altitude min et max d’une observation en fournissant sa géométrie</p></li>
<li><p>Les intersections d’une observation avec les zonages sont stockées au niveau de la synthèse (<code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>) et non au niveau de la donnée source pour alléger et simplifier leur gestion</p></li>
</ul>
</section>
<section id="profils-de-taxons">
<h3>Profils de taxons<a class="headerlink" href="#profils-de-taxons" title="Lien vers cette rubrique">#</a></h3>
<section id="introduction">
<h4>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique">#</a></h4>
<p>GeoNature dispose d’un mécanisme permettant de calculer des profils pour chaque taxon en se basant sur les données validées présentes dans la Synthèse de l’instance.</p>
<p>Ces profils sont stockés dans un schéma dédié <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>, et plus précisément dans les deux vues matérialisées suivantes :</p>
<ol class="arabic simple">
<li><p>La vue matérialisée <code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_valid_profiles</span></code> comporte des informations générales sur chaque taxon :</p></li>
</ol>
<ul class="simple">
<li><p>L’aire d’occurrences</p></li>
<li><p>Les altitudes extrêmes d’observation du taxon</p></li>
<li><p>Les dates de première et de dernière observation</p></li>
<li><p>Le nombre de données valides pour le taxon considéré</p></li>
</ul>
<ol class="arabic simple" start="2">
<li><p>La vue matérialisée <code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_cor_taxon_phenology</span></code> comporte les « combinaisons » d’informations relatives à la phénologie des taxons (voir détail des calculs ci-dessous) :</p></li>
</ol>
<ul class="simple">
<li><p>La période d’observation</p></li>
<li><p>Le stade de vie (activable ou non)</p></li>
<li><p>Les altitudes min et max</p></li>
<li><p>Les altitudes « fiables » en écartant les valeurs extrêmes</p></li>
<li><p>Le nombre de données correspondant à cette « combinaison phénologique »</p></li>
</ul>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">gn_profiles.refresh_profiles()</span></code> permet de rafraichir ces vues matérialisées.</p>
<p>Pour lancer manuellement cette fonction, ouvrez une console SQL et exécutez la requête <code class="docutils literal notranslate"><span class="pre">SELECT</span> <span class="pre">gn_profiles.refresh_profiles();</span></code>.</p>
<p>Cette fonction est aussi diponible en tant que fonction GeoNature qu’il est préférable d’utiliser : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">profiles</span> <span class="pre">update</span></code></p>
<p>Pour automatiser l’exécution de cette fonction (tous les jours à minuit dans cet exemple), <a class="reference internal" href="installation.html#cron"><span class="std std-ref">créer une tâche planfiée</span></a>.</p>
</section>
<section id="usage">
<h4>Usage<a class="headerlink" href="#usage" title="Lien vers cette rubrique">#</a></h4>
<p>Pour chaque taxon (cd_ref) disposant de données dans la vue <code class="docutils literal notranslate"><span class="pre">gn_profiles.v_synthese_for_profiles</span></code> (vue filtrée basée sur la synthèse de l’instance), un profil est généré. Il comporte l’aire d’occurrence, les limites altitudinales et les combinaisons phénologiques jugées cohérentes sur la base des données disponibles.</p>
<p>Ces profils sont déclinés sur :</p>
<ul class="simple">
<li><p>Le module de validation permet d’attirer l’attention des validateurs sur les données qui sortent du « cadre » déjà connu pour le taxon considéré, et d’apporter des éléments de contexte en complément de la donnée en cours de validation</p></li>
<li><p>Le module Synthèse (fiche d’information, onglet validation) permet d’apporter des éléments de contexte en complément des données brutes consultées</p></li>
<li><p>Le module Occtax permet d’alerter les utilisateurs lors de la saisie de données qui sortent du « cadre » déjà connu pour un taxon considéré</p></li>
<li><p>Le processus de validation automatique permet de valider automatiquement les observations respectant le profil de taxons (non activé par défaut).</p></li>
</ul>
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/validation.png" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/validation.png" />
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/contexte_donnee.png" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/contexte_donnee.png" />
<p>Plusieurs fonctions permettent de vérifier si une donnée de la synthèse est cohérente au regard du profil du taxon en question :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_distribution</span></code> : permet de vérifier si la donnée testée est totalement incluse dans l’aire d’occurrences déjà connue pour son taxon.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_phenology</span></code> : permet de vérifier si la phénologie d’une donnée (période, stade de vie, altitudes) est une combinaison déjà connue dans le profil du taxon</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_profiles.check_profile_altitudes</span></code> : permet de vérifier si une donnée est bien située dans la fourchette d’altitudes connue pour le taxon en question</p></li>
</ul>
</section>
<section id="configuration-et-parametrage">
<h4>Configuration et paramétrage<a class="headerlink" href="#configuration-et-parametrage" title="Lien vers cette rubrique">#</a></h4>
<p><em>Paramètres de calcul des profils</em> :</p>
<p>Le calcul des profils de taxons repose sur plusieurs variables, paramétrables soit pour tout le mécanisme, soit pour des taxons donnés.</p>
<p>Les paramètres généraux dans la table <code class="docutils literal notranslate"><span class="pre">gn_profiles.t_parameters</span></code> :</p>
<ul class="simple">
<li><p>Le paramètre <code class="docutils literal notranslate"><span class="pre">id_valid_status_for_profiles</span></code> : permet de lister les <code class="docutils literal notranslate"><span class="pre">id_nomenclatures</span></code> des statuts de validation à prendre en compte pour les calculs des profils. Par exemple, en ne listant que les identifiants des nomenclatures « Certain -très probable » et « Probable », seules ces données valides seront prises en compte lors du calcul des profils (comportement par défaut). En listant tous les identifiants des nomenclatures des statuts de validation, l’ensemble des données alimenteront les profils de taxons.</p></li>
<li><p>Le paramètre <code class="docutils literal notranslate"><span class="pre">id_rang_for_profiles</span></code> : permet de lister les <code class="docutils literal notranslate"><span class="pre">id_rang</span></code> de Taxref à prendre en compte pour les calculs des profils. Par défaut, les profils ne sont calculés que pour les cd_ref correspondant à des Genres, Espèces et Sous-espèces.</p></li>
<li><p>Le paramètre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> définit le pourcentage de données à conserver lors du calcul des altitudes valides (<code class="docutils literal notranslate"><span class="pre">gn_profiles.vm_cor_taxon_phenology</span></code>), en retirant ainsi les extrêmes. Ce paramètre, définit à 95% par défaut, doit être compris entre 51 et 100% (voir détails ci-après).</p></li>
</ul>
<p>Les deux premiers paramètres permettent de filtrer les données dans la vue <code class="docutils literal notranslate"><span class="pre">gn_profiles.v_synthese_for_profiles</span></code>. Cette vue comporte les données de la synthèse qui répondent aux paramètres et qui alimenteront les profils de taxons. Les clauses WHERE de cette vue peuvent être adaptées pour filtrer les données sur davantage de critères et répondre aux besoins plus spécifiques, mais sa structure doit rester inchangée.</p>
<p>Les paramètres définis par taxon le sont dans la table <code class="docutils literal notranslate"><span class="pre">gn_profiles.cor_taxons_parameters</span></code> :</p>
<p>Les profils peuvent être calculés avec des règles différentes en fonction des taxons. Ceux-ci sont définis au niveau du cd_nom, à n’importe quel rang (espèce, famille, règne etc). Ils seront appliqués de manière récursive à tous les taxons situés « sous » le cd_ref paramétré.</p>
<p>Dans le cas où un taxon hérite de plusieurs règles (une définie pour son ordre et une autre définie pour sa famille par exemple), les paramètres définis au plus proche du taxon considéré seront pris en compte.</p>
<p>Par exemple, s’il existe des paramètres pour le phylum « Animalia » (cd_nom 183716) et d’autres pour le renard (cd_nom 60585), les paramètres du renard seront appliqués en priorité pour cette espèce, mais les paramètres Animalia s’appliqueront à tous les autres animaux.</p>
<p>Les règles appliquables à chaque taxon sont récupérées par la fonction <code class="docutils literal notranslate"><span class="pre">gn_profiles.get_parameters(cdnom)</span></code>.</p>
<p>Pour chaque cd_nom, il est ainsi possible de définir les paramètres suivants :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">spatial_precision</span></code> : La précision spatiale utilisée pour calculer les profils. Elle est exprimée selon l’unité de mesure de la projection locale de l’instance GeoNature : mètres pour le Lambert93, degré pour le WGS84 etc. Elle définit à la fois la taille de la zone tampon appliquée autour de chaque observation pour définir l’aire d’occurrences du taxon, ainsi que la distance maximale admise entre le centroïde et les limites d’une observation pour qu’elle soit prise en compte lors du calcul des profils (évite qu’une donnée imprécise valide à elle seule une grande zone).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">temporal_precision_days</span></code> : La précision temporelle en jours utilisée pour calculer les profils. Elle définit à la fois le pas de temps avec lequel la phénologie est calculée, ainsi que la précision temporelle minimale requise (différence entre date début et date fin de l’observation) pour qu’une donnée soit prise en compte dans le calcul des profils. Une précision de 365 jours ou plus permettra de ne pas tenir compte de la période (toutes les données seront dans une unique période de l’année).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">active_life_stage</span></code> : Définit si le stade de vie doit être pris en compte ou non lors du calcul des profils.</p></li>
</ul>
<p>Par défaut, une précision spatiale de 2000m et une précision temporelle de 10j (décade) sont paramétrés pour tous les phylums, sans tenir compte des stades de vie.</p>
<p>A terme, d’autres variables pourront compléter ces profils : habitats (habref) ou comportement (nidification, reproduction, migration…) notamment.</p>
<p><em>Configuration - Activer/désactiver les profils</em> :</p>
<p>Il est possible de désactiver l’ensemble des fonctionnalités liées aux profils dans l’interface, en utilisant le paramètre suivant dans le fichier <code class="docutils literal notranslate"><span class="pre">geonature/config/geonature_config.toml</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">FRONTEND</span><span class="p">]</span>
  <span class="n">ENABLE_PROFILES</span> <span class="o">=</span> <span class="n">true</span><span class="o">/</span><span class="n">false</span>
</pre></div>
</div>
</section>
<section id="calcul-des-phenologies">
<h4>Calcul des phénologies<a class="headerlink" href="#calcul-des-phenologies" title="Lien vers cette rubrique">#</a></h4>
<p>Pour chaque taxon, la phénologie est calculée en croisant dans un premier temps les périodes d’observations et, selon les paramètres, les stades de vie.</p>
<p>Pour chacune des combinaisons obtenues (période x stade de vie), sont alors calculées :</p>
<ul class="simple">
<li><p>L’altitude minimale (toutes données comprises)</p></li>
<li><p>L’altitude maximale (toutes données comprises)</p></li>
<li><p>L’altitude minimale fiable (en retirant x% de données extrêmes selon le paramètre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code>)</p></li>
<li><p>L’altitude maximale fiable (en retirant x% de données extrêmes selon le paramètre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code>)</p></li>
<li><p>Le nombre de données valides correspondantes</p></li>
</ul>
<p><em>Exclusion des données extrêmes</em></p>
<p>Afin que des données exceptionnelles, bien que valides, ne soient pas considérées comme une « norme », les profils permettent d’exclure un certain pourcentage de données extrêmes. Pour ce faire :</p>
<ul class="simple">
<li><p>Le nombre de données exclues est systématiquement arrondi à l’entier supérieur, pour les extrêmes « bas » et les extrêmes « hauts »</p></li>
<li><p>Aucune altitude fiable n’est calculée s’il y a davantage de données exclues que de données conservées</p></li>
<li><p>Le paramètre <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> doit donc être compris entre 51 et 100% : en dessous de 50%, le nombre de données supprimées est supérieur au nombre de données conservées, aucune altitude fiable ne sera calculée. Si le paramètre est à 100%, les altitudes fiables seront identiques aux altitudes extrêmes observées pour la période (et le stade) donnés</p></li>
</ul>
<p>Il faut donc (1/[1- <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> /100])+1 données pour que des altitudes fiables soient calculées, soit :</p>
<ul class="simple">
<li><p>101 données minimum par période/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =99</p></li>
<li><p>51 données minimum par période/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =98</p></li>
<li><p>21 données minimum par période/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =95</p></li>
<li><p>11 données minimum par période/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =90</p></li>
<li><p>3 données minimum par période/stade si <code class="docutils literal notranslate"><span class="pre">proportion_kept_data</span></code> =51</p></li>
</ul>
</section>
</section>
<section id="fonctions">
<h3>Fonctions<a class="headerlink" href="#fonctions" title="Lien vers cette rubrique">#</a></h3>
<p>La base de données contient de nombreuses fonctions.</p>
<p><strong>gn_synthese</strong></p>
<div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Fonction</p></th>
<th class="head"><p>Paramètres</p></th>
<th class="head"><p>Résultat</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>get_default_nomenclature_value</p></td>
<td><p>id_type_nomenclature,
idorganism, regne, group2inpn</p></td>
<td><p>Entier</p></td>
<td><p>Function that return the default
nomenclature id with a nomenclature
type, organism id, regne, group2_inpn</p></td>
</tr>
<tr class="row-odd"><td><p>fct_trig_insert_in_cor_area_synthese</p></td>
<td><p>geom</p></td>
<td><p>Trigger</p></td>
<td><p>Trigger intersectant la géométrie
d’une observation avec tous les zonages</p></td>
</tr>
</tbody>
</table>
</div>
<p><strong>ref_geo</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_altitude_intersection</span><span class="p">(</span><span class="k">IN</span><span class="w"> </span><span class="n">mygeom</span><span class="w"> </span><span class="n">geometry</span><span class="p">)</span>
<span class="c1">-- Fonction qui retourne l&#39;altitude min et max de la géométrie passée en paramètre</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_area_intersection</span><span class="p">(</span>
<span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">mygeom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">  </span><span class="k">IN</span><span class="w"> </span><span class="n">myidtype</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="k">NULL</span><span class="p">::</span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="p">(</span><span class="n">id_area</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">id_type</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">area_code</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">area_name</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="c1">-- Fonction qui retourne un tableau des zonages (id_area) intersectant la géométrie passée en paramètre</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ref_geo</span><span class="p">.</span><span class="n">get_id_area_type</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_type_area from the type_code of an area type</span>
</pre></div>
</div>
<p><strong>pr_occtax</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pr_occtax</span><span class="p">.</span><span class="n">get_id_counting_from_id_releve</span><span class="p">(</span><span class="n">my_id_releve</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span><span class="p">[]</span>
<span class="c1">-- Function which return the id_countings in an array (table pr_occtax.cor_counting_occtax) from the id_releve(integer)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myidorganism</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">myregne</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">mygroup2inpn</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that return the default nomenclature id with wanteds nomenclature type, organism id, regne, group2_inp  --Return -1 if nothing matche with given parameters</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">pr_occtax</span><span class="p">.</span><span class="n">insert_in_synthese</span><span class="p">(</span><span class="n">my_id_counting</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span><span class="p">[]</span>
</pre></div>
</div>
<p><strong>ref_nomenclatures</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_id_nomenclature_type</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_type from the mnemonique of a nomenclature type</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myidorganism</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">DEFAULT</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that return the default nomenclature id with wanteds nomenclature type (mnemonique), organism id</span>
<span class="c1">--Return -1 if nothing matche with given parameters</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_mnemonique</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use mnemonique type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_cd_nomenclature</span><span class="p">(</span><span class="n">mycdnomenclature</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use mnemonique type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">check_nomenclature_type_by_id</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">myidtype</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--Function that checks if an id_nomenclature matches with wanted nomenclature type (use id_type)</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_id_nomenclature</span><span class="p">(</span>
<span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span>
<span class="n">mycdnomenclature</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function which return the id_nomenclature from an mnemonique_type and an cd_nomenclature</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_nomenclature_label</span><span class="p">(</span>
<span class="n">myidnomenclature</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="n">mylanguage</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="c1">--Function which return the label from the id_nomenclature and the language</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_cd_nomenclature</span><span class="p">(</span><span class="n">myidnomenclature</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span><span class="w"> </span><span class="k">RETURNS</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span>
<span class="c1">--Function which return the cd_nomenclature from an id_nomenclature</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">get_filtered_nomenclature</span><span class="p">(</span><span class="n">mytype</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">myregne</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">,</span><span class="w"> </span><span class="n">mygroup</span><span class="w"> </span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">SETOF</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function that returns a list of id_nomenclature depending on regne and/or group2_inpn sent with parameters.</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">calculate_sensitivity</span><span class="p">(</span>
<span class="n">mycdnom</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="n">mynomenclatureid</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">integer</span>
<span class="c1">--Function to return id_nomenclature depending on observation sensitivity</span>
<span class="c1">--USAGE : SELECT ref_nomenclatures.calculate_sensitivity(240,21);</span>
</pre></div>
</div>
<p><strong>gn_profiles</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">get_profiles_parameters</span><span class="p">(</span><span class="n">mycdnom</span><span class="w"> </span><span class="nb">integer</span><span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="p">(</span><span class="n">cd_ref</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">spatial_precision</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">temporal_precision_days</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="n">active_life_stage</span><span class="w"> </span><span class="nb">boolean</span><span class="p">,</span><span class="w">  </span><span class="n">distance</span><span class="w"> </span><span class="nb">smallint</span><span class="p">)</span>
<span class="c1">-- fonction permettant de récupérer les paramètres les plus adaptés (définis au plus proche du taxon) pour calculer le profil d&#39;un taxon donné</span>
<span class="c1">-- par exemple, s&#39;il existe des paramètres pour les &quot;Animalia&quot; des paramètres pour le renard, les paramètres du renard surcoucheront les paramètres Animalia pour cette espèce</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_distribution</span><span class="p">(</span>
<span class="w">    </span><span class="n">in_geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">,</span>
<span class="w">    </span><span class="n">profil_geom</span><span class="w"> </span><span class="n">geometry</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vérifier la cohérence d&#39;une donnée d&#39;occurrence en s&#39;assurant que sa localisation est totalement incluse dans l&#39;aire d&#39;occurrences valide définie par le profil du taxon en question</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_phenology</span><span class="p">(</span>
<span class="w">    </span><span class="n">in_cd_ref</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_date_min</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_date_max</span><span class="w"> </span><span class="nb">date</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_altitude_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_altitude_max</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">in_id_nomenclature_life_stage</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">    </span><span class="n">check_life_stage</span><span class="w"> </span><span class="nb">boolean</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vérifier la cohérence d&#39;une donnée d&#39;occurrence en s&#39;assurant que sa phénologie (dates, altitude, stade de vie selon les paramètres) correspond bien à la phénologie valide définie par le profil du taxon en question</span>
<span class="c1">--La fonction renvoie &#39;false&#39; pour les données trop imprécises (durée d&#39;observation supérieure à la précision temporelle définie dans les paramètres des profils).</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">gn_profiles</span><span class="p">.</span><span class="n">check_profile_altitudes</span><span class="p">(</span>
<span class="w">  </span><span class="n">in_alt_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">in_alt_max</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">profil_altitude_min</span><span class="w"> </span><span class="nb">integer</span><span class="p">,</span>
<span class="w">  </span><span class="n">profil_altitude_max</span><span class="w"> </span><span class="nb">integer</span>
<span class="p">)</span>
<span class="k">RETURNS</span><span class="w"> </span><span class="nb">boolean</span>
<span class="c1">--fonction permettant de vérifier la cohérence d&#39;une donnée d&#39;occurrence en s&#39;assurant que son altitude se trouve entièrement comprise dans la fourchette altitudinale valide du taxon en question</span>
</pre></div>
</div>
</section>
<section id="tables-transversales">
<h3>Tables transversales<a class="headerlink" href="#tables-transversales" title="Lien vers cette rubrique">#</a></h3>
<p>GeoNature contient aussi des tables de stockage transversales qui peuvent être utilisées par tous les modules. C’est le cas pour la validation, la sensibilité, l’historisation des modifications et les médias.</p>
<p>Cela permet de ne pas avoir à mettre en place des tables et mécanismes dans chaque module, mais de s’appuyer sur un stockage, des fonctions et développements factorisés, centralisés et partagés.</p>
<p>Ces tables utilisent notamment le mécanisme des UUID (identifiant unique) pour retrouver les enregistrements. Depuis une table source (Occtax ou un autre module) on peut retrouver les enregistrements stockées dans les tables transversales en utilisant un <code class="docutils literal notranslate"><span class="pre">WHERE</span> <span class="pre">&lt;TABLE_TRANSVERSALE&gt;.uuid_attached_row</span> <span class="pre">=</span> <span class="pre">&lt;MON_UUID_SOURCE&gt;</span></code> et ainsi retrouver l’historique de validation, les médias ou encore la sensibilité associés à une donnée.</p>
<p>Voir <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/issues/339">PnX-SI/GeoNature#339</a></p>
</section>
<section id="triggers-vers-la-synthese">
<h3>Triggers vers la synthèse<a class="headerlink" href="#triggers-vers-la-synthese" title="Lien vers cette rubrique">#</a></h3>
<p>Voir ceux mis en place de Occtax vers Synthèse.</p>
<p>Cheminement d’une donnée Occtax :</p>
<ol class="arabic simple">
<li><p>Formulaire Occtax</p></li>
<li><p>Ecriture dans la table <code class="docutils literal notranslate"><span class="pre">cor_counting_occtax</span></code> et génération d’un nouvel UUID</p></li>
<li><p>Trigger d’écriture dans la table verticale <code class="docutils literal notranslate"><span class="pre">t_validations</span></code> à partir de la valeur par défaut de la nomenclature de validation (<code class="docutils literal notranslate"><span class="pre">gn_common.ref_nomenclatures.defaults_nomenclatures_value</span></code>)</p></li>
<li><p>Trigger d’écriture d’Occtax vers la synthèse (on ne maitrise pas l’ordre de ces 2 triggers qui sont lancés en même temps)</p></li>
<li><p>Trigger de rapatriement du dernier statut de validation de la table verticale vers la synthèse.</p></li>
</ol>
</section>
<section id="triggers-dans-la-synthese">
<h3>Triggers dans la synthèse<a class="headerlink" href="#triggers-dans-la-synthese" title="Lien vers cette rubrique">#</a></h3>
<p>Version 2.1.0 de GeoNature</p>
<img alt="https://geonature.fr/docs/img/2019-06-triggers-gn_synthese.jpg" src="https://geonature.fr/docs/img/2019-06-triggers-gn_synthese.jpg" />
<p><strong>Table : synthese</strong></p>
<p>Table contenant l’ensemble des données.
Respecte le standard Occurrence de taxon du SINP.</p>
<ul class="simple">
<li><p>tri_meta_dates_change_synthese</p>
<ul>
<li><p>BEFORE INSERT OR UPDATE</p></li>
<li><p>Mise à jour des champs <code class="docutils literal notranslate"><span class="pre">meta_create_date</span></code> et <code class="docutils literal notranslate"><span class="pre">meta_update_date</span></code></p></li>
</ul>
</li>
<li><p>tri_insert_cor_area_synthese</p>
<ul>
<li><p>AFTER INSERT OR UPDATE OF the_geom_local</p></li>
<li><p>Mise à jour de la table <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Si update : suppression des enregistrements de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> avec l’id_synthese concerné</p></li>
<li><p>Insertion des id_areas intersectant la géométrie de la synthèse dans <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>. <em>Prise en compte de toutes les aires qu’elles soient ou non actives. Manque enable = true</em></p></li>
</ol>
</li>
</ul>
</li>
<li><p>tri_del_area_synt_maj_corarea_tax</p>
<ul>
<li><p>BEFORE DELETE</p></li>
<li><p>Mise à jour des tables <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Récupération de l’ensemble des aires intersectant la donnée de synthèse</p></li>
<li><p>Suppression des enregistrement de <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le cd_nom et les aires concernés</p></li>
<li><p>Insertion dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> recalculant les max, nb_obs et couleur pour chaque aire pour l’ensemble des données avec les aires concernées et le cd_nom concerné ne correspondant pas à la donnée supprimée</p></li>
<li><p>Suppression des enregistrements de <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code></p></li>
</ol>
</li>
</ul>
</li>
<li><p>tri_update_cor_area_taxon_update_cd_nom</p>
<ul>
<li><p>AFTER UPDATE OF cd_nom</p></li>
<li><p>Mise à jour de la table cor_area_taxon</p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Récupération de l’ensemble des aires intersectant la donnée de synthèse</p></li>
<li><p>Recalcul <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> pour l’ancien cd_nom via fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.delete_and_insert_area_taxon</span></code></p></li>
<li><p>Recalcul <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> pour le nouveau cd_nom via fonction <code class="docutils literal notranslate"><span class="pre">gn_synthese.delete_and_insert_area_taxon</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>Table : cor_area_synthese</strong></p>
<p>Table contenant l’ensemble des id_areas intersectant les enregistrements de la synthèse</p>
<ul class="simple">
<li><p>tri_maj_cor_area_taxon</p>
<ul>
<li><p>AFTER INSERT OR UPDATE</p></li>
<li><p>Mise à jour des données de cor_area_taxon</p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Récupération du cd_nom en lien avec l’enregistrement <code class="docutils literal notranslate"><span class="pre">cor_area_synthese</span></code></p></li>
<li><p>Suppression des données de <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et <code class="docutils literal notranslate"><span class="pre">id_area</span></code> concernés</p></li>
<li><p>Insertion des données dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> en lien avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et <code class="docutils literal notranslate"><span class="pre">id_area</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>Table : cor_observer_synthese</strong></p>
<ul class="simple">
<li><p>trg_maj_synthese_observers_txt</p>
<ul>
<li><p>AFTER INSERT OR UPDATE OR DELETE</p></li>
<li><p>Mise à jour du champ <code class="docutils literal notranslate"><span class="pre">observers</span></code> de la table <code class="docutils literal notranslate"><span class="pre">synthese</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Construction de la valeur textuelle des observateurs</p></li>
<li><p>Mise à jour du champ observer de l’enregistrement de la table <code class="docutils literal notranslate"><span class="pre">synthese</span></code></p></li>
</ol>
</li>
</ul>
</li>
</ul>
<p><strong>FONCTIONS</strong></p>
<ul class="simple">
<li><p>delete_and_insert_area_taxon</p>
<ul>
<li><p>Fonction qui met à jour la table <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> en fonction d’un <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et d’une liste d”<code class="docutils literal notranslate"><span class="pre">id</span> <span class="pre">area</span></code></p></li>
<li><p>Actions :</p>
<ol class="arabic simple">
<li><p>Suppression des enregistrement de la table <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code> avec le <code class="docutils literal notranslate"><span class="pre">cd_nom</span></code> et les <code class="docutils literal notranslate"><span class="pre">id_area</span></code> concernés</p></li>
<li><p>Insertion des données dans <code class="docutils literal notranslate"><span class="pre">cor_area_taxon</span></code></p></li>
</ol>
</li>
</ul>
</li>
<li><p>color_taxon</p>
<ul>
<li><p>Fonction qui associe une couleur à une durée</p></li>
<li><p><em>Passer les couleurs en paramètres : table  gn_commons.t_parameters ?</em></p></li>
<li><p><em>Passer la fonction en immutable</em></p></li>
</ul>
</li>
</ul>
</section>
</section>
<section id="modularite">
<h2>Modularité<a class="headerlink" href="#modularite" title="Lien vers cette rubrique">#</a></h2>
<p>Chaque module doit avoir son propre schéma dans la BDD, avec ses propres fichiers SQL de création comme le module OccTax : <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/data">PnX-SI/GeoNature</a></p>
<p>Côté Backend, chaque module a aussi son modèle et ses routes : <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/backend">PnX-SI/GeoNature</a></p>
<p>Idem côté Frontend, où chaque module a sa configuration et ses composants : <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/tree/develop/contrib/occtax/frontend/app">PnX-SI/GeoNature</a></p>
<p>Mais en pouvant utiliser des composants du Cœur comme expliqué dans la documentation Developpeur.</p>
</section>
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Lien vers cette rubrique">#</a></h2>
<p>Pour configurer GeoNature, actuellement il y a :</p>
<ul class="simple">
<li><p>Une configuration pour l’installation : <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code></p></li>
<li><p>Une configuration globale de l’application : <code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/geonature_config.toml</span></code> (générée lors de l’installation de GeoNature)</p></li>
<li><p>Une configuration optionnelle par module : placée dans le dossier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/</span></code>)</p></li>
<li><p>Une table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_parameters</span></code> pour des paramètres gérés dans la BDD</p></li>
</ul>
<p>TODO : Partie « Configuration applicative » du schéma à mettre à jour, car caduque.</p>
<img alt="https://geonature.fr/docs/img/admin-manual/administration-geonature.png" src="https://geonature.fr/docs/img/admin-manual/administration-geonature.png" />
<section id="configuration-generale-de-l-application">
<h3>Configuration générale de l’application<a class="headerlink" href="#configuration-generale-de-l-application" title="Lien vers cette rubrique">#</a></h3>
<p>La configuration générale de GeoNature se fait dans le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>.
Une version minimaliste est générée à l’installation à partir du fichier <code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code>.
Vous pouvez compléter votre configuration en vous inspirant des paramètres par défaut présents dans le fichier <code class="docutils literal notranslate"><span class="pre">config/default_config.toml.example</span></code>.</p>
<p id="post-config-change">Depuis la version 2.12.0 de GeoNature, la configuration de GeoNature et de ses modules est envoyée dynamiquement du backend au frontend par l’API de GeoNature et ne nécessite donc plus de regénérer la configuration ni de rebuilder le frontend.</p>
<p>De plus, à chaque modification du fichier de configuration de GeoNature ou d’un de ses modules, le backend est rechargé automatiquement.</p>
<p>Cependant, si vous faites une erreur dans un des fichiers de configuration, le chargement automatique va entrainer un plantage de GeoNature. Dans ce cas, mme si l’erreur d’un des fichiers de configuration est corrigée, il faut redémarrer manuellement GeoNature avec la commande <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code>.</p>
<p>Pour les versions précédentes de GeoNature, à chaque modification du fichier de configuration, vous devez :</p>
<ul class="simple">
<li><p>relancer le backend : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code></p></li>
<li><p>regénérer le fichier de configuration du frontend :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>backend/venv/bin/activate
geonature<span class="w"> </span>generate-frontend-config
</pre></div>
</div>
<ul class="simple">
<li><p>rebuilder le frontend :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>frontend
nvm<span class="w"> </span>use
npm<span class="w"> </span>run<span class="w"> </span>build
</pre></div>
</div>
<p>Vous pouvez également lancer la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">update-configuration</span></code> qui génèrera la configuration frontend de GeoNature ainsi que de l’ensemble des modules installés avant de lancer le build du frontend.</p>
</section>
<section id="configuration-d-un-gn-module">
<h3>Configuration d’un gn_module<a class="headerlink" href="#configuration-d-un-gn-module" title="Lien vers cette rubrique">#</a></h3>
<p>Voir la <a class="reference internal" href="installation.html#module-config"><span class="std std-ref">rubrique concernant la configuration des modules</span></a>.</p>
</section>
</section>
<section id="exploitation">
<h2>Exploitation<a class="headerlink" href="#exploitation" title="Lien vers cette rubrique">#</a></h2>
<section id="logs">
<h3>Logs<a class="headerlink" href="#logs" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Logs d’installation de GeoNature : <code class="docutils literal notranslate"><span class="pre">geonature/install/install.log</span></code></p></li>
<li><p>Logs de GeoNature : <code class="docutils literal notranslate"><span class="pre">/var/log/geonature/geonature.log</span></code></p></li>
<li><p>Logs du worker Celery : <code class="docutils literal notranslate"><span class="pre">/var/log/geonature/geonature-worker.log</span></code></p></li>
<li><p>Logs de UsersHub : <code class="docutils literal notranslate"><span class="pre">/var/log/usershub.log</span></code></p></li>
</ul>
</section>
<section id="commandes-geonature">
<h3>Commandes GeoNature<a class="headerlink" href="#commandes-geonature" title="Lien vers cette rubrique">#</a></h3>
<p>GeoNature est fourni avec une série de commandes pour administrer l’application.
Pour les exécuter, il est nécessaire d’être dans le virtualenv python de GeoNature</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd &lt;GEONATURE_DIRECTORY&gt;</span>
<span class="go">source backend/venv/bin/activate</span>
</pre></div>
</div>
<p>Le préfixe (venv) se met alors au début de votre invite de commande.</p>
<p>Voici la liste des commandes disponibles (aussi disponibles en tapant la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">--help</span></code>) :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">activate-gn-module</span></code> : Active un gn_module installé (Possibilité d’activer seulement le backend ou le frontend)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deactivate-gn-module</span></code> : Désactive gn_un module activé (Possibilté de désactiver seulement le backend ou le frontend)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dev-back</span></code> : Lance le backend en mode développement</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate-frontend-module-route</span></code> : Génère ou regénère le fichier de routing du frontend en incluant les gn_module installés (Fait automatiquement lors de l’installation d’un module)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">install-gn-module</span></code> : Installe un gn_module</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">generate-frontend-config</span></code> : Regénère le fichier de configuration du frontend. A exécuter suite à une modification du fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code> (utile avant GeoNature 2.12.0)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">update-module-configuration</span></code> : Met à jour la configuration d’un module. A exécuter suite à une modification du fichier <code class="docutils literal notranslate"><span class="pre">conf_gn_module.toml</span></code> (utile avant GeoNature 2.12.0)</p></li>
</ul>
<p>Effectuez <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">&lt;nom_commande&gt;</span> <span class="pre">--help</span></code> pour accéder à la documentation et à des exemples d’utilisation de chaque commande.</p>
</section>
<section id="demarrer-arreter-les-api">
<h3>Démarrer / arrêter les API<a class="headerlink" href="#demarrer-arreter-les-api" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Démarrer GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">geonature</span></code></p></li>
<li><p>Arrêter GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">stop</span> <span class="pre">geonature</span></code></p></li>
<li><p>Recharger GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">geonature</span></code></p></li>
<li><p>Redémarrer GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code></p></li>
<li><p>Vérifier l’état de GeoNature : <code class="docutils literal notranslate"><span class="pre">systemctl</span> <span class="pre">status</span> <span class="pre">geonature</span></code></p></li>
</ul>
</section>
<section id="supervision-des-services">
<h3>Supervision des services<a class="headerlink" href="#supervision-des-services" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Vérifier que l’application GeoNature est accessible en http</p></li>
<li><p>Vérifier que leurs services (API) sont lancés et fonctionnent correctement (tester les deux routes ci-dessous).</p>
<ul>
<li><p>Exemple de route locale pour tester l’API GeoNature : <a class="reference external" href="http://127.0.0.1:8000/occtax/defaultNomenclatures">http://127.0.0.1:8000/occtax/defaultNomenclatures</a> qui ne doit pas renvoyer de 404. URL absolue : <a class="reference external" href="https://urlgeonature/api/occtax/defaultNomenclatures">https://urlgeonature/api/occtax/defaultNomenclatures</a></p></li>
</ul>
</li>
<li><p>Vérifier que le fichier de logs de GeoNature n’est pas trop volumineux pour la capacité du serveur</p></li>
<li><p>Vérifier que les services nécessaires au fonctionnement de l’application tournent bien (Apache, PostgreSQL)</p></li>
</ul>
</section>
<section id="maintenance">
<h3>Maintenance<a class="headerlink" href="#maintenance" title="Lien vers cette rubrique">#</a></h3>
<p>Lors d’une opération de maintenance (montée en version, modification de la base de données…), vous pouvez rendre l’application momentanément indisponible.</p>
<p>Pour cela, désactivez la configuration Apache de GeoNature, puis activez la configuration du mode de maintenance :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo a2dissite geonature</span>
<span class="go">sudo a2ensite geonature_maintenance</span>
<span class="go">sudo apachectl restart</span>
</pre></div>
</div>
<p>A la fin de l’opération de maintenance, effectuer la manipulation inverse :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo a2dissite geonature_maintenance</span>
<span class="go">sudo a2ensite geonature</span>
<span class="go">sudo apachectl restart</span>
</pre></div>
</div>
<p>Attention : ne pas stopper le backend (des opérations en BDD en cours pourraient être corrompues)</p>
<ul>
<li><p>Redémarrage de PostgreSQL</p>
<p>Si vous effectuez des manipulations de PostgreSQL qui nécessitent un redémarrage du SGBD (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">postgresql</span> <span class="pre">restart</span></code>), il faut impérativement lancer un redémarrage de l’API GeoNature pour que celle-ci continue de fonctionner. Pour cela, lancez la commande <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">restart</span> <span class="pre">geonature</span></code> (GeoNature 2.8+).</p>
<p><strong>NB</strong>: Ne pas faire ces manipulations sans avertir les utilisateurs d’une perturbation temporaire des applications.</p>
</li>
</ul>
</section>
<section id="parametres-gunicorn">
<h3>Paramètres Gunicorn<a class="headerlink" href="#parametres-gunicorn" title="Lien vers cette rubrique">#</a></h3>
<p>Voici les paramètres de Gunicorn par défaut :</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_PROC_NAME=geonature</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_NUM_WORKERS=4</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_HOST=127.0.0.1</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_PORT=8000</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">GUNICORN_TIMEOUT=30</span></code></p></li>
</ul>
</div></blockquote>
<p>Pour modifier une de ces variables, créer un fichier <code class="docutils literal notranslate"><span class="pre">environ</span></code> à la racine de votre dossier GeoNature, et indiquer la variable d’environnement avec sa valeur modifiée.</p>
<p>Si vous souhaitez modifier de manière plus avancée la ligne de commande <code class="docutils literal notranslate"><span class="pre">gunicorn</span></code>, surcouchez le service systemd :</p>
<blockquote>
<div><ul>
<li><p>Lancez <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">edit</span> <span class="pre">geonature</span></code> ce qui va créer le fichier <code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/geonature.service.d/override.conf</span></code> et ouvrir un éditeur pour vous permettre de le modifier</p></li>
<li><p>Indiquez :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[Service]
ExecStart=
ExecStart=/path/to/venv/bin/unicorn geonature:create_app() …
</pre></div>
</div>
<p>Note : le premier <code class="docutils literal notranslate"><span class="pre">ExecStart</span></code> permet de réinitialiser la commande de lancement de gunicorn.</p>
</li>
</ul>
</div></blockquote>
</section>
</section>
<section id="sauvegarde-et-restauration">
<h2>Sauvegarde et restauration<a class="headerlink" href="#sauvegarde-et-restauration" title="Lien vers cette rubrique">#</a></h2>
<section id="sauvegarde">
<h3>Sauvegarde<a class="headerlink" href="#sauvegarde" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Sauvegarde de la base de données :</p></li>
</ul>
<p>Les sauvegardes de la BDD sont à faire avec l’utilisateur <code class="docutils literal notranslate"><span class="pre">postgres</span></code>. Commencer par créer un répertoire et lui donner des droits sur le répertoire où seront faites les sauvegardes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="c1"># Créer le répertoire pour stocker les sauvegardes</span>
<span class="gp">$ </span>mkdir<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup
<span class="gp">$ </span><span class="c1"># Ajouter l&#39;utilisateur postgres au groupe de l&#39;utilisateur linux courant pour qu&#39;il ait les droits d&#39;écrire dans les mêmes répertoires</span>
<span class="gp">$ </span>sudo<span class="w"> </span>adduser<span class="w"> </span>postgres<span class="w"> </span><span class="sb">`</span>whoami<span class="sb">`</span>
<span class="gp">$ </span><span class="c1"># ajout de droit aux groupes de l&#39;utilisateur courant sur le répertoire `backup`</span>
<span class="gp">$ </span>chmod<span class="w"> </span>g+rwx<span class="w"> </span>/home/<span class="sb">`</span>whoami<span class="sb">`</span>/backup
</pre></div>
</div>
<p>Connectez-vous avec l’utilisateur linux <code class="docutils literal notranslate"><span class="pre">postgres</span></code> pour lancer une sauvegarde de la BDD :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo su postgres</span>
<span class="go">pg_dump -Fc geonature2db  &gt; /home/`whoami`/backup/`date +%Y-%m-%d-%H:%M`-geonaturedb.backup</span>
<span class="go">exit</span>
</pre></div>
</div>
<p>Si la sauvegarde ne se fait pas, c’est qu’il faut revoir les droits du répertoire où sont faites les sauvegardes pour que l’utilisateur <code class="docutils literal notranslate"><span class="pre">postgres</span></code> puisse y écrire</p>
<p>Opération à faire régulièrement grâce à une tâche cron.</p>
<ul>
<li><p>Sauvegarde des fichiers de configuration :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /home/`whoami`/geonature/config</span>
<span class="go">tar -zcvf /home/`whoami`/backup/`date +%Y%m%d%H%M`-geonature_config.tar.gz ./</span>
</pre></div>
</div>
</li>
</ul>
<p>Opération à faire à chaque modification d’un paramètre de configuration.</p>
<ul>
<li><p>Sauvegarde des fichiers de customisation :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /home/`whoami`/geonature/custom</span>
<span class="go">tar -zcvf /home/`whoami`/`date +%Y%m%d%H%M`-geonature_custom.tar.gz ./</span>
</pre></div>
</div>
</li>
</ul>
<p>Opération à faire à chaque modification de la customisation de l’application.</p>
<ul>
<li><p>Sauvegarde des modules externes :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd /home/`whoami`/geonature/external_modules</span>
<span class="go">tar -zcvf /home/`whoami`/backup/`date +%Y%m%d%H%M`-external_modules.tar.gz ./</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="restauration">
<h3>Restauration<a class="headerlink" href="#restauration" title="Lien vers cette rubrique">#</a></h3>
<ul>
<li><p>Restauration de la base de données :</p>
<ul>
<li><p>Créer une base de données vierge (on part du principe que la base de données <code class="docutils literal notranslate"><span class="pre">geonature2db</span></code> n’existe pas ou plus). Sinon adaptez le nom de la BDD et également la configuration de connexion de l’application à la BDD dans <code class="docutils literal notranslate"><span class="pre">&lt;GEONATURE_DIRECTORY&gt;/config/geonature_config.toml</span></code></p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -n -u postgres -s createdb -O &lt;MON_USER&gt; geonature2db</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;postgis&quot;;&#39;</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;postgis_raster&quot;;&#39;  # postgis&gt;=3.0 (Debian 11)</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;hstore&quot;;&#39;</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;uuid-ossp&quot;;&#39;</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;pg_trgm&quot;;&#39;</span>
<span class="go">sudo -n -u postgres -s psql -d geonature2db -c &#39;CREATE EXTENSION IF NOT EXISTS &quot;unaccent&quot;;&#39;</span>
</pre></div>
</div>
</li>
<li><p>Restaurer la BDD à partir du backup</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo su postgres</span>
<span class="go">pg_restore -d geonature2db &lt;MY_BACKUP_DIRECTORY_PATH&gt;/201803150917-geonaturedb.backup</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Restauration de la configuration et de la customisation :</p>
<ul>
<li><p>Décompresser les fichiers précédemment sauvegardés pour les remettre au bon emplacement :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo rm &lt;GEONATURE_DIRECTORY&gt;/config/*</span>
<span class="go">cd &lt;GEONATURE_DIRECTORY&gt;/config</span>
<span class="go">sudo tar -zxvf &lt;MY_BACKUP_DIRECTORY&gt;/201803150953-geonature_config.tar.gz</span>

<span class="go">cd /home/&lt;MY_USER&gt;/geonature/custom</span>
<span class="go">rm -r &lt;MY_USER&gt;/geonature/custom/*</span>
<span class="go">tar -zxvf &lt;MY_BACKUP_DIRECTORY&gt;/201803150953-geonature_custom.tar.gz</span>

<span class="go">rm /home/&lt;MY_USER&gt;/geonature/external_modules/*</span>
<span class="go">cd &lt;GEONATURE_DIRECTORY&gt;/external_modules</span>
<span class="go">tar -zxvf &lt;MY_BACKUP_DIRECTORY&gt;/201803151036-external_modules.tar.gz</span>
</pre></div>
</div>
</li>
</ul>
</li>
<li><p>Relancer l’application GeoNature</p></li>
</ul>
</section>
</section>
<section id="customisation">
<h2>Customisation<a class="headerlink" href="#customisation" title="Lien vers cette rubrique">#</a></h2>
<p>Tous les fichiers par défaut présents dans le dossier <code class="docutils literal notranslate"><span class="pre">geonature/backend/static/</span></code> peuvent être surcouchés, en placant un fichier du même nom dans <code class="docutils literal notranslate"><span class="pre">geonature/custom/</span></code>.</p>
<section id="integrer-son-logo">
<h3>Intégrer son logo<a class="headerlink" href="#integrer-son-logo" title="Lien vers cette rubrique">#</a></h3>
<p>Le logo affiché dans la barre de navigation de GeoNature (<code class="docutils literal notranslate"><span class="pre">backend/static/images/logo_structure.png</span></code>) peut être surcouché dans le répertoire en placant le votre dans <code class="docutils literal notranslate"><span class="pre">custom/images/logo_structure.png</span></code>. Idem pour toutes les images présentes dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/images/</span></code>.</p>
</section>
<section id="customiser-le-contenu">
<h3>Customiser le contenu<a class="headerlink" href="#customiser-le-contenu" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Customiser le contenu de la page d’introduction :</p></li>
</ul>
<p>Le texte d’introduction, le titre et le pied de page de la page d’Accueil de GeoNature peuvent être modifiés à tout moment, sans réinstallation de l’application.</p>
<p>Pour cela, renseignez les paramètres dans le fichier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>) :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[HOME]</span>
<span class="w">    </span><span class="n">TITLE</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;Bienvenue dans GeoNature&quot;</span>
<span class="w">    </span><span class="n">INTRODUCTION</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
<span class="w">    </span><span class="n">FOOTER</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;&quot;</span>
</pre></div>
</div>
<p>Vous pouvez renseigner du code HTML sur plusieurs lignes dans ces paramètres, en le plaçant entre triple quote (<cite>« «  »&lt;b&gt;Hello&lt;/b&gt; » » »</cite>).</p>
</section>
<section id="customiser-la-page-de-connexion">
<h3>Customiser la page de connexion<a class="headerlink" href="#customiser-la-page-de-connexion" title="Lien vers cette rubrique">#</a></h3>
<p>Il est possible d’ajouter des liens vers des ressources externes sur la page de connexion de GeoNature. Pour cela,
remplissez un (ou plusieurs) item(s) <code class="docutils literal notranslate"><span class="pre">ACCOUNT_MANAGEMENT.EXTERNAL_LINKS</span></code> dans la configuration.
Dans cette variable, le lien est indiqué dans la propriété <code class="docutils literal notranslate"><span class="pre">url</span></code> et le texte affiché de ce dernier doit être renseigné dans le
propriété <code class="docutils literal notranslate"><span class="pre">label</span></code>. Un exemple est disponible ci-dessous.</p>
</section>
<section id="customiser-l-aspect-esthetique">
<h3>Customiser l’aspect esthétique<a class="headerlink" href="#customiser-l-aspect-esthetique" title="Lien vers cette rubrique">#</a></h3>
<p>Le rendu esthétique de GeoNature repose principalement sur l’utilisation de Boostrap.</p>
<p>Les couleurs de textes, couleurs de fonds, forme des boutons etc peuvent être adaptées en renseignant un fichier <code class="docutils literal notranslate"><span class="pre">custom/css/frontend.css</span></code> contenant votre surcouche des classes CSS de l’application.</p>
<p>Par exemple, pour remplacer la couleur de fond du bandeau de navigation par une image, on peut apporter la modification suivante :</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nt">html</span><span class="w"> </span><span class="nt">body</span><span class="w"> </span><span class="nt">pnx-root</span><span class="w"> </span><span class="nt">pnx-nav-home</span><span class="w"> </span><span class="nt">mat-sidenav-container</span><span class="p">.</span><span class="nc">sidenav-container</span><span class="p">.</span><span class="nc">mat-drawer-container</span><span class="p">.</span><span class="nc">mat-sidenav-container</span><span class="w"> </span><span class="nt">mat-sidenav-content</span><span class="p">.</span><span class="nc">mat-drawer-content</span><span class="p">.</span><span class="nc">mat-sidenav-content</span><span class="w"> </span><span class="nt">mat-toolbar</span><span class="p">#</span><span class="nn">app-toolbar</span><span class="p">.</span><span class="nc">row</span><span class="p">.</span><span class="nc">mat-toolbar</span>
<span class="p">{</span>
<span class="w">   </span><span class="k">background</span><span class="w"> </span><span class="p">:</span>
<span class="w">   </span><span class="nb">url</span><span class="p">(</span><span class="sx">../images/bandeau_test.jpg</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Dans ce cas, l’image <code class="docutils literal notranslate"><span class="pre">bandeau_test.jpg</span></code> doit se trouver dans le répertoire <code class="docutils literal notranslate"><span class="pre">custom/images</span></code>.</p>
<p>Autre exemple, il est possible personnaliser les polices ou les couleurs :</p>
<div class="highlight-css notranslate"><div class="highlight"><pre><span></span><span class="c">/* IMPORT POLICE BEBAS NEUE</span>
<span class="c">* ! Bebas Neue by @Ryoichi Tsunekawa</span>
<span class="c">* License - Open Font License</span>
<span class="c">*/</span>
<span class="p">@</span><span class="k">import</span><span class="w"> </span><span class="nt">url</span><span class="o">(</span><span class="s1">&#39;https://fonts.googleapis.com/css2?family=Bebas+Neue&amp;display=swap&#39;</span><span class="o">)</span><span class="p">;</span>
<span class="c">/* Couleurs principales de l&#39;application */</span>
<span class="p">.</span><span class="nc">color-blue</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#678BC5</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-orange</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#DEC70D</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-teal</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#A8DE0D</span><span class="cp">!important</span><span class="p">;</span>
<span class="p">}</span>
<span class="p">.</span><span class="nc">color-red</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">color</span><span class="p">:</span><span class="mh">#DE280D</span><span class="cp">!important</span>
<span class="p">}</span>
<span class="p">#</span><span class="nn">appName</span><span class="w"> </span><span class="nt">h3</span><span class="p">{</span>
<span class="w">  </span><span class="k">font-family</span><span class="p">:</span><span class="n">Bebas</span><span class="w"> </span><span class="n">Neue</span><span class="p">,</span><span class="n">Arial</span><span class="p">,</span><span class="kc">sans-serif</span><span class="cp">!important</span><span class="p">;</span>
<span class="w">  </span><span class="k">font-size</span><span class="p">:</span><span class="w"> </span><span class="kc">xx-large</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Certains paramètres demandent l’ajout de la mention <code class="docutils literal notranslate"><span class="pre">!important</span></code> pour être pris en compte (<a class="github reference external" href="https://github.com/PnX-SI/GeoNature/issues/2632">PnX-SI/GeoNature#2632</a>).</p>
</section>
<section id="customiser-les-noms-et-pictos-des-modules">
<h3>Customiser les noms et pictos des modules<a class="headerlink" href="#customiser-les-noms-et-pictos-des-modules" title="Lien vers cette rubrique">#</a></h3>
<p>Vous pouvez modifier l’intitulé et le pictogramme des modules dans le menu des modules. Pour cela, adaptez le contenu des champs <code class="docutils literal notranslate"><span class="pre">module_label</span></code> et <code class="docutils literal notranslate"><span class="pre">module_picto</span></code> (avec des icones de la librairie Font Awesome - <a class="reference external" href="https://fontawesome.com">https://fontawesome.com</a>) dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code> (aussi modifiable directement depuis le module « Admin »).</p>
<p>Exemple :</p>
<div class="highlight-SQL notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Module Occtax</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Occtax&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCTAX&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-map-marker&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCTAX&#39;</span><span class="p">;</span>
<span class="c1">-- Module Occhab</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Occhab&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCHAB&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-leaf&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;OCCHAB&#39;</span><span class="p">;</span>
<span class="c1">-- Module Import</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Import&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IMPORT&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-upload&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;IMPORT&#39;</span><span class="p">;</span>
<span class="c1">-- Module Export</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Export&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EXPORTS&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-download&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;EXPORTS&#39;</span><span class="p">;</span>
<span class="c1">-- Module Dashboard</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Dashboard&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DASHBOARD&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-bar-chart&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;DASHBOARD&#39;</span><span class="p">;</span>
<span class="c1">-- Module Validation</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Validation&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VALIDATION&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-check&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;VALIDATION&#39;</span><span class="p">;</span>
<span class="c1">-- Module Monitorings (Suivis)</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_label</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Suivis&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MONITORINGS&#39;</span><span class="p">;</span>
<span class="k">UPDATE</span><span class="w"> </span><span class="n">gn_commons</span><span class="p">.</span><span class="n">t_modules</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="n">module_picto</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;fa-eye&#39;</span><span class="w"> </span><span class="k">WHERE</span><span class="w"> </span><span class="n">module_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;MONITORINGS&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Depuis la version 2.5.0, il est aussi possible de customiser l’ordre des modules dans le menu, par ordre alphabétique par défaut, en renseignant le champs <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules.module_order</span></code>.</p>
</section>
<section id="customiser-les-exports-pdf">
<h3>Customiser les exports PDF<a class="headerlink" href="#customiser-les-exports-pdf" title="Lien vers cette rubrique">#</a></h3>
<p>Vous pouvez modifier le bandeau et le logo fournis par défaut dans les exports PDF en surcouchant les images <code class="docutils literal notranslate"><span class="pre">Bandeau_pdf.png</span></code> et <code class="docutils literal notranslate"><span class="pre">Logo_pdf.png</span></code> présentes dans le dossier <code class="docutils literal notranslate"><span class="pre">backend/static/images</span></code>, en placant les votres du même nom dans <code class="docutils literal notranslate"><span class="pre">custom/images</span></code>.</p>
<p>Le style des fichiers PDF est également customisable grâce au fichier « custom/css/metadata_pdf_custom.css », permettant de surcoucher les classes CSS du fichier <code class="docutils literal notranslate"><span class="pre">backend/static/css/metadata_pdf.css</span></code>. Par exemple, la classe <code class="docutils literal notranslate"><span class="pre">main-color</span></code> permet de changer la couleur des séparateurs (orange par défaut).</p>
</section>
</section>
<section id="integrer-des-donnees">
<h2>Intégrer des données<a class="headerlink" href="#integrer-des-donnees" title="Lien vers cette rubrique">#</a></h2>
<section id="referentiel-geographique">
<h3>Référentiel géographique<a class="headerlink" href="#referentiel-geographique" title="Lien vers cette rubrique">#</a></h3>
<p>GeoNature est fourni avec des données géographiques de base sur la métropole (MNT national à 250m et communes de métropole).</p>
<p><strong>1.</strong> Si vous souhaitez modifier le MNT pour mettre celui de votre territoire :</p>
<ul class="simple">
<li><p>Videz le contenu des tables <code class="docutils literal notranslate"><span class="pre">ref_geo.dem</span></code> et éventuellement <code class="docutils literal notranslate"><span class="pre">ref_geo.dem_vector</span></code></p></li>
<li><p>Uploadez le(s) fichier(s) du MNT sur le serveur</p></li>
<li><p>Suivez la procédure de chargement du MNT en l’adaptant :
* <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/1715cf31a75d_insert_ign_250m_bd_alti_in_dem.py">PnX-SI/GeoNature</a>
* <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/blob/master/backend/geonature/migrations/versions/87651375c2e8_vectorize_ign_bd_alti.py">PnX-SI/GeoNature</a></p></li>
</ul>
<p><em>TODO : Procédure à améliorer et simplifier : https://github.com/PnX-SI/GeoNature/issues/235</em></p>
<p>Si vous n’avez pas choisi d’intégrer le raster MNT national à 250m fourni par défaut lors de l’installation ou que vous souhaitez le remplacer, voici les commandes qui vous permettront de le faire.</p>
<p>Suppression du MNT par défaut (adapter le nom de la base de données : MYDBNAME).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;TRUNCATE TABLE ref_geo.dem;&quot;</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;TRUNCATE TABLE ref_geo.dem_vector;&quot;</span>
</pre></div>
</div>
<p>Placer votre propre fichier MNT (ou vos différents fichiers « dalles ») dans le répertoire <code class="docutils literal notranslate"><span class="pre">/tmp/geonature</span></code> (adapter le nom du fichier et son chemin ainsi que les paramètres en majuscule).</p>
<p>Pour utiliser celui proposé par défaut :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">wget --cache=off http://geonature.fr/data/ign/BDALTIV2_2-0_250M_ASC_LAMB93-IGN69_FRANCE_2017-06-21.zip -P /tmp/geonature</span>
<span class="go">unzip /tmp/geonature/BDALTIV2_2-0_250M_ASC_LAMB93-IGN69_FRANCE_2017-06-21.zip -d /tmp/geonature</span>
<span class="go">export PGPASSWORD=MYUSERPGPASS;raster2pgsql -s MYSRID -c -C -I -M -d -t 5x5 /tmp/geonature/BDALTIV2_250M_FXX_0098_7150_MNT_LAMB93_IGN69.asc ref_geo.dem|psql -h localhost -U MYPGUSER -d MYDBNAME</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;REINDEX INDEX ref_geo.dem_st_convexhull_idx;&quot;</span>
</pre></div>
</div>
<p>Si votre MNT source est constitué de plusieurs fichiers (dalles),
assurez vous que toutes vos dalles ont le même système de projection
et le même format de fichier (tiff, asc, ou img par exemple).
Après avoir chargé vos fichiers dans <code class="docutils literal notranslate"><span class="pre">tmp/geonature</span></code> (par exemple),
vous pouvez lancer la commande <code class="docutils literal notranslate"><span class="pre">export</span></code> en remplacant le nom des
fichiers par *.asc :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export PGPASSWORD=MYUSERPGPASS;raster2pgsql -s MYSRID -c -C -I -M -d -t 5x5 /tmp/geonature/*.asc ref_geo.dem|psql -h localhost -U MYPGUSER -d MYDBNAME</span>
</pre></div>
</div>
<p>Si vous souhaitez vectoriser le raster MNT pour de meilleures performances lors des calculs en masse de l’altitude à partir de la localisation des observations, vous pouvez le faire en lançant les commandes ci-dessous. Sachez que cela prendra du temps et beaucoup d’espace disque (2.8Go supplémentaires environ pour le fichier DEM France à 250m).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;INSERT INTO ref_geo.dem_vector (geom, val) SELECT (ST_DumpAsPolygons(rast)).* FROM ref_geo.dem;&quot;</span>
<span class="go">sudo -n -u postgres -s psql -d MYDBNAME -c &quot;REINDEX INDEX ref_geo.index_dem_vector_geom;&quot;</span>
</pre></div>
</div>
<p>Si <code class="docutils literal notranslate"><span class="pre">ref_geo.dem_vector</span></code> est remplie, cette table est utilisée pour le calcul de l’altitude à la place de la table <code class="docutils literal notranslate"><span class="pre">ref_geo.dem</span></code></p>
<p><strong>2.</strong> Si vous souhaitez modifier ou ajouter des zonages administratifs, réglementaires ou naturels :</p>
<ul class="simple">
<li><p>Vérifiez que leur type existe dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>, sinon ajoutez-les</p></li>
<li><p>Ajoutez vos zonages dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code> en faisant bien référence à un <code class="docutils literal notranslate"><span class="pre">id_type</span></code> de <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>. Vous pouvez faire cela en SQL ou en faisant des copier/coller de vos zonages directement dans QGIS</p></li>
<li><p>Pour les grilles et les communes, vous pouvez ensuite compléter leurs tables d’extension <code class="docutils literal notranslate"><span class="pre">ref_geo.li_grids</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_geo.li_municipalities</span></code>.</p></li>
</ul>
<p>Il est également possible de désactiver des éléments des référentiels géographiques sans les supprimer de la base, en passant la valeur de la colonne <code class="docutils literal notranslate"><span class="pre">enable</span></code> en <cite>false</cite> dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>.</p>
</section>
<section id="affichage-des-referentiels-geographiques-dans-geonature">
<h3>Affichage des référentiels géographiques dans GeoNature<a class="headerlink" href="#affichage-des-referentiels-geographiques-dans-geonature" title="Lien vers cette rubrique">#</a></h3>
<p>Il est possible de choisir les éléments des référentiels géographiques pouvant s’afficher sur les cartes. Par exemple si on souhaite modifier l’affichage des communes :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration par défaut :</span>
<span class="p">[[</span><span class="n">MAPCONFIG</span><span class="o">.</span><span class="n">REF_LAYERS</span><span class="p">]]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s2">&quot;COM&quot;</span> <span class="c1"># correspond à type_code de la couche ref_geo.bib_areas_types</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Communes&quot;</span> <span class="c1"># nom s&#39;affichant dans leafmap</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s2">&quot;area&quot;</span>
    <span class="n">activate</span> <span class="o">=</span> <span class="n">false</span> <span class="c1"># ne s&#39;affiche pas par défaut sur la carte</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">false</span><span class="p">,</span> <span class="n">fillOpacity</span> <span class="o">=</span> <span class="s2">&quot;0.0&quot;</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">2000</span><span class="p">}</span> <span class="c1"># nombre d&#39;éléments maximum pouvant être affichés</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Configuration modifiée</span>
<span class="p">[[</span><span class="n">MAPCONFIG</span><span class="o">.</span><span class="n">REF_LAYERS</span><span class="p">]]</span>
    <span class="n">code</span> <span class="o">=</span> <span class="s1">&#39;COM&#39;</span>
    <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;Limite de commune&#39;</span>
    <span class="nb">type</span> <span class="o">=</span> <span class="s1">&#39;area&#39;</span>
    <span class="n">activate</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">style</span> <span class="o">=</span> <span class="p">{</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;SlateGray&#39;</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="n">fillOpacity</span> <span class="o">=</span> <span class="s1">&#39;0.2&#39;</span><span class="p">,</span> <span class="n">weight</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">}</span>
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="n">limit</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">}</span>
</pre></div>
</div>
</section>
<section id="donnees-externes">
<h3>Données externes<a class="headerlink" href="#donnees-externes" title="Lien vers cette rubrique">#</a></h3>
<p>Il peut s’agir de données partenaires, de données historiques ou de données saisies dans d’autres outils.</p>
<p>2 possibilités s’offrent à vous :</p>
<ul class="simple">
<li><p>Créer un schéma dédié aux données pour les intégrer de manière complète et en extraire les DEE dans la Synthèse</p></li>
<li><p>N’intégrer que les DEE dans la Synthèse</p></li>
</ul>
<p>Nous présenterons ici la première solution qui est privilégiée pour disposer des données brutes mais aussi les avoir dans la Synthèse.</p>
<ul class="simple">
<li><p>Créer un JDD dédié (<code class="docutils literal notranslate"><span class="pre">gn_meta.t_datasets</span></code>) ou utilisez-en un existant. Eventuellement un CA si elles ne s’intègrent pas dans un CA déjà existant.</p></li>
<li><p>Ajouter une Source de données dans <code class="docutils literal notranslate"><span class="pre">gn_synthese.t_sources</span></code> ou utilisez en une existante.</p></li>
<li><p>Créer le schéma dédié à accueillir les données brutes.</p></li>
<li><p>Créer les tables nécessaires à accueillir les données brutes.</p></li>
<li><p>Intégrer les données dans ces tables (avec les fonctions de <code class="docutils literal notranslate"><span class="pre">gn_imports</span></code>, avec QGIS ou pgAdmin).</p></li>
<li><p>Pour alimenter la Synthèse à partir des tables sources, vous pouvez mettre en place des triggers (en s’inspirant de ceux de OccTax) ou bien faire une requête spécifique si les données sources ne sont plus amenées à évoluer.</p></li>
</ul>
<p>Pour des exemples plus précis, illustrées et commentées, vous pouvez consulter les 2 exemples d’import dans cette documentation (Import niveau et Import niveau 2).</p>
<p>Vous pouvez aussi vous inspirer des exemples avancés de migration des données de GeoNature V1 vers GeoNature V2 : <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/tree/master/data/migrations/v1tov2">PnX-SI/GeoNature</a></p>
<ul class="simple">
<li><p>Import depuis SICEN (ObsOcc) : <a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/sicen">PnX-SI/Ressources-techniques</a></p></li>
<li><p>Import depuis SERENA : <a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/serena">PnX-SI/Ressources-techniques</a></p></li>
<li><p>Import continu : <a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/tree/master/GeoNature/migration/generic">PnX-SI/Ressources-techniques</a></p></li>
<li><p>Import d’un CSV historique (Flavia) : <a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/2018-12-csv-vers-synthese-FLAVIA.sql">PnX-SI/Ressources-techniques</a></p></li>
</ul>
</section>
<section id="import-niveau-1">
<h3>IMPORT NIVEAU 1<a class="headerlink" href="#import-niveau-1" title="Lien vers cette rubrique">#</a></h3>
<p>Dans cet exemple, nous allons importer un fichier CSV (ou SHP) d’observations dans la base de données de GeoNature,
pour ensuite intégrer ces données dans la synthèse de GeoNature.</p>
<p>On utilisera le fichier d’exemple
<a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/import-basique/01-observations-faune-2008-2010.csv">PnX-SI/Ressources-techniques</a>.</p>
<section id="importer-la-donnee-source-dans-la-bdd-avec-qgis">
<h4>Importer la donnée source dans la BDD avec QGIS<a class="headerlink" href="#importer-la-donnee-source-dans-la-bdd-avec-qgis" title="Lien vers cette rubrique">#</a></h4>
<p>PS : Si vous utilisez un CSV, vous pouvez aussi utiliser la fonction <code class="docutils literal notranslate"><span class="pre">gn_imports.load_csv_file</span></code>.</p>
<p><strong>1.</strong> Connecter la BDD dans QGIS :</p>
<ul class="simple">
<li><p>QGIS</p></li>
<li><p>PostGIS / Clic droit / New connection</p></li>
<li><p>Nom / Hôte (IP) / Base de données (geonaturedb) / Authentification de base (utilisateur / mot de passe)</p></li>
<li><p>Parcourir les tables géométriques</p></li>
</ul>
<p>Si vous devez ouvrir les connexions externes à votre BDD,
voir la documentation <a class="github reference external" href="https://github.com/PnEcrins/GeoNature-atlas/blob/master/docs/installation.rst#acc%C3%A9der-%C3%A0-votre-bdd">PnEcrins/GeoNature-atlas</a></p>
<p><strong>2.</strong> Importer le fichier dans la BDD :</p>
<ul class="simple">
<li><p>Ouvrir SHP ou CSV dans QGIS</p></li>
<li><p>Bases de données / Gestionnaire de base de données</p></li>
<li><p>Sélectionner la BDD et son schéma</p></li>
<li><p>Importer une couche/un fichier</p></li>
<li><p>Choisir la couche à importer et définir le nom de table de destination</p></li>
</ul>
</section>
<section id="creer-les-metadonnees">
<h4>Créer les métadonnées<a class="headerlink" href="#creer-les-metadonnees" title="Lien vers cette rubrique">#</a></h4>
<p><strong>1.</strong> Ajouter une source (si elle n’existe pas déjà)</p>
<p>En l’ajoutant manuellement dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.t_sources</span></code> ou en SQL :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">t_sources</span><span class="p">(</span><span class="n">name_source</span><span class="p">,</span><span class="w"> </span><span class="n">desc_source</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="s1">&#39;Historique&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Données historiques intégrées manuellement dans la BDD&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p><strong>2.</strong> Ajouter un jeu de données (si il n’existe pas déja)</p>
<p>Avec l’admin de GeoNature, dans la BDD avec pgAdmin ou en SQL. Et avant ça un CA si il n’en existe pas déjà un auquel associer le JDD.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_meta</span><span class="p">.</span><span class="n">t_datasets</span><span class="p">(</span><span class="n">id_acquisition_framework</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_name</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_shortname</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_desc</span><span class="p">,</span><span class="w"> </span><span class="n">id_nomenclature_data_type</span><span class="p">,</span><span class="w"> </span><span class="n">keywords</span><span class="p">,</span><span class="w"> </span><span class="n">marine_domain</span><span class="p">,</span><span class="w"> </span><span class="n">terrestrial_domain</span><span class="p">,</span><span class="w"> </span><span class="n">active</span><span class="p">)</span>
<span class="k">VALUES</span>
<span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Données Faune 2008-2010&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Faune 2008-2010&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Données faune du PNE entre 2008 et 2010&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">326</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Faune, PNE&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">)</span>
</pre></div>
</div>
<p>Pour retrouver les valeurs d’un type de nomenclature, vous pouvez utiliser les vues qui les rendent plus lisibles.
Par exemple ici <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.v_data_typ</span></code>.
Ou bien l’Admin des nomenclatures disponible dans GeoNature.</p>
<p>Il est aussi possible d’utiliser les codes des nomenclatures pour retrouver leurs id (ceci étant variables d’une instance à l’autre),
en utilisant la fonction <code class="docutils literal notranslate"><span class="pre">ref_nomenclatures.get_id_nomenclature</span></code>.</p>
</section>
<section id="insertion-des-donnees-dans-la-synthese">
<h4>Insertion des données dans la Synthèse<a class="headerlink" href="#insertion-des-donnees-dans-la-synthese" title="Lien vers cette rubrique">#</a></h4>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">synthese</span><span class="p">(</span>
<span class="n">unique_id_sinp</span><span class="p">,</span>
<span class="n">id_source</span><span class="p">,</span>
<span class="n">id_dataset</span><span class="p">,</span>
<span class="n">id_nomenclature_obs_technique</span><span class="p">,</span>
<span class="n">count_min</span><span class="p">,</span>
<span class="n">count_max</span><span class="p">,</span>
<span class="n">cd_nom</span><span class="p">,</span>
<span class="n">nom_cite</span><span class="p">,</span>
<span class="n">altitude_min</span><span class="p">,</span>
<span class="n">altitude_max</span><span class="p">,</span>
<span class="n">the_geom_4326</span><span class="p">,</span>
<span class="n">the_geom_point</span><span class="p">,</span>
<span class="n">the_geom_local</span><span class="p">,</span>
<span class="n">date_min</span><span class="p">,</span>
<span class="n">date_max</span><span class="p">,</span>
<span class="n">observers</span><span class="p">,</span>
<span class="n">comments</span><span class="p">,</span>
<span class="n">last_action</span>
<span class="p">)</span>
<span class="w"> </span><span class="k">SELECT</span>
<span class="w">      </span><span class="n">uuid_generate_v4</span><span class="p">(),</span><span class="w"> </span><span class="c1">-- Attention, ne générez un UUID_SINP pour chaque obs que si vous êtes surs qu&#39;elles n&#39;en ont pas déjà un</span>
<span class="w">      </span><span class="mi">2</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_source</span><span class="p">,</span>
<span class="w">      </span><span class="mi">3</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_dataset</span><span class="p">,</span>
<span class="w">      </span><span class="k">CASE</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">critere</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Vu&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">ref_nomenclatures</span><span class="p">.</span><span class="n">get_id_nomenclature</span><span class="p">(</span><span class="s1">&#39;METH_OBS&#39;</span><span class="p">,</span><span class="s1">&#39;0&#39;</span><span class="p">))</span>
<span class="w">        </span><span class="k">WHEN</span><span class="w"> </span><span class="n">critere</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Entendu&#39;</span><span class="w"> </span><span class="k">THEN</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">ref_nomenclatures</span><span class="p">.</span><span class="n">get_id_nomenclature</span><span class="p">(</span><span class="s1">&#39;METH_OBS&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">))</span>
<span class="w">        </span><span class="k">ELSE</span><span class="w"> </span><span class="p">(</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;METH_OBS&#39;</span><span class="p">))</span>
<span class="w">      </span><span class="k">END</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_obs_meth</span><span class="p">,</span>
<span class="w">      </span><span class="n">effectif</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span>
<span class="w">      </span><span class="n">effectif</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span>
<span class="w">      </span><span class="n">cd_nom</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span>
<span class="w">      </span><span class="n">taxon_latin</span><span class="p">,</span>
<span class="w">      </span><span class="n">altitude</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span><span class="w"> </span><span class="c1">-- On pourrait calculer les valeurs manquantes avec la fonction ref_geo.fct_get_altitude_intersection</span>
<span class="w">      </span><span class="n">altitude</span><span class="p">::</span><span class="nb">integer</span><span class="p">,</span>
<span class="w">      </span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="ss">&quot;x_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;y_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">),</span><span class="mi">4326</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_4326</span><span class="p">,</span>
<span class="w">      </span><span class="n">ST_Centroid</span><span class="p">(</span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="ss">&quot;x_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;y_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">),</span><span class="mi">4326</span><span class="p">))</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_point</span><span class="p">,</span>
<span class="w">      </span><span class="n">ST_Transform</span><span class="p">(</span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">ST_MakePoint</span><span class="p">(</span><span class="ss">&quot;x_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">,</span><span class="w"> </span><span class="ss">&quot;y_WGS84&quot;</span><span class="p">::</span><span class="nb">numeric</span><span class="p">),</span><span class="mi">4326</span><span class="p">),</span><span class="mi">2154</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_local</span><span class="p">,</span>
<span class="w">      </span><span class="n">dateobs</span><span class="p">::</span><span class="nb">date</span><span class="p">,</span>
<span class="w">      </span><span class="n">dateobs</span><span class="p">::</span><span class="nb">date</span><span class="p">,</span>
<span class="w">      </span><span class="n">observateurs</span><span class="p">,</span>
<span class="w">      </span><span class="n">remarques</span><span class="p">,</span>
<span class="w">      </span><span class="s1">&#39;I&#39;</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">last_action</span><span class="w"> </span><span class="c1">-- code de la dernière action effectuée: Valeurs possibiles &#39;I&#39;: insert, &#39;U&#39;: update</span>
<span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">obs_faune_2008_2010</span>
<span class="w"> </span><span class="k">ORDER</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="n">dateobs</span>
<span class="p">;</span>
</pre></div>
</div>
<p>A creuser pour calculer les altitudes non renseignées :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">id_synthese</span><span class="p">,</span>
<span class="p">(</span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_altitude_intersection</span><span class="p">(</span><span class="n">the_geom_local</span><span class="p">)).</span><span class="n">altitude_min</span>
<span class="p">(</span><span class="n">ref_geo</span><span class="p">.</span><span class="n">fct_get_altitude_intersection</span><span class="p">(</span><span class="n">the_geom_local</span><span class="p">)).</span><span class="n">altitude_max</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">synthese</span>
<span class="k">LIMIT</span><span class="w"> </span><span class="mi">1000</span><span class="p">;</span>
</pre></div>
</div>
<p>Gil propose de rajouter une PK et de faire un lien entre les données de la table importée et celles dans la synthèse avec <code class="docutils literal notranslate"><span class="pre">entity_source_pk_value</span></code> :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Clé primaire</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">obs_faune_2008_2010</span>
<span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">gid</span><span class="w"> </span><span class="nb">serial</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">obs_faune_2008_2010</span>
<span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_obs_faune_2008_2010</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">gid</span><span class="p">);</span>
</pre></div>
</div>
<p>Ajouter le champ <code class="docutils literal notranslate"><span class="pre">entity_source_pk_value</span></code> dans ton INSERT et <code class="docutils literal notranslate"><span class="pre">gid</span></code> dans le SELECT.</p>
<p>On pourrait aussi remplir <code class="docutils literal notranslate"><span class="pre">cor_observers_synthese</span></code> si on le veut et si on a les observateurs présents dans les données,
en les faisant correspondre avec leurs <code class="docutils literal notranslate"><span class="pre">id_role</span></code>.</p>
<p>L’installation de GeoNature intègre les communes de toute la France métropolitaine. Pour alléger la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>, il peut être pertinent de supprimer les communes en dehors du territoire de travail. Par exemple, supprimer toutes les communes en dehors du département.</p>
<p>Pour retrouver le détail de toutes les communes du département Bouches-du-Rhône :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">ref_geo</span><span class="p">.</span><span class="n">l_areas</span><span class="w"> </span><span class="n">la</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">ref_geo</span><span class="p">.</span><span class="n">bib_areas_types</span><span class="w"> </span><span class="n">ba</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">id_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">la</span><span class="p">.</span><span class="n">id_type</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">ref_geo</span><span class="p">.</span><span class="n">li_municipalities</span><span class="w"> </span><span class="n">lm</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">id_area</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">la</span><span class="p">.</span><span class="n">id_area</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">ba</span><span class="p">.</span><span class="n">type_code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;COM&#39;</span><span class="w"> </span><span class="k">AND</span><span class="w"> </span><span class="n">lm</span><span class="p">.</span><span class="n">insee_dep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;13&#39;</span>
</pre></div>
</div>
<p>A utiliser dans une requête de suppression, en gérant les cascades entre les tables.</p>
</section>
<section id="insertion-depuis-un-shapefile">
<h4>Insertion depuis un shapefile<a class="headerlink" href="#insertion-depuis-un-shapefile" title="Lien vers cette rubrique">#</a></h4>
<p>L’exercice est similaire si on part depuis un fichier Shape
(<a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/import-basique/01-observations-faune-2008-2010-SHP.zip">PnX-SI/Ressources-techniques</a>)</p>
<p>La seule différence est que la géométrie est calculée lors de l’import de QGIS vers PostGIS.</p>
<p>Ainsi la partie Géométrie de la requête d’insertion dans la Synthèse serait :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">ST_Transform</span><span class="p">(</span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="mi">2154</span><span class="p">),</span><span class="mi">4326</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_4326</span><span class="p">,</span>
<span class="n">ST_Centroid</span><span class="p">(</span><span class="n">ST_SetSRID</span><span class="p">(</span><span class="n">geom</span><span class="p">,</span><span class="mi">2154</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_point</span><span class="p">,</span>
<span class="n">geom</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">the_geom_local</span><span class="p">,</span>
</pre></div>
</div>
</section>
</section>
<section id="import-niveau-2">
<h3>IMPORT NIVEAU 2<a class="headerlink" href="#import-niveau-2" title="Lien vers cette rubrique">#</a></h3>
<section id="description">
<h4>Description<a class="headerlink" href="#description" title="Lien vers cette rubrique">#</a></h4>
<p>L’exercice consiste à importer le fichier
<a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/GeoNature/V2/import-avance/observations.csv">PnX-SI/Ressources-techniques</a> dans GeoNature V2.</p>
<p>1 - On charge le fichier CSV dans une table de la base de données.</p>
<p>2 - On prépare la table importée (FK et typage des champs si besoin).</p>
<p>3 - On créé les métadonnées pour que GeoNature sache identifier les nouvelles données.</p>
<p>4 - On mappe les champs de la table d’import avec ceux de la synthèse.</p>
<blockquote>
<div><p>Pour cela on utilise une fonction dédiée qui nous prépare le travail. Il ne reste plus qu’à finaliser le mapping (la fonction ne peut pas tout deviner).</p>
</div></blockquote>
<p>5 - On crée la requête d’import.</p>
<blockquote>
<div><p>Pour cela on utilise une fonction dédiée qui nous prépare le travail. On adapte la requête produite par la fonction.</p>
</div></blockquote>
<p>6 - On importe les données en synthèse.</p>
<p>7 - On gère les nouveaux taxons vis à vis la saisie.</p>
<p>8 - On archive la table où on veut.</p>
</section>
<section id="import-du-fichier-csv">
<h4>1 - Import du fichier CSV<a class="headerlink" href="#import-du-fichier-csv" title="Lien vers cette rubrique">#</a></h4>
<p>Cette action doit être faite par un superuser PostgreSQL.</p>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Le fichier CSV doit être présent localement sur le serveur hébergeant la base de données.</p></li>
<li><p>Il fichier doit être encodé en UTF-8 et la première ligne doit comporter le nom des champs.</p></li>
<li><p>Le séparateur de champs doit être le point-virgule.</p></li>
<li><p>La fonction utilise la fonction <code class="docutils literal notranslate"><span class="pre">COPY</span></code> capable de lire le système de fichier du serveur. Pour des raisons de sécurité, cette fonction <code class="docutils literal notranslate"><span class="pre">COPY</span></code> n’est accessible qu’aux superutilisateurs. Vous devez donc disposer d’un accès superutilisateur PostgreSQL pour utiliser cette fonction d’import. Si l’utilisateur connecté à la base dans pgAdmin n’est pas superuser, on peut le faire dans psql.</p></li>
</ul>
</dd>
</dl>
<p>DANS UN TERMINAL :</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>su<span class="w"> </span>postgres
psql<span class="w"> </span>-d<span class="w"> </span>geonature2db
</pre></div>
</div>
<p>Dans les 2 cas, copier-coller les 2 commandes ci-dessous en adaptant les chemins et l’utilisateur.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">load_csv_file</span><span class="p">(</span><span class="s1">&#39;/home/myuser/imports/observations.csv&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">);</span>
<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span><span class="w"> </span><span class="k">OWNER</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">geonatuser</span><span class="p">;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Attention : si la table existe, elle est supprimée et recréée à partir du CSV fourni.</p></li>
<li><p>La fonction créé la table et sa structure dans le schéma et la table fournie en paramètre.</p></li>
<li><p>Le contenu du fichier CSV est chargé dans la table (initialement toutes les colonnes sont de type <code class="docutils literal notranslate"><span class="pre">text</span></code>).</p></li>
<li><p>La function tente ensuite d’identifier et de modifier le type de chacune des colonnes à partir du contenu et seuls les types <code class="docutils literal notranslate"><span class="pre">integer</span></code>, <code class="docutils literal notranslate"><span class="pre">real</span></code>, et <code class="docutils literal notranslate"><span class="pre">date</span></code> sont actuellement reconnus.</p></li>
<li><p>Si vous devez modifier manuellement le type d’une colonne, vous pouvez vous inspirer du code ci-dessous.</p></li>
</ul>
</dd>
</dl>
</section>
<section id="preparation-de-la-nouvelle-table-contenant-les-donnees-importees">
<h4>2 - Préparation de la nouvelle table contenant les données importées<a class="headerlink" href="#preparation-de-la-nouvelle-table-contenant-les-donnees-importees" title="Lien vers cette rubrique">#</a></h4>
<p><strong>Ajouter une clé primaire sur la table importée</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span><span class="w"> </span><span class="k">ADD</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id_data</span><span class="p">);</span>
</pre></div>
</div>
<p>Si la table ne comporte pas de champ permettant une identification unique des observations :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span>
<span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">gid</span><span class="w"> </span><span class="nb">serial</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span>
<span class="w">  </span><span class="k">ADD</span><span class="w"> </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">pk_testimport</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="p">(</span><span class="n">gid</span><span class="p">);</span>
</pre></div>
</div>
<p><strong>Si besoin de mettre à jour le type de certains champs de la table importée</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">monschema</span><span class="p">.</span><span class="n">matable</span><span class="w"> </span><span class="k">ALTER</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">macolonne</span><span class="w"> </span><span class="k">TYPE</span><span class="w"> </span><span class="n">montype</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">macolonne</span><span class="p">::</span><span class="n">montype</span><span class="p">;</span>
</pre></div>
</div>
<p>En l’état vos données sont importées et stockées dans la base GeoNature. Cependant GeoNature ne connait pas ces données. Pour qu’elles soient utilisables, au moins en consultation, vous devez fournir à l’application GeoNature un certain nombre d’informations concernant ces données et à minima les importer dans la synthèse. Vous pouvez également les importer dans un autre module, comme « Occtax » (non abordé dans cet exemple).</p>
</section>
<section id="creation-des-metadonnees">
<h4>3 - Création des métadonnées<a class="headerlink" href="#creation-des-metadonnees" title="Lien vers cette rubrique">#</a></h4>
<p>Il est nécessaire de rattacher les données importées à un jeu de données qui doit appartenir à un cadre d’acquisition. Si ceux-ci n’ont pas encore été créés dans la base, vous devez le faire dans <code class="docutils literal notranslate"><span class="pre">gn_meta.t_acquisition_frameworks</span></code> pour le cadre d’acquisition et dans <code class="docutils literal notranslate"><span class="pre">gn_meta.t_datasets</span></code> pour le jeu de données. Vous pouvez pour cela utiliser les formulaires disponibles dans l’interface d’aministration de GeoNature : <a class="reference external" href="http://myurl/geonature/#/admin">http://myurl/geonature/#/admin</a></p>
<p>Le jeu de données doit être rattaché à un protocole décrivant la manière dont les données ont été collectées.</p>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><p>Noter les ID retournés lors des insertions.</p>
</dd>
</dl>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_meta</span><span class="p">.</span><span class="n">sinp_datatype_protocols</span><span class="w"> </span><span class="p">(</span><span class="w"> </span><span class="n">protocol_name</span><span class="p">,</span><span class="w"> </span><span class="n">protocol_desc</span><span class="p">,</span><span class="w"> </span><span class="n">id_nomenclature_protocol_type</span><span class="p">,</span><span class="w"> </span><span class="n">protocol_url</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;ATBI&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Inventaire ATBI Dans la réserve de Lauvitel - Date_debut : 2013-01-01 - Date_fin : 3000-01-01&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">395</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">)</span><span class="w"> </span><span class="n">returning</span><span class="w"> </span><span class="n">id_protocol</span><span class="p">;</span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_meta</span><span class="p">.</span><span class="n">t_datasets</span><span class="p">(</span><span class="n">id_acquisition_framework</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_name</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_shortname</span><span class="p">,</span><span class="w"> </span><span class="n">dataset_desc</span><span class="p">,</span><span class="w"> </span><span class="n">id_nomenclature_data_type</span><span class="p">,</span><span class="w"> </span><span class="n">keywords</span><span class="p">,</span><span class="w"> </span><span class="n">marine_domain</span><span class="p">,</span><span class="w"> </span><span class="n">terrestrial_domain</span><span class="p">,</span><span class="w"> </span><span class="n">active</span><span class="p">)</span>
<span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Observations Flavia 2017&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Observations Flavia 2017&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Données ATBI Flavia pour l&#39;&#39;année 2017&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">326</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Invertébrés, PNE, ATBI&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">FALSE</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">,</span><span class="w"> </span><span class="k">TRUE</span><span class="p">)</span><span class="w"> </span><span class="n">returning</span><span class="w"> </span><span class="n">id_dataset</span><span class="p">;</span>
</pre></div>
</div>
<p>Il est également nécessaire, pour la synthese, de lui indiquer où sont stockées les données qu’elle contient et comment y accèder. Vous devez pour cela disposer d’une source de données dans <code class="docutils literal notranslate"><span class="pre">gn_synthese.t_sources</span></code> correspondant aux données à importer. Pour l’exemple nous allons créer une source de données avec la commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">t_sources</span><span class="p">(</span><span class="n">name_source</span><span class="p">,</span><span class="w"> </span><span class="n">desc_source</span><span class="p">)</span>
<span class="k">VALUES</span><span class="p">(</span><span class="s1">&#39;ATBI&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Données d&#39;&#39;inventaire ATBI&#39;</span><span class="p">)</span><span class="w"> </span><span class="n">returning</span><span class="w"> </span><span class="n">id_source</span><span class="p">;</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>D’autres valeurs sont attendues mais pour l’exercice, le fichier source utilise des valeurs insérée à titre d’exemple lors de la création de la base GeoNature.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id_role</span></code> 3 et 4 dans <code class="docutils literal notranslate"><span class="pre">utilisateurs.t_roles</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">id_organisme</span></code> 1 dans <code class="docutils literal notranslate"><span class="pre">utilisateurs.bib_organismes</span></code></p></li>
</ul>
</dd>
<dt class="field-even">notes<span class="colon">:</span></dt>
<dd class="field-even"><p>Il est possible d’utiliser ce mécanisme générique pour insérer des données de n’importe quelle table vers n’importe quelle autre, à partir du moment où il est possible d’établir un mapping cohérent entre les champs et notamment que les types puissent correspondre ou soient « transtypables ».</p>
</dd>
</dl>
</section>
<section id="creation-du-mapping-source-cible">
<h4>4 - Création du mapping (source –&gt; cible)<a class="headerlink" href="#creation-du-mapping-source-cible" title="Lien vers cette rubrique">#</a></h4>
<p>Le schéma gn_imports comporte trois tables permettant de préparer le mapping des champs entre la table importée (source) et une table de destination (target).</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">gn_imports.matching_tables</span></code> permet de déclarer la table source et la table de destination. Noter le <code class="docutils literal notranslate"><span class="pre">id_matching_table</span></code> généré par la séquence lors de l’insertion d’un nouveau « matching » dans cette table.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_imports.matching_fields</span></code> permet de faire le matching entre les champs de la table source et de la table de destination. Vous devez indiquer le type de chacun des champs de la table de destination ainsi que le <code class="docutils literal notranslate"><span class="pre">id_matching_table</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">gn_imports.matching_geoms</span></code> permet de préparer la création du geom dans la table de destination à partir du ou des champs constituant le geom fourni dans la table source : champs contenant les x et y pour un format <code class="docutils literal notranslate"><span class="pre">xy</span></code> ou le champ comportant le wkt pour le format <code class="docutils literal notranslate"><span class="pre">wkt</span></code>.</p></li>
</ul>
<p>En attendant la création d’une interface permettant de faciliter l’import, vous devez remplir ces tables manuellement. Cependant, la fonction <code class="docutils literal notranslate"><span class="pre">gn_imports.fct_generate_mapping('table_source',</span> <span class="pre">'table_cible',</span> <span class="pre">forcedelete)</span></code> permet de pré-générer un mapping.</p>
<p>Si le mapping source/cible existe, la fonction ne fait rien et un message d’erreur est levé. Si le mapping n’existe pas ou si le paramètre <code class="docutils literal notranslate"><span class="pre">forcedelete</span> <span class="pre">(boolean</span> <span class="pre">default</span> <span class="pre">=</span> <span class="pre">false)</span></code> est à <code class="docutils literal notranslate"><span class="pre">true</span></code>, la fonction crée le mapping en remplissant la table <code class="docutils literal notranslate"><span class="pre">gn_imports.matching_tables</span></code> et la table``gn_imports.matching_fields`` avec une ligne par champ de la table cible. Il ne vous reste plus qu’à manuellement supprimer ou remplacer les valeurs “replace me” dans le champs source_field ou les valeurs par défaut proposées par la fonction.</p>
<p><strong>Pré-générer les champs à mapper</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_matching</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.synthese&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_matching</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.cor_observer_synthese&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>OU si besoin d’écraser un mapping des champs existants</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_matching</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.synthese&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_matching</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.cor_observer_synthese&#39;</span><span class="p">,</span><span class="k">true</span><span class="p">);</span>
</pre></div>
</div>
<p>IL FAUT ICI METTRE A JOUR LA TABLE <code class="docutils literal notranslate"><span class="pre">gn_imports_matching_fields</span></code> pour établir manuellement la correspondance des champs entre la table source et la table cible (voir le mapping final pour le fichier CSV fourni en exemple à la fin de cette page).</p>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p>Au moins un des 2 champs <code class="docutils literal notranslate"><span class="pre">source_field</span></code> ou <code class="docutils literal notranslate"><span class="pre">source_default_value</span></code> doit être renseigné.</p></li>
<li><p>Si le champ <code class="docutils literal notranslate"><span class="pre">source_field</span></code> est renseigné, le champ <code class="docutils literal notranslate"><span class="pre">source_default_value</span></code> est ignoré.</p></li>
</ul>
</dd>
</dl>
<p>Une fois que le mapping est renseigné, vous pouvez passer à l’étape suivante.</p>
</section>
<section id="construire-la-requete-d-import">
<h4>5 - Construire la requête d’import<a class="headerlink" href="#construire-la-requete-d-import" title="Lien vers cette rubrique">#</a></h4>
<p>Attention, pgAdmin va tronquer le résultat. Pour obtenir l’ensemble de la requête utiliser le bouton d’export du résultat dans un fichier ou executé la requête avec psql.</p>
<p><strong>Génération de la requête d’import dans les tables de destination</strong></p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_import_query</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.synthese&#39;</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">fct_generate_import_query</span><span class="p">(</span><span class="s1">&#39;gn_imports.testimport&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.cor_observer_synthese&#39;</span><span class="p">);</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">notes<span class="colon">:</span></dt>
<dd class="field-odd"><p>UTILISER LE BOUTON D’EXPORT DU RESULTAT DE LA REQUETE DE PGADMIN ou utiliser psql.
IL EST NECESSAIRE D’ADAPTER LA REQUETE SI BESOIN DE FAIRE DES JOIN POUR RECUPERER DES VALEURS DANS D’AUTRES TABLES</p>
</dd>
</dl>
</section>
<section id="chargement-des-donnees-dans-la-table-de-destination-synthese-ici">
<h4>6 - Chargement des données dans la table de destination (synthese ici)<a class="headerlink" href="#chargement-des-donnees-dans-la-table-de-destination-synthese-ici" title="Lien vers cette rubrique">#</a></h4>
<p>Voir la requête d’import en synthèse à la fin de cette page.</p>
</section>
<section id="deplacement-de-la-table-importee-facultatif">
<h4>7 - Déplacement de la table importée (facultatif)<a class="headerlink" href="#deplacement-de-la-table-importee-facultatif" title="Lien vers cette rubrique">#</a></h4>
<p>On peut si on le souhaite déplacer la table vers une destination d’archivage</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span><span class="w"> </span><span class="k">SET</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">schema_destination</span><span class="p">;</span>
</pre></div>
</div>
<p>On peut la mettre dans le schéma gn_exports pour l’exercice afin de tester mais ce n’est pas sa vocation.</p>
</section>
<section id="resultat-final">
<h4>RESULTAT FINAL<a class="headerlink" href="#resultat-final" title="Lien vers cette rubrique">#</a></h4>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">--DELETE FROM gn_imports.matching_fields WHERE id_matching_table IN (1,2);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">207</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;uuid_generate_v4()&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unique_id_sinp&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;uuid&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">208</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;uuid_generate_v4()&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;unique_id_sinp_grp&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;uuid&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">219</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;PREUVE_EXIST&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_exist_proof&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">210</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;entity_source_pk_value&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">211</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_lot&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_dataset&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">209</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_source&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_source&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">213</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;TYP_GRP&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_grp_typ&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">212</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;NAT_OBJ_GEO&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_geo_object_nature&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">214</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;METH_OBS&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_obs_meth&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">215</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;TECHNIQUE_OBS&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_obs_technique&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">217</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;ETA_BIO&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_bio_condition&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">216</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;STATUT_BIO&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_bio_status&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">218</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;NATURALITE&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_naturalness&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">220</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;STATUT_VALID&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_valid_status&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">221</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;NIV_PRECIS&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_diffusion_level&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">223</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;SEXE&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_sex&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">222</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;STADE_VIE&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_life_stage&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">224</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;OBJ_DENBR&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_obj_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">226</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;SENSIBILITE&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_sensitivity&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">225</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;TYP_DENBR&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_type_count&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">227</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;STATUT_OBS&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_observation_status&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">228</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;DEE_FLOU&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_blurring&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">230</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;TYP_INF_GEO&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_info_geo_type&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">229</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;STATUT_SOURCE&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_source_status&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">233</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cd_nom&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;cd_nom&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">237</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;digital_proof&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">238</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;non_digital_proof&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">239</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;altitude_retenue&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;altitude_min&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">240</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;altitude_retenue&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;altitude_max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">244</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dateobs&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;date_min&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp without time zone&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">245</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;dateobs&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;date_max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp without time zone&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">246</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;validator&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">248</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;observers&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">247</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;NULL&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;validation_comment&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">250</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_synthese.get_default_nomenclature_value(&#39;&#39;METH_DETERMIN&#39;&#39;::character varying)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_nomenclature_determination_method&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">252</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;now()&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meta_validation_date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp without time zone&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">253</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;now()&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meta_create_date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp without time zone&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">254</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;now()&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meta_update_date&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;timestamp without time zone&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">255</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;&#39;&#39;c&#39;&#39;&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;last_action&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">235</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;gn_commons.get_default_parameter(&#39;&#39;taxref_version&#39;&#39;,NULL)::character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;meta_v_taxref&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">251</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;remarques&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;comments&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;text&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">231</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;effectif_total&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;count_min&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">232</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;effectif_total&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;count_max&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">258</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;taxon_saisi&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;nom_cite&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">249</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;u.nom_role || &#39;&#39; &#39;&#39; || u.prenom_role&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;determiner&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">234</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;taxon_saisi&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;nom_cite&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;character varying&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">256</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_data&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;entity_source_pk_value&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_fields</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_default_value</span><span class="p">,</span><span class="w"> </span><span class="n">target_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_field_type</span><span class="p">,</span><span class="w"> </span><span class="n">field_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">257</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;observateurs&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;id_role&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;integer&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_geoms</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_geom</span><span class="p">,</span><span class="w"> </span><span class="n">source_x_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_y_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_format</span><span class="p">,</span><span class="w"> </span><span class="n">source_srid</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_srid</span><span class="p">,</span><span class="w"> </span><span class="n">geom_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2154</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;the_geom_local&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2154</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_geoms</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_geom</span><span class="p">,</span><span class="w"> </span><span class="n">source_x_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_y_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_format</span><span class="p">,</span><span class="w"> </span><span class="n">source_srid</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_srid</span><span class="p">,</span><span class="w"> </span><span class="n">geom_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;POINT(6.064544 44.28787)&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;wkt&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;the_geom_4326&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">matching_geoms</span><span class="w"> </span><span class="p">(</span><span class="n">id_matching_geom</span><span class="p">,</span><span class="w"> </span><span class="n">source_x_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_y_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">source_geom_format</span><span class="p">,</span><span class="w"> </span><span class="n">source_srid</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_field</span><span class="p">,</span><span class="w"> </span><span class="n">target_geom_srid</span><span class="p">,</span><span class="w"> </span><span class="n">geom_comments</span><span class="p">,</span><span class="w"> </span><span class="n">id_matching_table</span><span class="p">)</span><span class="w"> </span><span class="k">VALUES</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;xy&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;the_geom_point&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">,</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>

<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">setval</span><span class="p">(</span><span class="s1">&#39;gn_imports.matching_fields_id_matching_field_seq&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">258</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">setval</span><span class="p">(</span><span class="s1">&#39;gn_imports.matching_geoms_id_matching_geom_seq&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>
<span class="k">SELECT</span><span class="w"> </span><span class="n">pg_catalog</span><span class="p">.</span><span class="n">setval</span><span class="p">(</span><span class="s1">&#39;gn_imports.matching_tables_id_matching_table_seq&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="k">true</span><span class="p">);</span>

<span class="c1">---------------</span>
<span class="c1">--IMPORT DATA--</span>
<span class="c1">---------------</span>
<span class="c1">--autogenerated query by</span>
<span class="c1">--SELECT gn_imports.fct_generate_import_query(&#39;gn_imports.testimport&#39;, &#39;gn_synthese.cor_observer_synthese&#39;);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">synthese</span><span class="p">(</span>
<span class="n">unique_id_sinp</span>
<span class="p">,</span><span class="n">unique_id_sinp_grp</span>
<span class="p">,</span><span class="n">id_nomenclature_exist_proof</span>
<span class="p">,</span><span class="n">entity_source_pk_value</span>
<span class="p">,</span><span class="n">id_dataset</span>
<span class="p">,</span><span class="n">id_source</span>
<span class="p">,</span><span class="n">id_nomenclature_grp_typ</span>
<span class="p">,</span><span class="n">id_nomenclature_geo_object_nature</span>
<span class="p">,</span><span class="n">id_nomenclature_obs_meth</span>
<span class="p">,</span><span class="n">id_nomenclature_obs_technique</span>
<span class="p">,</span><span class="n">id_nomenclature_bio_condition</span>
<span class="p">,</span><span class="n">id_nomenclature_bio_status</span>
<span class="p">,</span><span class="n">id_nomenclature_naturalness</span>
<span class="p">,</span><span class="n">id_nomenclature_valid_status</span>
<span class="p">,</span><span class="n">id_nomenclature_diffusion_level</span>
<span class="p">,</span><span class="n">id_nomenclature_sex</span>
<span class="p">,</span><span class="n">id_nomenclature_life_stage</span>
<span class="p">,</span><span class="n">id_nomenclature_obj_count</span>
<span class="p">,</span><span class="n">id_nomenclature_sensitivity</span>
<span class="p">,</span><span class="n">id_nomenclature_type_count</span>
<span class="p">,</span><span class="n">id_nomenclature_observation_status</span>
<span class="p">,</span><span class="n">id_nomenclature_blurring</span>
<span class="p">,</span><span class="n">id_nomenclature_info_geo_type</span>
<span class="p">,</span><span class="n">id_nomenclature_source_status</span>
<span class="p">,</span><span class="n">cd_nom</span>
<span class="p">,</span><span class="n">digital_proof</span>
<span class="p">,</span><span class="n">non_digital_proof</span>
<span class="p">,</span><span class="n">altitude_min</span>
<span class="p">,</span><span class="n">altitude_max</span>
<span class="p">,</span><span class="n">date_min</span>
<span class="p">,</span><span class="n">date_max</span>
<span class="p">,</span><span class="k">validator</span>
<span class="p">,</span><span class="n">observers</span>
<span class="p">,</span><span class="n">validation_comment</span>
<span class="p">,</span><span class="n">id_nomenclature_determination_method</span>
<span class="p">,</span><span class="n">meta_validation_date</span>
<span class="p">,</span><span class="n">meta_create_date</span>
<span class="p">,</span><span class="n">meta_update_date</span>
<span class="p">,</span><span class="n">last_action</span>
<span class="p">,</span><span class="n">meta_v_taxref</span>
<span class="p">,</span><span class="n">comments</span>
<span class="p">,</span><span class="n">count_min</span>
<span class="p">,</span><span class="n">count_max</span>
<span class="p">,</span><span class="n">nom_cite</span>
<span class="p">)</span>
<span class="k">SELECT</span>
<span class="n">uuid_generate_v4</span><span class="p">()::</span><span class="n">uuid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unique_id_sinp</span>
<span class="p">,</span><span class="n">uuid_generate_v4</span><span class="p">()::</span><span class="n">uuid</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">unique_id_sinp_grp</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;PREUVE_EXIST&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_exist_proof</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">id_data</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">entity_source_pk_value</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">id_lot</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_dataset</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">id_source</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_source</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;TYP_GRP&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_grp_typ</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;NAT_OBJ_GEO&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_geo_object_nature</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;METH_OBS&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_obs_meth</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;TECHNIQUE_OBS&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_obs_technique</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;ETA_BIO&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_bio_condition</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;STATUT_BIO&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_bio_status</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;NATURALITE&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_naturalness</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;STATUT_VALID&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_valid_status</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;NIV_PRECIS&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_diffusion_level</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;SEXE&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_sex</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;STADE_VIE&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_life_stage</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;OBJ_DENBR&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_obj_count</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;SENSIBILITE&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_sensitivity</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;TYP_DENBR&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_type_count</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;STATUT_OBS&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_observation_status</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;DEE_FLOU&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_blurring</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;TYP_INF_GEO&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_info_geo_type</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;STATUT_SOURCE&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_source_status</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">cd_nom</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">cd_nom</span>
<span class="p">,</span><span class="k">NULL</span><span class="p">::</span><span class="nb">text</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">digital_proof</span>
<span class="p">,</span><span class="k">NULL</span><span class="p">::</span><span class="nb">text</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">non_digital_proof</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">altitude_retenue</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">altitude_min</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">altitude_retenue</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">altitude_max</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">dateobs</span><span class="p">::</span><span class="k">timestamp</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">date_min</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">dateobs</span><span class="p">::</span><span class="k">timestamp</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">date_max</span>
<span class="p">,</span><span class="k">NULL</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="k">validator</span>
<span class="p">,</span><span class="k">NULL</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">observers</span>
<span class="p">,</span><span class="k">NULL</span><span class="p">::</span><span class="nb">text</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">validation_comment</span>
<span class="p">,</span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">get_default_nomenclature_value</span><span class="p">(</span><span class="s1">&#39;METH_DETERMIN&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">)::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_nomenclature_determination_method</span>
<span class="p">,</span><span class="n">now</span><span class="p">()::</span><span class="k">timestamp</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">meta_validation_date</span>
<span class="p">,</span><span class="n">now</span><span class="p">()::</span><span class="k">timestamp</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">meta_create_date</span>
<span class="p">,</span><span class="n">now</span><span class="p">()::</span><span class="k">timestamp</span><span class="w"> </span><span class="k">without</span><span class="w"> </span><span class="k">time</span><span class="w"> </span><span class="k">zone</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">meta_update_date</span>
<span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">last_action</span>
<span class="p">,</span><span class="n">gn_commons</span><span class="p">.</span><span class="n">get_default_parameter</span><span class="p">(</span><span class="s1">&#39;taxref_version&#39;</span><span class="p">,</span><span class="k">NULL</span><span class="p">)::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="p">::</span><span class="nb">character</span><span class="w"> </span><span class="nb">varying</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">meta_v_taxref</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">remarques</span><span class="p">::</span><span class="nb">text</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">comments</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">effectif_total</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_min</span>
<span class="p">,</span><span class="n">a</span><span class="p">.</span><span class="n">effectif_total</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">count_max</span>
<span class="p">,</span><span class="n">taxon_saisi</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span><span class="w"> </span><span class="n">a</span>
<span class="p">;</span>

<span class="c1">--autogenerated query by</span>
<span class="c1">--SELECT gn_imports.fct_generate_import_query(&#39;gn_imports.testimport&#39;, &#39;gn_synthese.cor_observer_synthese&#39;);</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">cor_observer_synthese</span><span class="p">(</span>
<span class="n">id_role</span>
<span class="p">,</span><span class="n">id_synthese</span>
<span class="p">)</span>
<span class="w"> </span><span class="k">SELECT</span>
<span class="n">a</span><span class="p">.</span><span class="n">observateurs</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_role</span>
<span class="p">,</span><span class="n">s</span><span class="p">.</span><span class="n">id_synthese</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">id_synthese</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">gn_imports</span><span class="p">.</span><span class="n">testimport</span><span class="w"> </span><span class="n">a</span>
<span class="c1">--self addition</span>
<span class="k">JOIN</span><span class="w"> </span><span class="n">gn_synthese</span><span class="p">.</span><span class="n">synthese</span><span class="w"> </span><span class="n">s</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">entity_source_pk_value</span><span class="p">::</span><span class="nb">integer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">id_data</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">s</span><span class="p">.</span><span class="n">id_source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span>
<span class="p">;</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="authentification">
<h2>Authentification<a class="headerlink" href="#authentification" title="Lien vers cette rubrique">#</a></h2>
<section id="demande-de-creation-de-compte">
<h3>Demande de création de compte<a class="headerlink" href="#demande-de-creation-de-compte" title="Lien vers cette rubrique">#</a></h3>
<p>Depuis la version 2.1.0, UsersHub propose une API de création de compte utilisateur. Une interface a été ajoutée à GeoNature pour permettre aux futurs utilisateurs de faire des demandes de création de compte depuis la page d’authentification de GeoNature. Ce mode est activable/désactivable depuis la configuration globale de GeoNature.</p>
<p>Pour des raisons de sécurité, l’API de création de compte est réservée aux utilisateurs « admin » grâce à un token secret. GeoNature a donc besoin de se connecter en tant qu’administrateur à UsersHub pour éxecuter les requêtes d’administration de compte.
Renseigner les paramètres suivants dans le fichier de configuration (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>). L’utilisateur doit avoir des droits 6 dans UsersHub</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">USERSHUB</span><span class="p">]</span>
    <span class="n">URL_USERSHUB</span> <span class="o">=</span> <span class="s1">&#39;http://mon_adresse_usershub.fr&#39;</span> <span class="c1"># sans slash final</span>
    <span class="c1"># Administrateur de mon application</span>
    <span class="n">ADMIN_APPLICATION_LOGIN</span> <span class="o">=</span> <span class="s2">&quot;login_admin_usershub&quot;</span>
    <span class="n">ADMIN_APPLICATION_PASSWORD</span> <span class="o">=</span> <span class="s2">&quot;password_admin_usershub</span>
</pre></div>
</div>
<p>Les fonctionnalités de création de compte nécessitent l’envoi d’emails pour vérifier l’identité des demandeurs de compte. Il est donc nécessaire d’avoir un serveur SMTP capable d’envoyer des emails. Renseigner la rubrique <code class="docutils literal notranslate"><span class="pre">MAIL_CONFIG</span></code> de la configuration. La description détaillées des paramètres de configuration d’envoie des emails est disponible dans <a class="reference external" href="https://flask-mail.readthedocs.io/en/latest/#configuring-flask-mail">la documentation de Flask-Mail</a>. Exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">MAIL_CONFIG</span><span class="p">]</span>
    <span class="n">MAIL_SERVER</span> <span class="o">=</span> <span class="s1">&#39;mail.espaces-naturels.fr&#39;</span>
    <span class="n">MAIL_PORT</span> <span class="o">=</span> <span class="mi">465</span>
    <span class="n">MAIL_USE_TLS</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">MAIL_USE_SSL</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">MAIL_USERNAME</span> <span class="o">=</span> <span class="s1">&#39;mon_email@email.io&#39;</span>
    <span class="n">MAIL_PASSWORD</span> <span class="o">=</span> <span class="s1">&#39;monpassword&#39;</span>
    <span class="n">MAIL_DEFAULT_SENDER</span> <span class="o">=</span> <span class="s1">&#39;mon_email@email.io&#39;</span>
    <span class="n">MAIL_ASCII_ATTACHMENTS</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
<p>Pour activer cette fonctionnalité (qui est par défaut désactivée), modifier le fichier de configuration de la manière suivante :</p>
<p>NB : tous les paramètres décrits ci-dessous doivent être dans la rubrique <code class="docutils literal notranslate"><span class="pre">[ACCOUNT_MANAGEMENT]</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
    <span class="n">ENABLE_SIGN_UP</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>Deux modes sont alors disponibles. Soit l’utilisateur est automatiquement accepté et un compte lui est créé après une confirmation de son email, soit un mail est envoyé à un administrateur pour confirmer la demande. Le compte ne sera crée qu’après validation par l’administrateur. Le paramètre <code class="docutils literal notranslate"><span class="pre">AUTO_ACCOUNT_CREATION</span></code> contrôle ce comportement (par défaut le compte créé sans validation par un administrateur: true). Dans le mode « création de compte validé par administrateur », il est indispensable de renseigner un email où seront envoyés les emails de validation (paramètre <code class="docutils literal notranslate"><span class="pre">VALIDATOR_EMAIL</span></code>)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># automatique</span>
<span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
    <span class="n">ENABLE_SIGN_UP</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">AUTO_ACCOUNT_CREATION</span> <span class="o">=</span> <span class="n">true</span>

<span class="c1"># validé par admin</span>
<span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
    <span class="n">ENABLE_SIGN_UP</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">AUTO_ACCOUNT_CREATION</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">VALIDATOR_EMAIL</span> <span class="o">=</span> <span class="s1">&#39;email@validateur.io&#39;</span>
</pre></div>
</div>
<p>L’utilisateur qui demande la création de compte est automatiquement mis dans un « groupe » UsersHub (par défaut, il s’agit du groupe « En poste »). Ce groupe est paramétrable depuis la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>. (La ligne où <code class="docutils literal notranslate"><span class="pre">is_default_group_for_app</span> <span class="pre">=</span> <span class="pre">true</span></code> sera utilisée comme groupe par défaut pour GeoNature). Il n’est pas en paramètre de GeoNature pusqu’il serait falsifiable via l’API. ⚠️ <strong>Attention</strong>, si vous effectuez une migration depuis une version de GeoNature &lt; 2.2.0, aucun groupe par défaut n’est défini, vous devez définir à la main le groupe par défaut pour l’application GeoNature dans la table <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_app_profil</span></code>.</p>
<p>Dans le mode « création de compte validé par administrateur », lorsque l’inscription est validée par un administrateur, un email est envoyé à l’utilisateur pour lui indiquer la confirmation de son inscription.
Il est possible de personnaliser le texte de la partie finale de cet email située juste avant la signature à l’aide du paramètre <code class="docutils literal notranslate"><span class="pre">ADDON_USER_EMAIL</span></code> (toujours à ajouter à la rubrique <code class="docutils literal notranslate"><span class="pre">[ACCOUNT_MANAGEMENT]</span></code>).
Vous pouvez utiliser des balises HTML compatibles avec les emails pour ce texte.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
    <span class="n">ADDON_USER_EMAIL</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;p&gt;</span>
<span class="s2">        Toute l&#39;équipe de GeoNature vous remercie pour votre inscription.</span>
<span class="s2">      &lt;/p&gt;&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Il est également possible de créer automatiquement un jeu de données et un cadre d’acquisition « personnel » à l’utilisateur afin qu’il puisse saisir des données dès sa création de compte via le paramètre <code class="docutils literal notranslate"><span class="pre">AUTO_DATASET_CREATION</span></code>. Par la suite l’administrateur pourra rattacher l’utilisateur à des JDD et CA via son organisme.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
    <span class="n">AUTO_ACCOUNT_CREATION</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">ENABLE_SIGN_UP</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">AUTO_DATASET_CREATION</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<section id="customisation-du-formulaire">
<h4>Customisation du formulaire<a class="headerlink" href="#customisation-du-formulaire" title="Lien vers cette rubrique">#</a></h4>
<p>Le formulaire de création de compte est par défaut assez minimaliste (nom, prénom, email, mot de passe, organisme, remarque).</p>
<p><em>NB</em> l’organisme est demandé à l’utilisateur à titre « informatif », c’est à l’administrateur de rattacher individuellement l’utilisateur à son organisme, et éventuellement de le créer, s’il n’existe pas.</p>
<p>Il est possible d’ajouter des champs au formulaire grâce à un générateur controlé par la configuration. Plusieurs type de champs peuvent être ajoutés (text, textarea, number, select, checkbox mais aussi taxonomy, nomenclature etc…).</p>
<p>L’exemple ci-dessous permet de créer un champs de type « checkbox » obligatoire, avec un lien vers un document (une charte par exemple) et un champ de type « select », non obligatoire. (voir le fichier <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml.example</span></code> pour un exemple plus exhaustif).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
<span class="p">[[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="o">.</span><span class="n">ACCOUNT_FORM</span><span class="p">]]</span>
    <span class="n">type_widget</span> <span class="o">=</span> <span class="s2">&quot;checkbox&quot;</span>
    <span class="n">attribut_label</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">      &lt;a target=&quot;_blank&quot; href=&quot;http://docs.geonature.fr&quot;&gt;</span>
<span class="s2">        J&#39;ai lu et j&#39;accepte la charte</span>
<span class="s2">      &lt;/a&gt;&quot;&quot;&quot;</span>
    <span class="n">attribut_name</span> <span class="o">=</span> <span class="s2">&quot;validate_charte&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">true</span><span class="p">]</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">true</span>

<span class="p">[[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="o">.</span><span class="n">ACCOUNT_FORM</span><span class="p">]]</span>
    <span class="n">type_widget</span> <span class="o">=</span> <span class="s2">&quot;select&quot;</span>
    <span class="n">attribut_label</span> <span class="o">=</span> <span class="s2">&quot;Exemple select&quot;</span>
    <span class="n">attribut_name</span> <span class="o">=</span> <span class="s2">&quot;select_test&quot;</span>
    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;value1&quot;</span><span class="p">,</span> <span class="s2">&quot;value2&quot;</span><span class="p">]</span>
    <span class="n">required</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
</section>
</section>
<section id="espace-utilisateur">
<h3>Espace utilisateur<a class="headerlink" href="#espace-utilisateur" title="Lien vers cette rubrique">#</a></h3>
<p>Un espace « utilisateur » est accessible lorsque l’on est connecté, permettant de modifier ses informations personnelles, y compris son mot de passe.</p>
<p>Cet espace est activable grâce au paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_USER_MANAGEMENT</span></code>. Par défaut, il est désactivé.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>
<span class="n">AUTO_ACCOUNT_CREATION</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">ENABLE_SIGN_UP</span> <span class="o">=</span> <span class="n">true</span>
<span class="n">ENABLE_USER_MANAGEMENT</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
</section>
<section id="acces-public">
<h3>Accès public<a class="headerlink" href="#acces-public" title="Lien vers cette rubrique">#</a></h3>
<p>Cette section de la documentation concerne l’implémentation d’un utilisateur générique et public accédant à votre instance GeoNature sans authentification.
Cela ajoute sur la page d’authentification de GeoNature, un bouton « Accès public » donnant accès à GeoNature sans authentification.</p>
<p>Etapes :</p>
<dl class="simple">
<dt>1/ UsersHub :</dt><dd><ul class="simple">
<li><p>Aller dans la section <cite>Utilisateurs</cite></p></li>
<li><p>Créer un utilisateur</p></li>
<li><p>Définir un identifiant et un mot de passe (par exemple utilisateur “public” et mot de passe “public”)</p></li>
<li><p>S’assurer qu’il ne soit dans aucun groupe</p></li>
<li><p>Aller ensuite dans la section <cite>Applications</cite></p></li>
<li><p>Pour GeoNature, cliquer sur le premier icône “Voir les membres”</p></li>
<li><p>Cliquer sur ajouter un rôle</p></li>
<li><p>Choisir l’utilisateur juste créé</p></li>
<li><p>Attribuer le rôle 1, “Lecteur”</p></li>
</ul>
</dd>
</dl>
<p>2/ Configuration GeoNature :</p>
<blockquote>
<div><ul class="simple">
<li><p>Dans le fichier de configuration de GeoNature (<code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code>), spécifier le nom d’utilisateur pour l’accès public via le paramètre <code class="docutils literal notranslate"><span class="pre">PUBLIC_ACCESS_USERNAME</span></code> :</p></li>
</ul>
</div></blockquote>
<div class="highlight-ini notranslate"><div class="highlight"><pre><span></span><span class="na">PUBLIC_ACCESS_USERNAME</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;public&#39;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#post-config-change"><span class="std std-ref">Exécuter les actions post-modification de la configuration</span></a>.</p>
<p>A ce moment-là, cet utilisateur n’a aucune permission dans GeoNature.
Il s’agit maintenant de gérer ses permissions dans GeoNature.</p>
<p>3/ GeoNature</p>
<blockquote>
<div><ul class="simple">
<li><p>Se connecter à GeoNature avec un utilisateur administrateur</p></li>
<li><p>Aller dans le module Admin</p></li>
<li><p>Cliquer sur “Backoffice”, puis « Permissions » / « Par utilisateurs »</p></li>
<li><p>Choisissez l’utilisateur sélectionné</p></li>
<li><p>Ajouter des permissions pour chacun des modules de l’instance auquel vous souhaitez que l’utilisateur public accède</p></li>
</ul>
</div></blockquote>
<section id="acces-public-automatique">
<h4>Accès public automatique<a class="headerlink" href="#acces-public-automatique" title="Lien vers cette rubrique">#</a></h4>
<p>Un lien GeoNature peut déclencher automatiquement une connexion avec l’utilisateur public en lui rajoutant les paramètres <code class="docutils literal notranslate"><span class="pre">access=public</span></code>.</p>
<p>Exemple : <a class="reference external" href="https://demo.geonature.fr/geonature/#/synthese?access=public">https://demo.geonature.fr/geonature/#/synthese?access=public</a></p>
</section>
</section>
</section>
<section id="gestion-de-la-sensibilite">
<h2>Gestion de la sensibilité<a class="headerlink" href="#gestion-de-la-sensibilite" title="Lien vers cette rubrique">#</a></h2>
<section id="id1">
<h3>Introduction<a class="headerlink" href="#id1" title="Lien vers cette rubrique">#</a></h3>
<p>Les régles de sensibilité définies par défaut sont issues des règles du SINP.
Elles dépendent de l’espèce et de l’observation. C’est-à-dire que pour une espèce donnée,
plusieurs niveaux de sensibilité sont possibles selon l’observation.</p>
<section id="criteres-de-sensibilite">
<h4>Critères de sensibilité<a class="headerlink" href="#criteres-de-sensibilite" title="Lien vers cette rubrique">#</a></h4>
<ul class="simple">
<li><p>Taxon</p></li>
<li><p>Emplacement</p></li>
<li><p>Ancienneté</p></li>
<li><p>Période de l’année</p></li>
<li><p>Statut biologique</p></li>
<li><p>Comportement de l’occurence</p></li>
</ul>
<p>Certaines règles de sensibilité peuvent porter uniquement sur l’espèce,
rendant l’entiereté des observations d’une espèce (et donc une espèce) sensible.</p>
</section>
<section id="niveaux-de-sensibilite">
<h4>Niveaux de sensibilité<a class="headerlink" href="#niveaux-de-sensibilite" title="Lien vers cette rubrique">#</a></h4>
<p>Voici les 5 niveaux de sensibilité définis par le SINP :</p>
<ul class="simple">
<li><p>Sensible - Aucune diffusion</p></li>
<li><p>Sensible - Diffusion au département</p></li>
<li><p>Sensible - Diffusion à la maille 10km</p></li>
<li><p>Sensible - Diffusion à la Commune ou Znieff</p></li>
<li><p>Non sensible - Diffusion précise</p></li>
</ul>
</section>
<section id="pour-plus-d-informations">
<h4>Pour plus d’informations<a class="headerlink" href="#pour-plus-d-informations" title="Lien vers cette rubrique">#</a></h4>
<p>Vous pouvez consulter :</p>
<ul class="simple">
<li><p>La page du site du <a class="reference external" href="https://inpn.mnhn.fr/programme/donnees-observations-especes/references/sensibilite">SINP traitant de la sensibilité</a>.</p></li>
<li><p>Le rapport de 2020 sur <a class="reference external" href="https://inpn.mnhn.fr/docs-web/docs/download/355449">La sensibilité des données du système  d’information  de l’inventaire  du  patrimoine naturel : méthodes, pratiques et usages (J. Ichter et S. Robert)</a>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>L’objectif de ce document n’est pas de modifier les règles établies par
le SINP. Il est donc conseillé de respecter ces règles définies au niveau
régional et national et donc de ne pas ajouter de règles locales.</p>
</div>
</section>
</section>
<section id="integration-dans-geonature">
<h3>Intégration dans GeoNature<a class="headerlink" href="#integration-dans-geonature" title="Lien vers cette rubrique">#</a></h3>
<section id="stockage-des-regles-en-base">
<h4>Stockage des règles en base<a class="headerlink" href="#stockage-des-regles-en-base" title="Lien vers cette rubrique">#</a></h4>
<p>Les règles de sensibilité sont stockées dans le schéma <code class="docutils literal notranslate"><span class="pre">gn_sensitivity</span></code>
qui contient 3 tables :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> qui relie notamment une espèce à un niveau de
sensibilité</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> qui permet de restreindre une règle de
sensibilité en fonction d’un critère (par exemple, statut biologique)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code> qui permet de restreindre une règle de
sensibilité à une zone géographique</p></li>
</ul>
<p>S’il n’y a aucune entrée dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code>, le niveau de
sensibilité défini dans <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> est appliqué peu importe
le statut biologique ou le comportement de l’occurence.
De même, s’il n’y a aucune entrée dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code>, le niveau
de sensibilité est appliqué peu importe la localisation de l’observation.
À l’inverse, s’il y a plusieurs entrées, la sensibilité est appliqué dès
que l’un des critères ou l’une des zones correspond à l’observation.</p>
<p>Certaines règles sont définies non pas pour une espèce donnée mais pour un
rang supérieur. Ces règles sont artificiellement dupliquées pour chaques espèces
sous-jacentes dans la vue matérialisée <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules_cd_ref</span></code>.
Il est nécessaire de la rafraichir lors de l’évolution du référentiel
de sensibilité.</p>
</section>
<section id="attribution-aux-observations-de-la-synthese">
<h4>Attribution aux observations de la synthèse<a class="headerlink" href="#attribution-aux-observations-de-la-synthese" title="Lien vers cette rubrique">#</a></h4>
<p>La sensibilité des observations de la synthèse est stockée dans la
colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code>.</p>
<p>A chaque insertion d’une donnée dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>,
un trigger (<code class="docutils literal notranslate"><span class="pre">tri_insert_calculate_sensitivity</span></code>) fait appel à une
fonction (<code class="docutils literal notranslate"><span class="pre">fct_tri_cal_sensitivity_on_each_statement</span></code>) qui appelle
elle-même la fonction <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.get_id_nomenclature_sensitivity</span></code>
pour le calcul de la sensibilité.</p>
</section>
<section id="gestion-du-referentiel">
<h4>Gestion du référentiel<a class="headerlink" href="#gestion-du-referentiel" title="Lien vers cette rubrique">#</a></h4>
<p>GeoNature fournit la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span></code> pour gérer son référentiel
de sensibilité :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">info</span></code> : statistiques sur les règles présentes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">add-referential</span></code> : import de nouvelles règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">remove-referential</span></code> : suppression de règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code> : mise à jour de la vue matérialisées des règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">update-synthese</span></code> : recalcul de la sensibilité des observations de la synthèse</p></li>
</ul>
<p>Le référentiel de sensibilité fourni par le SINP est normalement intégré
à GeoNature lors de son installation. Sinon, il peut être manuellement
intégré ou mis à jour avec l’une ou l’autre des commandes suivantes (selon votre version de Taxref) :</p>
<p>Taxref v17 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v17 20240325&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_17.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>utf-8
</pre></div>
</div>
<p>Taxref v16 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v16 20230203&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibiliteV16_20230203/RefSensibilite_16.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Taxref v15 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v15 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401875<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV15_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_V15_31032022/RefSensibilite_15.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Taxref v14 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v14 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401876<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV14_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_V14_31032022/RefSensibilite_14.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Le jeu de règles est fourni pour chaque version précise de Taxref, certaines
espèces sensibles pouvant voir leur <em>cd_nom</em> changé d’une version à l’autre.</p>
<p>Si vous mettez à jour votre version du référentiel de sensibilité, il faut ensuite relancer
le calcul des règles de sensibilité avec la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code>.</p>
</section>
<section id="personnalisation">
<h4>Personnalisation<a class="headerlink" href="#personnalisation" title="Lien vers cette rubrique">#</a></h4>
<p>Pour l’instant, seule la personnalisation de la sensibilité pour
une espèce donnée (peu importe l’observation) est abordée ici.</p>
<ol class="arabic">
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.t_sensitivity_rules</span></code> : Changez le niveau de
sensibilité <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> par celui désiré. Pour la
valeur à renseigner, voir dans <code class="docutils literal notranslate"><span class="pre">t_nomenclature</span></code> en filtrant avec
<code class="docutils literal notranslate"><span class="pre">id_type=ref_nomenclatures.get_id_nomenclature_type('SENSIBILITE')</span></code>.</p></li>
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> : s’il y a une correspondance
d”<code class="docutils literal notranslate"><span class="pre">id_sensitivity</span></code> avec <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code>, modifiez ou supprimez cette ligne.</p></li>
<li><p>Rafraichissez le cache des règles extrapolées aux espèces :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>refresh-rules-cache
</pre></div>
</div>
<p>Ceci est équivalent à lancer manuellement la commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">REFRESH</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">gn_sensitivity</span><span class="p">.</span><span class="n">t_sensitivity_rules_cd_ref</span>
</pre></div>
</div>
</li>
<li><p>Il est maintenant nécessaire de mettre à jour la sensibilité de vos
observations présentes dans la synthèse. Pour cela, lancez la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>update-synthese
</pre></div>
</div>
</li>
</ol>
<p>Les valeurs dans la colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> des observations sensibles
de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> auront alors
changé. Vous pouvez le vérifier en navigant dans le module Synthèse
puis dans les détails d’une observation de votre/vos espèce(s).</p>
</section>
<section id="utilisation">
<h4>Utilisation<a class="headerlink" href="#utilisation" title="Lien vers cette rubrique">#</a></h4>
<p>Un lien entre la synthèse et la sensibilité a été mis en place : le floutage des données sensibles.</p>
<p>L’objectif et de pouvoir donner accès aux utilisateurs à des données sensibles mais pas de façon précise.
C’est à dire, en fonction du niveau de sensibilité de l’observation, un utilisateur pourra voir uniquement
l’observation à la maille de 10km par exemple.</p>
<p>Comme décrit ci-dessous, un paramètre en configuration a été ajoutée pour donner l’a possibilité d’exclure
toutes les données sensibles plutôt que de les flouter.</p>
<section id="implementation">
<h5>Implementation<a class="headerlink" href="#implementation" title="Lien vers cette rubrique">#</a></h5>
<p>Basée sur le nouveau système de permissions (v2.13), l’implémentation dans ce système se résout à
l’ajout d’un filtre : exlure/flouter les données sensibles.
Le choix entre l’exclusion et le floutage est décidé par le paramètre en configuration :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="n">BLUR_SENSITIVE_OBSERVATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<p>Si <cite>BLUR_SENSITIVE_OBSERVATIONS=true</cite> alors les observations seront floutées. Sinon exclues.</p>
<p>L’exclusion des données sensibles est simple : si le filtre « exclure les données sensibles » est coché,
l’utilisateur n’aura pas accès (pour un scope défini) aux données sensibles quelque soit leur niveau
de sensibilité soit :
- Sensible - Diffusion à la Commune ou Znieff
- Sensible - Diffusion à la maille 10km
- Sensible - Diffusion au département
- Sensible - Aucune diffusion</p>
<p>Pour la suite de la documentation, le paramètre est considéré comme le suivant : <cite>BLUR_SENSITIVE_OBSERVATIONS=true</cite>.
Donc toute donnée sensible avec restriction d’accès sera floutée.</p>
<p>Si ce filtre n’est pas activé, la récupération des données de la synthèse en backend reste inchangée.
En effet, l’ajout du floutage des données nuit forcément aux performances.</p>
<p>S’il est activé, une requête SQL est construite comme suit :</p>
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" />
<p>Le but est d’ajouter à la requête principale une sous-requête exécutant deux requêtes <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> dans
la table de synthèse afin de séparer les données précises des données floutées. Ensuite un <code class="docutils literal notranslate"><span class="pre">UNION</span></code>
est fait afin de rassembler les données avec priorité sur les données précises.</p>
<p>Dans ces deux requêtes, les permissions ainsi que les filtres utilisateurs sont pris en comptes, donc
l’utilisateur n’a pas obligatoirement accès à toutes les données, c’est à la charge de l’administrateur.
Le fait de prendre en compte les filtres dans chacune des deux requêtes permet une cohérence dans les
résultats renvoyés par ces deux requêtes (car un <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> est souvent présent).</p>
<p>Ce floutage des données a été implémenté sur 3 routes de la synthèse :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/for_web</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsynthese/&lt;id_synthese&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/export_observations</span></code></p></li>
</ul>
<p>Des tests unitaires ont également été écrits.</p>
</section>
<section id="traitement-des-problematiques-lies-aux-zonages">
<h5>Traitement des problématiques liés aux zonages<a class="headerlink" href="#traitement-des-problematiques-lies-aux-zonages" title="Lien vers cette rubrique">#</a></h5>
<p><strong>Traitement de l’affichage en mode maille</strong></p>
<p>Il a été décidé d’exclure les données sensibles dont la géométrie floutée est plus grande que la
maille affichée en mode maille dans la synthèse.</p>
<p>C’est à dire que si une observation est dégradée/floutée à la maille M10 (10km²) et que le mode maille
affiche les observations regroupées dans les mailles de type M5 (5km), l’observation n’apparaitra dans
aucune maille mais dans seulement dans la liste des observations.</p>
<p>Pour rappel la maille de regroupement pour affichage dans le mode maille est définie par le paramètre
suivant :</p>
<p>Pour que ce filtrage soit effectué, il était nécessaire d’introduire une nouvelle colonne dans la table
<code class="docutils literal notranslate"><span class="pre">ref_geo.bib_area_types</span></code> : <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> qui permet d’ordonner les types de zones par leur
taille moyenne. Pour les mailles cela est simple, pour les départements et les communes notamment
utilisées pour flouter la donnée, cela est plus complexe. Leur taille a donc été donnée arbitrairement.
Le floutage des données est censé évoluer vers des zones de floutages basées exclusivement sur des
mailles. Le problème de la taille arbitraire ne sera alors plus d’actualité.</p>
<p><strong>Traitement des zonages associés</strong></p>
<p>L’introduction de la nouvelle colone <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> permet également d’afficher uniquement les
zonages plus grands que la géométrie floutée dans l’onglet Zonage des détails d’une observation en
synthèse. Par exemple, les mailles M1 (1km²) et M5 (5km²) d’une observation floutée à la maille M10
(10km²) n’apparaitront pas.</p>
<p><strong>Traitement du filtre de type « zonage »</strong></p>
<p>Pour rappel, ce filtre permet de rechercher si des observations intersectent des zones choisies par
l’utilisateur. Ces zones sont disponibles dans la section « Où » dans le module Synthèse.</p>
<p>En backend, quand l’utilisateur voit les données précisément, le filtre fonctionne grâce à la
table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>, évitant de procéder à l’appel de <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> plus lent.</p>
<p>Ce filtre fonctionne différemment quand l’utilisateur dispose de permissions floutant les
données. En effet, un <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> est effectué sur la géométrie floutée car l’utilisation de
<code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> pourrait donner trop d’informations à l’utilisateur et ce dernier
pourrait obtenir des données plus précises que souhaité par recherche sur différentes communes alors
que l’observation est floutée au département par exemple.</p>
</section>
</section>
</section>
</section>
<section id="module-occtax">
<h2>Module OCCTAX<a class="headerlink" href="#module-occtax" title="Lien vers cette rubrique">#</a></h2>
<section id="installer-le-module">
<h3>Installer le module<a class="headerlink" href="#installer-le-module" title="Lien vers cette rubrique">#</a></h3>
<p>Le module est fourni par défaut avec l’installation de GeoNature.</p>
<p>Si vous l’avez supprimé, lancez les commandes suivantes depuis le répertoire <code class="docutils literal notranslate"><span class="pre">backend</span></code> de GeoNature</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">source venv/bin/activate</span>
<span class="go">geonature install_gn_module /home/&lt;mon_user&gt;/geonature/contrib/occtax occtax</span>
</pre></div>
</div>
</section>
<section id="configuration-du-module">
<h3>Configuration du module<a class="headerlink" href="#configuration-du-module" title="Lien vers cette rubrique">#</a></h3>
<p>Le paramétrage du module OCCTAX se fait en créant le fichier <code class="docutils literal notranslate"><span class="pre">config/occtax_config.toml</span></code>, en s’inspirant du fichier d’exemple <code class="docutils literal notranslate"><span class="pre">contrib/occtax/occtax_config.toml.example</span></code>.
Reportez vous à la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration d’un gn_module</a> pour effectuer les opérations supplémentaires nécessaires pour la prise en compte des modifications.</p>
<section id="afficher-masquer-des-champs-du-formulaire">
<h4>Afficher/masquer des champs du formulaire<a class="headerlink" href="#afficher-masquer-des-champs-du-formulaire" title="Lien vers cette rubrique">#</a></h4>
<p>La quasi-totalité des champs du standard Occurrences de taxons sont présents dans la base de données, et peuvent donc être saisis à partir du formulaire.</p>
<p>Pour plus de souplesse et afin de répondre aux besoins de chacun, l’ensemble des champs sont masquables (sauf les champs essentiels : observateur, taxon …)</p>
<p>En modifiant les variables des champs ci-dessous, vous pouvez donc personnaliser le formulaire :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">form_fields</span><span class="p">]</span>
    <span class="n">date_min</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">date_max</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">hour_min</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">hour_max</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">altitude_min</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">altitude_max</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">obs_technique</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">group_type</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">comment_releve</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">obs_method</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">bio_condition</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">bio_status</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">naturalness</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">exist_proof</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">observation_status</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">diffusion_level</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">blurring</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">determiner</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">determination_method</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">sample_number_proof</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">digital_proof</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">non_digital_proof</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">source_status</span> <span class="o">=</span> <span class="n">false</span>
    <span class="n">comment_occ</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">life_stage</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">sex</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">obj_count</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">type_count</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">count_min</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">count_max</span> <span class="o">=</span> <span class="n">true</span>
    <span class="n">validation_status</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
<p>Si le champ est masqué, une valeur par défaut est inscrite en base (voir plus loin pour définir ces valeurs).</p>
</section>
<section id="modifier-le-champ-observateurs">
<h4>Modifier le champ Observateurs<a class="headerlink" href="#modifier-le-champ-observateurs" title="Lien vers cette rubrique">#</a></h4>
<p>Par défaut le champ <code class="docutils literal notranslate"><span class="pre">Observateurs</span></code> est une liste déroulante qui pointe vers une liste du schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code>.
Il est possible de passer ce champ en texte libre en mettant à <code class="docutils literal notranslate"><span class="pre">true</span></code> la variable <code class="docutils literal notranslate"><span class="pre">observers_txt</span></code>.</p>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">id_observers_list</span></code> permet de changer la liste d’observateurs proposée dans le formulaire. Vous pouvez modifier le numéro de liste du module ou modifier le contenu de la liste dans UsersHub (<code class="docutils literal notranslate"><span class="pre">utilisateurs.t_listes</span></code> et <code class="docutils literal notranslate"><span class="pre">utilisateurs.cor_role_liste</span></code>)</p>
<p>Par défaut, l’ensemble des observateurs de la liste 9 (observateurs faune/flore) sont affichés.</p>
</section>
<section id="personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module">
<h4>Personnaliser la liste des taxons et habitats saisissables dans le module<a class="headerlink" href="#personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module" title="Lien vers cette rubrique">#</a></h4>
<p>Il est possible de limiter la liste des taxons saisissables dans Occtax, en renseignant le paramètre <code class="docutils literal notranslate"><span class="pre">id_taxon_list</span></code>. Celui-ci n’est pas défini par défaut et c’est donc tout Taxref qui est proposé à la saisie par défaut.</p>
<p>Une liste restreinte de taxons (8 seulement) est proposée par défaut (<code class="docutils literal notranslate"><span class="pre">id_taxon_list</span> <span class="pre">=</span> <span class="pre">100</span></code>). L’administrateur peut changer, compléter ou supprimer cette liste.</p>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">id_taxon_list</span> <span class="pre">=</span> <span class="pre">100</span></code> correspond donc à un ID de liste de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bib_listes</span></code> (L’ID 100 correspond à la liste « Saisie Occtax »).</p>
<p>Voici un exemple de requête SQL pour remplir la liste 100 avec tous les taxons de flore de Taxref à partir du rang <code class="docutils literal notranslate"><span class="pre">genre</span></code> :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">cor_nom_liste</span><span class="w"> </span><span class="p">(</span><span class="n">id_liste</span><span class="p">,</span><span class="n">id_nom</span><span class="p">)</span>
<span class="k">WITH</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">cd_nom</span><span class="p">,</span><span class="w"> </span><span class="n">cd_ref</span><span class="p">,</span><span class="w"> </span><span class="n">nom_vern</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">taxref</span>
<span class="k">WHERE</span><span class="w"> </span><span class="n">id_rang</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">IN</span><span class="w"> </span><span class="p">(</span><span class="s1">&#39;Dumm&#39;</span><span class="p">,</span><span class="s1">&#39;SPRG&#39;</span><span class="p">,</span><span class="s1">&#39;KD&#39;</span><span class="p">,</span><span class="s1">&#39;SSRG&#39;</span><span class="p">,</span><span class="s1">&#39;IFRG&#39;</span><span class="p">,</span><span class="s1">&#39;PH&#39;</span><span class="p">,</span><span class="s1">&#39;SBPH&#39;</span><span class="p">,</span><span class="s1">&#39;IFPH&#39;</span><span class="p">,</span><span class="s1">&#39;DV&#39;</span><span class="p">,</span><span class="s1">&#39;SBDV&#39;</span><span class="p">,</span><span class="s1">&#39;SPCL&#39;</span><span class="p">,</span><span class="s1">&#39;CLAD&#39;</span><span class="p">,</span><span class="s1">&#39;CL&#39;</span><span class="p">,</span>
<span class="w">  </span><span class="s1">&#39;SBCL&#39;</span><span class="p">,</span><span class="s1">&#39;IFCL&#39;</span><span class="p">,</span><span class="s1">&#39;LEG&#39;</span><span class="p">,</span><span class="s1">&#39;SPOR&#39;</span><span class="p">,</span><span class="s1">&#39;COH&#39;</span><span class="p">,</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span><span class="s1">&#39;SBOR&#39;</span><span class="p">,</span><span class="s1">&#39;IFOR&#39;</span><span class="p">,</span><span class="s1">&#39;SPFM&#39;</span><span class="p">,</span><span class="s1">&#39;FM&#39;</span><span class="p">,</span><span class="s1">&#39;SBFM&#39;</span><span class="p">,</span><span class="s1">&#39;TR&#39;</span><span class="p">,</span><span class="s1">&#39;SSTR&#39;</span><span class="p">)</span><span class="w"> </span><span class="p">)</span>
<span class="w">  </span><span class="k">SELECT</span><span class="w"> </span><span class="mi">100</span><span class="p">,</span><span class="n">tr</span><span class="p">.</span><span class="n">cd_nom</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">taxonomie</span><span class="p">.</span><span class="n">taxref</span><span class="w"> </span><span class="n">tr</span>
<span class="w">  </span><span class="k">join</span><span class="w"> </span><span class="n">tx</span><span class="w"> </span><span class="k">on</span><span class="w"> </span><span class="n">tx</span><span class="p">.</span><span class="n">cd_nom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">tr</span><span class="p">.</span><span class="n">cd_nom</span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">tr</span><span class="p">.</span><span class="n">regne</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;Plantae&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Il est également possible de gérer les listes de taxons avec le module TaxHub.</p>
<p>Il est de même possible de restreindre la liste d’habitats proposés dans le module :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ID_LIST_HABITAT</span> <span class="o">=</span> <span class="mi">2</span>
</pre></div>
</div>
<p>Avec <code class="docutils literal notranslate"><span class="pre">ID_LIST_HABITAT</span></code> faisant référence aux listes définies dans <code class="docutils literal notranslate"><span class="pre">ref_habitats.bib_list_habitat</span></code>. La liste est peuplée d’habitats grâce à la table <code class="docutils literal notranslate"><span class="pre">ref_habitats.cor_list_habitat</span></code>. Par exemple :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Création d&#39;une liste restreinte d&#39;habitats pour Occtax</span>
<span class="c1">-- (typologie EUNIS de niveau 2)</span>
<span class="k">INSERT</span><span class="w"> </span><span class="k">INTO</span><span class="w"> </span><span class="n">ref_habitats</span><span class="p">.</span><span class="n">cor_list_habitat</span><span class="w"> </span><span class="n">clh</span><span class="p">(</span>
<span class="w">        </span><span class="n">cd_hab</span><span class="p">,</span>
<span class="w">        </span><span class="n">id_list</span>
<span class="p">)</span>
<span class="k">SELECT</span>
<span class="w">        </span><span class="n">hr</span><span class="p">.</span><span class="n">cd_hab</span><span class="p">,</span>
<span class="w">        </span><span class="mi">2</span>
<span class="k">FROM</span><span class="w"> </span><span class="n">ref_habitats</span><span class="p">.</span><span class="n">habref</span><span class="w"> </span><span class="n">hr</span>
<span class="k">WHERE</span><span class="w"> </span><span class="p">(</span><span class="n">hr</span><span class="p">.</span><span class="n">cd_typo</span><span class="p">,</span><span class="n">hr</span><span class="p">.</span><span class="n">niveau</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">7</span><span class="w"> </span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
</section>
<section id="gerer-les-valeurs-par-defaut-des-nomenclatures">
<h4>Gérer les valeurs par défaut des nomenclatures<a class="headerlink" href="#gerer-les-valeurs-par-defaut-des-nomenclatures" title="Lien vers cette rubrique">#</a></h4>
<p>Le formulaire de saisie pré-remplit des valeurs par défaut pour simplifier la saisie. Ce sont également ces valeurs qui sont prises en compte pour remplir dans la BDD les champs du formulaire qui sont masqués.</p>
<p>La table <code class="docutils literal notranslate"><span class="pre">pr_occtax.defaults_nomenclatures_value</span></code> définit les valeurs par défaut pour chaque nomenclature.</p>
<p>La table contient les deux colonnes suivantes :</p>
<ul class="simple">
<li><p>l”<code class="docutils literal notranslate"><span class="pre">id_type</span></code> de nomenclature (voir table <code class="docutils literal notranslate"><span class="pre">ref_nomenclature.bib_nomenclatures_types</span></code>)</p></li>
<li><p>l”<code class="docutils literal notranslate"><span class="pre">id_nomenclature</span></code> (voir table <code class="docutils literal notranslate"><span class="pre">ref_nomenclature.t_nomenclatures</span></code>)</p></li>
</ul>
<p>Pour chaque type de nomenclature, on associe l’ID de la nomenclature que l’on souhaite voir apparaitre par défaut.</p>
<p>Le mécanisme peut être poussé plus loin en associant une nomenclature par défaut par organisme, règne et group2_inpn.
La valeur 0 pour ses champs revient à mettre la valeur par défaut pour tous les organismes, tous les règnes et tous les group2_inpn.</p>
<p>Une interface de gestion des nomenclatures est prévue d’être développée pour simplifier cette configuration.</p>
<p>TODO : valeur par défaut de la validation</p>
</section>
<section id="personnaliser-l-interface-map-list">
<h4>Personnaliser l’interface Map-list<a class="headerlink" href="#personnaliser-l-interface-map-list" title="Lien vers cette rubrique">#</a></h4>
<p>La liste des champs affichés par défaut dans le tableau peut être modifiée avec le paramètre <code class="docutils literal notranslate"><span class="pre">default_maplist_columns</span></code>.</p>
<p>Par défaut :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">default_maplist_columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span> <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;taxons&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Taxon&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;date_min&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Date début&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;observateurs&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Observateurs&quot;</span> <span class="p">},</span>
    <span class="p">{</span> <span class="n">prop</span> <span class="o">=</span> <span class="s2">&quot;dataset_name&quot;</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;Jeu de données&quot;</span> <span class="p">}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Voir la vue <code class="docutils literal notranslate"><span class="pre">occtax.v_releve_list</span></code> pour voir les champs disponibles.</p>
</section>
<section id="ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte">
<h4>Ajouter une contrainte d’échelle de saisie sur la carte<a class="headerlink" href="#ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte" title="Lien vers cette rubrique">#</a></h4>
<p>Il est possible de contraindre la saisie de la géométrie d’un relevé sur la carte par un seuil d’échelle minimum avec le paramètre <code class="docutils literal notranslate"><span class="pre">releve_map_zoom_level</span></code>.</p>
<p>Par défaut :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom level on the map from which you can add point/line/polygon</span>
<span class="n">releve_map_zoom_level</span> <span class="o">=</span> <span class="mi">6</span>
</pre></div>
</div>
<p>Il suffit de modifier la valeur qui correspond au niveau de zoom sur la carte.
Par exemple, pour contraindre la saisie à l’affichage de la carte IGN au 1/25000e :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">releve_map_zoom_level</span> <span class="o">=</span> <span class="mi">15</span>
</pre></div>
</div>
</section>
<section id="supprimer-le-remplissage-automatique-de-la-date">
<h4>Supprimer le remplissage automatique de la date<a class="headerlink" href="#supprimer-le-remplissage-automatique-de-la-date" title="Lien vers cette rubrique">#</a></h4>
<p>Pour éviter les erreurs de saisie lorsque des données sont rentrées longtemps après le retour du terrain, il est possible de supprimer l’ajout automatique de la date du jour au relevé :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATE_FORM_WITH_TODAY</span> <span class="o">=</span> <span class="n">false</span>
</pre></div>
</div>
</section>
</section>
<section id="gestion-des-exports">
<h3>Gestion des exports<a class="headerlink" href="#gestion-des-exports" title="Lien vers cette rubrique">#</a></h3>
<p>Les exports du module sont basés sur une vue (par défaut <code class="docutils literal notranslate"><span class="pre">pr_occtax.export_occtax_sinp</span></code>)</p>
<p>Il est possible de définir une autre vue pour avoir des exports personnalisés.
Pour cela, créer votre vue, et modifier les paramètres suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Name of the view based export</span>
<span class="n">export_view_name</span> <span class="o">=</span> <span class="s1">&#39;v_export_occtax&#39;</span>

<span class="c1"># Name of the geometry columns of the view</span>
<span class="n">export_geom_columns_name</span> <span class="o">=</span> <span class="s1">&#39;geom_4326&#39;</span>

<span class="c1"># Name of the primary key column of the view</span>
<span class="n">export_id_column_name</span> <span class="o">=</span> <span class="s1">&#39;permId&#39;</span>
</pre></div>
</div>
<p>La vue doit cependant contenir les champs suivants pour que les filtres de recherche fonctionnent :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">date_min</span><span class="p">,</span>
<span class="n">date_max</span><span class="p">,</span>
<span class="n">id_releve_occtax</span><span class="p">,</span>
<span class="n">id_dataset</span><span class="p">,</span>
<span class="n">id_occurrence_occtax</span><span class="p">,</span>
<span class="n">id_digitiser</span><span class="p">,</span>
<span class="n">geom_4326</span><span class="p">,</span>
<span class="n">dataset_name</span>
</pre></div>
</div>
</section>
<section id="attribuer-des-permissions">
<h3>Attribuer des permissions<a class="headerlink" href="#attribuer-des-permissions" title="Lien vers cette rubrique">#</a></h3>
<p>La gestion des permissions (CRUVED) se fait module par module, depuis le module « Admin ».</p>
</section>
<section id="dupliquer-le-module-occtax">
<h3>Dupliquer le module Occtax<a class="headerlink" href="#dupliquer-le-module-occtax" title="Lien vers cette rubrique">#</a></h3>
<p>Il est possible de « dupliquer » le module Occtax pour créer des nouveaux modules, basé sur le moteur d’Occtax, en y ajoutant des champs additionnels propre au module.</p>
<p>Le schéma de base de données ainsi que les routes du backend utilisées restent les mêmes (celles d’Occtax). En base de données un nouveau champs <code class="docutils literal notranslate"><span class="pre">id_module</span></code> permet de différencier les données venant des differents modules. Concernant l’API, les routes sont appelées avec le préfixe du module code :</p>
<ul class="simple">
<li><p>route Occtax : <code class="docutils literal notranslate"><span class="pre">/occtax/releves</span></code></p></li>
<li><p>route du module dupliqué : <cite>occtax/&lt;MODULE_CODE&gt;/releves</cite></p></li>
</ul>
<p>Pour créer un nouveau module « Occtax dupliqué », ajoutez une ligne dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_modules</span></code>.</p>
<p>La ligne doit contenir les informations suivantes :</p>
<ul class="simple">
<li><p>le <code class="docutils literal notranslate"><span class="pre">module_code</span></code> doit être unique,</p></li>
<li><p>les champs <code class="docutils literal notranslate"><span class="pre">active_frontend=true</span></code>, <code class="docutils literal notranslate"><span class="pre">active_backend=false</span></code>, <code class="docutils literal notranslate"><span class="pre">ng_module=occtax</span></code> et le champs <code class="docutils literal notranslate"><span class="pre">module_path</span></code> pour l’URL derrière lequel le module sera servi (<code class="docutils literal notranslate"><span class="pre">/florestation</span></code> par exemple)</p></li>
</ul>
<p>Exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">gn_commons</span><span class="o">.</span><span class="n">t_modules</span> <span class="p">(</span><span class="n">module_code</span><span class="p">,</span> <span class="n">module_label</span><span class="p">,</span> <span class="n">module_picto</span><span class="p">,</span> <span class="n">module_desc</span><span class="p">,</span> <span class="n">module_path</span><span class="p">,</span><span class="n">active_frontend</span><span class="p">,</span> <span class="n">active_backend</span><span class="p">,</span> <span class="n">ng_module</span><span class="p">)</span> <span class="n">VALUES</span>
     <span class="p">(</span><span class="s1">&#39;FLORE_STATION&#39;</span><span class="p">,</span><span class="s1">&#39;Flore station v2&#39;</span><span class="p">,</span><span class="s1">&#39;fa-leaf&#39;</span><span class="p">,</span><span class="s1">&#39;Module de saisie Flore station (sous module Occtax)&#39;</span><span class="p">,</span><span class="s1">&#39;flore_station&#39;</span><span class="p">,</span><span class="n">true</span><span class="p">,</span><span class="n">false</span><span class="p">,</span><span class="s1">&#39;occtax&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>Ajoutez ensuite une « source » dans la synthese (<code class="docutils literal notranslate"><span class="pre">gn_synthese.t_sources</span></code>) pour ce nouveau module.</p>
<p>Dans l’exemple ci-dessous, remplacez <code class="docutils literal notranslate"><span class="pre">&lt;MODULE_PATH&gt;</span></code> par le contenu de la colonne <code class="docutils literal notranslate"><span class="pre">module_path</span></code> ainsi que <code class="docutils literal notranslate"><span class="pre">&lt;ID_MODULE&gt;</span></code> par l’id du module que vous venez de créer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span> <span class="n">gn_synthese</span><span class="o">.</span><span class="n">t_sources</span> <span class="p">(</span><span class="n">name_source</span><span class="p">,</span><span class="n">desc_source</span><span class="p">,</span><span class="n">entity_source_pk_field</span><span class="p">,</span><span class="n">url_source</span><span class="p">,,</span><span class="n">id_module</span><span class="p">)</span> <span class="n">VALUES</span>
<span class="p">(</span><span class="s1">&#39;Flore station (sous-module Occtax)&#39;</span><span class="p">,</span><span class="s1">&#39;Données issues du protocole Flore station&#39;</span><span class="p">,</span><span class="s1">&#39;pr_occtax.cor_counting_occtax.id_counting_occtax&#39;</span><span class="p">,</span><span class="s1">&#39;#/&lt;MODULE_PATH&gt;/info/id_counting&#39;</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">ID_MODULE</span><span class="o">&gt;</span><span class="p">);</span>
</pre></div>
</div>
<p>Bien que le module soit une copie d’Occtax, il est tout de même nécessaire de définir les permissions disponibles pour ce module (ce sont les mêmes qu’Occtax). Jouez le scrit SQL suivant en remplacant :MODULE_CODE par le code du module que vous venez de créer.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSERT</span> <span class="n">INTO</span>
    <span class="n">gn_permissions</span><span class="o">.</span><span class="n">t_permissions_available</span> <span class="p">(</span>
        <span class="n">id_module</span><span class="p">,</span>
        <span class="n">id_object</span><span class="p">,</span>
        <span class="n">id_action</span><span class="p">,</span>
        <span class="n">label</span><span class="p">,</span>
        <span class="n">scope_filter</span>
    <span class="p">)</span>
<span class="n">SELECT</span>
    <span class="n">m</span><span class="o">.</span><span class="n">id_module</span><span class="p">,</span>
    <span class="n">o</span><span class="o">.</span><span class="n">id_object</span><span class="p">,</span>
    <span class="n">a</span><span class="o">.</span><span class="n">id_action</span><span class="p">,</span>
    <span class="n">v</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">v</span><span class="o">.</span><span class="n">scope_filter</span>
<span class="n">FROM</span>
    <span class="p">(</span>
        <span class="n">VALUES</span>
              <span class="p">(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Créer des relevés&#39;</span><span class="p">)</span>
            <span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;R&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Voir les relevés&#39;</span><span class="p">)</span>
            <span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;U&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Modifier les relevés&#39;</span><span class="p">)</span>
            <span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Exporter les relevés&#39;</span><span class="p">)</span>
            <span class="p">,(</span><span class="s1">&#39;:MODULE_CODE&#39;</span><span class="p">,</span> <span class="s1">&#39;ALL&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="s1">&#39;Supprimer des relevés&#39;</span><span class="p">)</span>
    <span class="p">)</span> <span class="n">AS</span> <span class="n">v</span> <span class="p">(</span><span class="n">module_code</span><span class="p">,</span> <span class="n">object_code</span><span class="p">,</span> <span class="n">action_code</span><span class="p">,</span> <span class="n">scope_filter</span><span class="p">,</span> <span class="n">label</span><span class="p">)</span>
<span class="n">JOIN</span>
    <span class="n">gn_commons</span><span class="o">.</span><span class="n">t_modules</span> <span class="n">m</span> <span class="n">ON</span> <span class="n">m</span><span class="o">.</span><span class="n">module_code</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">module_code</span>
<span class="n">JOIN</span>
    <span class="n">gn_permissions</span><span class="o">.</span><span class="n">t_objects</span> <span class="n">o</span> <span class="n">ON</span> <span class="n">o</span><span class="o">.</span><span class="n">code_object</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">object_code</span>
<span class="n">JOIN</span>
    <span class="n">gn_permissions</span><span class="o">.</span><span class="n">bib_actions</span> <span class="n">a</span> <span class="n">ON</span> <span class="n">a</span><span class="o">.</span><span class="n">code_action</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">action_code</span><span class="p">;</span>
</pre></div>
</div>
<section id="associer-des-jeux-de-donnees-et-des-champs-additionnels">
<h4>Associer des jeux de données et des champs additionnels<a class="headerlink" href="#associer-des-jeux-de-donnees-et-des-champs-additionnels" title="Lien vers cette rubrique">#</a></h4>
<p>Dans le module Métadonnées (formulaire des jeux de données), associez les jeux de données que vous souhaitez rendre saisissables au nouveau module dupliqué.</p>
</section>
<section id="ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes">
<h4>Ajouter le nouveau module dans la liste des modules implémentés<a class="headerlink" href="#ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes" title="Lien vers cette rubrique">#</a></h4>
<p>Dans le fichier de configuration de GeoNature (geonature_config.toml) ajoutez une section <cite>ADDITIONAL_FIELDS</cite> qui contient tableau <cite>IMPLEMENTED_MODULES</cite> listant les modules qui implémentent les champs additionnels (Occtax doit y figurer en plus du nouveau module)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">ADDITIONAL_FIELDS</span><span class="p">]</span>
  <span class="n">IMPLEMENTED_MODULES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;OCCTAX&quot;</span><span class="p">,</span> <span class="s2">&quot;FLORE_STATION&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>Vous pouvez ensuite créer des nouveaux champs additionnels et les associer à ce module. De la même manière que dans Occtax, on peut les associer aux trois niveaux du formulaire (relevé, occurrence, dénombrement).</p>
</section>
</section>
</section>
<section id="module-admin">
<h2>Module Admin<a class="headerlink" href="#module-admin" title="Lien vers cette rubrique">#</a></h2>
<section id="administration-des-champs-additionnels">
<h3>Administration des champs additionnels<a class="headerlink" href="#administration-des-champs-additionnels" title="Lien vers cette rubrique">#</a></h3>
<p>Certains protocoles nécessitent la saisie de champs qui vont au-delà des standards du SINP sur lesquels GeoNature s’appuie. Les champs additionnels permettent ainsi d’étendre les formulaires en ajoutant des informations spécifiques pour des jeux de données (JDD) ou pour l’ensemble d’un module.</p>
<p>Les champs additionnels ne sont pas créés comme des colonnes à part entière, mais leurs valeurs sont stockées dans un champs <code class="docutils literal notranslate"><span class="pre">additional_data</span></code> au format JSON.</p>
<p>Actuellement seul le module Occtax implémente la gestion de ces champs additionnels.</p>
<p>Le module « Admin » de GeoNature offre une interface de création et de gestion de ces champs additionnels.
Un champ additionnel est définit par:</p>
<ul class="simple">
<li><p>son nom (nom dans la base de données)</p></li>
<li><p>son label (nom tel qu’il sera affiché sur l’interface)</p></li>
<li><p>son type de widget : vous devez définir si le champs est une liste déroulante, une checkbox, une nomenclature, un entier, un champ texte, etc…</p></li>
<li><p>le (ou les) module(s) auquel il est rattaché</p></li>
<li><p>le (ou les) objet(s) auquel il est rattaché. Il s’agit du placement et de la table de rattachement du champs dans le module. Par exemple Occtax est composé de 3 « objets/table ». Les objets « relevé », « occurrence » et « dénombrement ».</p></li>
<li><p>le (ou les) JDD auquel il est rattaché. Si aucun JDD n’est renseigné le champ sera proposé dans tout le module pour tous les JDD. S’il est rattaché à un JDD, le champs sera chargé dynamiquement à la selection du JDD dans le formulaire</p></li>
<li><p>une série d’autres options pour paramétrer le comportement du champs (obligatoire, ordre, description, exportable etc…)</p></li>
</ul>
<p>Les champs additionnels sont stockés dans la table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_additional_fields</span></code>.</p>
<p>Exemples de configuration :</p>
<p>Pour les champs de type « select », « multiselect », « checkbox » et « radio », le champs « valeur » doit être rempli par un JSON représentant une liste de dictionnaire « label » (représentant la valeur affiché), et « valeur » (représentant la valeur écrite en base de données).</p>
<p>Exemples :</p>
<ul class="simple">
<li><p><cite>[{« label »: « Trois », « value »: 3}, {« label »: « Quatre », « value »: 4}]</cite></p></li>
<li><p><cite>[{« label »: « 1 », « value »: « Étude générale »}, {« label »: « Gestion de site », « value »: « 2 »}, {« label »: « Partenariat », « value »: « 3 »}]</cite></p></li>
<li><p>Un champs type « multiselect »:</p></li>
</ul>
<img alt="_images/label_value_multiselect.png" src="_images/label_value_multiselect.png" />
<ul class="simple">
<li><p>Un champs type « html ». C’est un champs de type « présentation », aucune valeur ne sera enregistré en base de données pour ce champs :</p></li>
</ul>
<img alt="_images/html1.png" src="_images/html1.png" />
<ul class="simple">
<li><p>Un champs de type « datalist ». Ce champs permet de générer une liste de valeurs à partir d’une API (non porté sur Occtax-mobile). Dans le champ « attributs additionnels », renseignez les éléments suivants :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>``{&quot;api&quot;: &quot;url_vers_la_ressource&quot;, &quot;keyValue&quot;: &quot;champ à stocker en base&quot;, &quot;keyLabel&quot;: &quot;champ à afficher en interface&quot;}
</pre></div>
</div>
<section id="configuration-avancee-des-champs">
<h4>Configuration avancée des champs<a class="headerlink" href="#configuration-avancee-des-champs" title="Lien vers cette rubrique">#</a></h4>
<p>Le champs « Attribut additionnels » permet d’ajouter des éléments de configuration sur les formulaires sour forme de JSON:</p>
<ul class="simple">
<li><p>Ajouter une icone « ? » et un tooltip au survol du formulaire : <cite>{« description » : « mon toolitp »}</cite></p></li>
<li><p>Ajouter un sous-titre descriptif : <cite>{« help » : « mon sous titre »}</cite></p></li>
<li><p>Ajouter des valeurs min/max pour un input <cite>number</cite> : <cite>{« min »: 1, « max »: 10}</cite></p></li>
</ul>
</section>
</section>
<section id="taxhub">
<h3>TaxHub<a class="headerlink" href="#taxhub" title="Lien vers cette rubrique">#</a></h3>
<p>Module de gestion des taxons (basé sur TaxHub) permettant de faire des listes de taxons ainsi que d’ajouter des attributs et des médias aux taxons.
Voir la documentation de TaxHub : <a class="reference external" href="https://taxhub.readthedocs.io/fr/">https://taxhub.readthedocs.io/fr/</a></p>
</section>
</section>
<section id="module-occhab">
<h2>Module OCCHAB<a class="headerlink" href="#module-occhab" title="Lien vers cette rubrique">#</a></h2>
<section id="id2">
<h3>Installer le module<a class="headerlink" href="#id2" title="Lien vers cette rubrique">#</a></h3>
<p>Le module OCCHAB fait partie du coeur de GeoNature. Son installation est au choix de l’administrateur.</p>
<p>Pour l’installer, lancer les commandes suivantes :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">cd backend</span>
<span class="go">source venv/bin/activate</span>
<span class="go">geonature install_gn_module /home/`whoami`/geonature/contrib/gn_module_occhab occtax</span>
</pre></div>
</div>
</section>
<section id="id3">
<h3>Base de données<a class="headerlink" href="#id3" title="Lien vers cette rubrique">#</a></h3>
<p>Le module s’appuie sur deux schémas :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ref_habitats</span></code> correspond au référentiel habitat du SINP,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pr_occhab</span></code> correspond au schéma qui contient les données d’occurrence d’habitat, basé sur standard du SINP.</p></li>
</ul>
</section>
<section id="id4">
<h3>Configuration<a class="headerlink" href="#id4" title="Lien vers cette rubrique">#</a></h3>
<p>Le paramétrage du module OCCHAB se fait en créant le fichier <code class="docutils literal notranslate"><span class="pre">config/occhab_config.toml</span></code>, en s’inspirant du fichier d’exemple <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_occhab/occhab_config.toml.example</span></code>.</p>
<p>Reportez vous à la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration d’un gn_module</a> pour effectuer les opérations supplémentaires nécessaires pour la prise en compte des modifications.</p>
<section id="formulaire">
<h4>Formulaire<a class="headerlink" href="#formulaire" title="Lien vers cette rubrique">#</a></h4>
<ul class="simple">
<li><p>La liste des habitats fournie pour la saisie est basée sur une liste définie dans la base de données (table <code class="docutils literal notranslate"><span class="pre">ref_habitat.cor_list_habitat</span></code> et <code class="docutils literal notranslate"><span class="pre">ref_habitat.bib_list_habitat</span></code>). Il est possible de modifier cette liste directement dnns la base de données, d’en créer une autre et de changer la liste utiliser par le module. Modifier alors ce paramètre :</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">ID_LIST_HABITAT</span> <span class="pre">=</span> <span class="pre">1</span></code></p>
<ul class="simple">
<li><p>Le formulaire permet de saisir des observateurs basés sur le référentiel utilisateurs (<code class="docutils literal notranslate"><span class="pre">false</span></code>) ou de les saisir en texte libre (<code class="docutils literal notranslate"><span class="pre">true</span></code>).</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">OBSERVER_AS_TXT</span> <span class="pre">=</span> <span class="pre">false</span></code></p>
<ul class="simple">
<li><p>L’ensemble des champs du formulaire son masquables. Pour en masquer certains, passer à <code class="docutils literal notranslate"><span class="pre">false</span></code> les variables suivantes :</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">formConfig</span><span class="p">]</span>
  <span class="n">date_min</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">date_max</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">depth_min</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">depth_max</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">altitude_min</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">altitude_max</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">exposure</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">area</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">comment</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">area_surface_calculation</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">geographic_object</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">determination_type</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">determiner</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">collection_technique</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">technical_precision</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">recovery_percentage</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">abundance</span> <span class="o">=</span> <span class="n">true</span>
  <span class="n">community_interest</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
<p>Voir le fichier <code class="docutils literal notranslate"><span class="pre">occhab_config.example</span></code> qui liste l’ensemble des paramètres de configuration du module.</p>
</section>
</section>
</section>
<section id="module-synthese">
<h2>Module SYNTHESE<a class="headerlink" href="#module-synthese" title="Lien vers cette rubrique">#</a></h2>
<p>Le module Synthèse est un module du coeur de GeoNature, fourni par défaut lors de l’installation.</p>
<section id="id5">
<h3>Configuration<a class="headerlink" href="#id5" title="Lien vers cette rubrique">#</a></h3>
<p>L’ensemble des paramètres de configuration du module se trouve dans le fichier général de configuration de GeoNature <code class="docutils literal notranslate"><span class="pre">config/geonature_config.toml</span></code> puisqu’il s’agit d’un module du coeur.</p>
<p><strong>1.</strong> Modifier les filtres géographiques disponibles par défaut dans l’interface de recherche.</p>
<p>Editer la variable <code class="docutils literal notranslate"><span class="pre">AREA_FILTERS</span></code> en y ajoutant le label et le code du type d’entité géographique que vous souhaitez rajouter. Voir table <code class="docutils literal notranslate"><span class="pre">ref_geo.bib_areas_types</span></code>. Dans l’exemple on ajoute le type ZNIEFF1 (<code class="docutils literal notranslate"><span class="pre">code_type</span> <span class="pre">=</span> <span class="pre">&quot;ZNIEFF1&quot;</span></code>). Attention, dans ce cas les entités géographiques correspondantes au type <cite>ZNIEFF1</cite>, doivent également être présentes dans la table <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>.
Attention : Si des données sont déjà présentes dans la synthèse et que l’on ajoute de nouvelles entités géographiques à <code class="docutils literal notranslate"><span class="pre">ref_geo.l_areas</span></code>, il faut également recalculer les valeurs de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> qui assure la correspondance entre les données de la synthèse et les entités géographiques.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
    <span class="c1"># Liste des entités géographiques sur lesquels les filtres</span>
    <span class="c1"># géographiques de la synthese s&#39;appuient (type_code = code du type de l&#39;entité géo, table ref_geo.bib_areas_types)</span>
    <span class="n">AREA_FILTERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Communes&quot;</span><span class="p">,</span> <span class="n">type_code</span> <span class="o">=</span> <span class="s2">&quot;COM&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;ZNIEFF1&quot;</span><span class="p">,</span> <span class="n">type_code</span> <span class="o">=</span> <span class="s2">&quot;ZNIEFF1&quot;</span> <span class="p">},</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Il est aussi possible de passer plusieurs <code class="docutils literal notranslate"><span class="pre">type_code</span></code> regroupés dans un même filtre géographique (exemple : <code class="docutils literal notranslate"><span class="pre">{</span> <span class="pre">label</span> <span class="pre">=</span> <span class="pre">&quot;Zonages</span> <span class="pre">réglementaires&quot;,</span> <span class="pre">type_code</span> <span class="pre">=</span> <span class="pre">[&quot;ZC&quot;,</span> <span class="pre">&quot;ZPS&quot;,</span> <span class="pre">&quot;SIC&quot;]</span> <span class="pre">}</span></code>).</p>
<p><strong>2.</strong> Configurer les champs des exports</p>
<p>Dans tous les exports, l’ordre et le nom des colonnes sont basés sur la vue SQL servant l’export.</p>
<p><strong>Export des observations</strong></p>
<p>Les exports (CSV, GeoJSON, Geopackage, Shapefile) sont basés sur la vue <code class="docutils literal notranslate"><span class="pre">gn_synthese.v_synthese_for_export</span></code>.</p>
<p>Il est possible de ne pas intégrer certains champs présents dans cette vue d’export. Pour cela modifier le paramètre <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code>.</p>
<p>Enlevez la ligne de la colonne que vous souhaitez désactiver. Les noms de colonne de plus de 10 caractères seront tronqués dans l’export au format shapefile.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
    <span class="n">EXPORT_COLUMNS</span>   <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;date_debut&quot;</span><span class="p">,</span>
      <span class="s2">&quot;date_fin&quot;</span><span class="p">,</span>
      <span class="s2">&quot;heure_debut&quot;</span><span class="p">,</span>
      <span class="s2">&quot;heure_fin&quot;</span><span class="p">,</span>
      <span class="s2">&quot;cd_nom&quot;</span><span class="p">,</span>
      <span class="s2">&quot;cd_ref&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nom_valide&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nom_vernaculaire&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nom_cite&quot;</span><span class="p">,</span>
      <span class="s2">&quot;regne&quot;</span><span class="p">,</span>
      <span class="s2">&quot;group1_inpn&quot;</span><span class="p">,</span>
      <span class="s2">&quot;group2_inpn&quot;</span><span class="p">,</span>
      <span class="s2">&quot;classe&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ordre&quot;</span><span class="p">,</span>
      <span class="s2">&quot;famille&quot;</span><span class="p">,</span>
      <span class="s2">&quot;rang_taxo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nombre_min&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nombre_max&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alti_min&quot;</span><span class="p">,</span>
      <span class="s2">&quot;alti_max&quot;</span><span class="p">,</span>
      <span class="s2">&quot;prof_min&quot;</span><span class="p">,</span>
      <span class="s2">&quot;prof_max&quot;</span><span class="p">,</span>
      <span class="s2">&quot;observateurs&quot;</span><span class="p">,</span>
      <span class="s2">&quot;determinateur&quot;</span><span class="p">,</span>
      <span class="s2">&quot;communes&quot;</span><span class="p">,</span>
      <span class="s2">&quot;x_centroid_4326&quot;</span><span class="p">,</span>
      <span class="s2">&quot;y_centroid_4326&quot;</span><span class="p">,</span>
      <span class="s2">&quot;geometrie_wkt_4326&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nom_lieu&quot;</span><span class="p">,</span>
      <span class="s2">&quot;comment_releve&quot;</span><span class="p">,</span>
      <span class="s2">&quot;comment_occurrence&quot;</span><span class="p">,</span>
      <span class="s2">&quot;validateur&quot;</span><span class="p">,</span>
      <span class="s2">&quot;niveau_validation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;date_validation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;comment_validation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;preuve_numerique_url&quot;</span><span class="p">,</span>
      <span class="s2">&quot;preuve_non_numerique&quot;</span><span class="p">,</span>
      <span class="s2">&quot;jdd_nom&quot;</span><span class="p">,</span>
      <span class="s2">&quot;jdd_uuid&quot;</span><span class="p">,</span>
      <span class="s2">&quot;jdd_id&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ca_nom&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ca_uuid&quot;</span><span class="p">,</span>
      <span class="s2">&quot;ca_id&quot;</span><span class="p">,</span>
      <span class="s2">&quot;cd_habref&quot;</span><span class="p">,</span>
      <span class="s2">&quot;cd_habitat&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nom_habitat&quot;</span><span class="p">,</span>
      <span class="s2">&quot;precision_geographique&quot;</span><span class="p">,</span>
      <span class="s2">&quot;nature_objet_geo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type_regroupement&quot;</span><span class="p">,</span>
      <span class="s2">&quot;methode_regroupement&quot;</span><span class="p">,</span>
      <span class="s2">&quot;technique_observation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;biologique_statut&quot;</span><span class="p">,</span>
      <span class="s2">&quot;etat_biologique&quot;</span><span class="p">,</span>
      <span class="s2">&quot;biogeographique_statut&quot;</span><span class="p">,</span>
      <span class="s2">&quot;naturalite&quot;</span><span class="p">,</span>
      <span class="s2">&quot;preuve_existante&quot;</span><span class="p">,</span>
      <span class="s2">&quot;niveau_precision_diffusion&quot;</span><span class="p">,</span>
      <span class="s2">&quot;stade_vie&quot;</span><span class="p">,</span>
      <span class="s2">&quot;sexe&quot;</span><span class="p">,</span>
      <span class="s2">&quot;objet_denombrement&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type_denombrement&quot;</span><span class="p">,</span>
      <span class="s2">&quot;niveau_sensibilite&quot;</span><span class="p">,</span>
      <span class="s2">&quot;statut_observation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;floutage_dee&quot;</span><span class="p">,</span>
      <span class="s2">&quot;statut_source&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type_info_geo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;methode_determination&quot;</span><span class="p">,</span>
      <span class="s2">&quot;comportement&quot;</span><span class="p">,</span>
      <span class="s2">&quot;reference_biblio&quot;</span><span class="p">,</span>
      <span class="s2">&quot;id_synthese&quot;</span><span class="p">,</span>
      <span class="s2">&quot;id_origine&quot;</span><span class="p">,</span>
      <span class="s2">&quot;uuid_perm_sinp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;uuid_perm_grp_sinp&quot;</span><span class="p">,</span>
      <span class="s2">&quot;date_creation&quot;</span><span class="p">,</span>
      <span class="s2">&quot;date_modification&quot;</span>
    <span class="p">]</span>
</pre></div>
</div>
<dl class="field-list simple">
<dt class="field-odd">Note<span class="colon">:</span></dt>
<dd class="field-odd"><p>L’entête <code class="docutils literal notranslate"><span class="pre">[SYNTHESE]</span></code> au dessus <code class="docutils literal notranslate"><span class="pre">EXPORT_COLUMNS</span></code> indique simplement que cette variable appartient au bloc de configuration de la synthese. Ne pas rajouter l’entête à chaque paramètre de la synthese mais une seule fois au dessus de toutes les variables de configuration du module.</p>
</dd>
</dl>
<p>Il est également possible de personnaliser ses exports en créant vos propres vues personnalisées et en remplissant le paramètre suivant avec une ou plusieurs vues d’export spécifiques :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
  <span class="o">...</span>
  <span class="n">EXPORT_OBSERVATIONS_CUSTOM_VIEWS</span> <span class="o">=</span> <span class="p">[</span>
      <span class="p">{</span>
          <span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;format personnalisé&quot;</span><span class="p">,</span>
          <span class="n">view_name</span> <span class="o">=</span> <span class="s2">&quot;gn_synthese.v_synthese_for_web_app&quot;</span><span class="p">,</span>
      <span class="p">}</span>
  <span class="p">]</span>
</pre></div>
</div>
<p>Ces vues doivent obligatoirement avoir une colonne <cite>id_synthese</cite>, une colonne <cite>geojson_local</cite> représentant le geojson de la géometrie en projection locale (pour la génération du shapefile et geopackage) et une colonne <cite>geojson_4326</cite> représentant le geojson de la géométrie en projection 4326 (pour la génération du geojson) (utilisez la fonction <cite>st_asgeojson</cite> - voir la vue par défaut <cite>gn_synthese.v_synthese_for_export</cite>).</p>
<p>Selon les permissions de l’utilisation sur l’action « Export » du module Synthèse, le floutage pourra s’appliquer automatiquement à la vue d’export sur les mêmes champs géométriques que la vue <cite>gn_synthese.v_synthese_for_export</cite>, à savoir <cite>geometrie_wkt_4326</cite>, <cite>x_centroid_4326</cite>, <cite>y_centroid_4326</cite>, <cite>geojson_local</cite> et <cite>geojson_4326</cite>. Si vous ajoutez des champs représentant la géométrie de l’observation portant des noms différents que les 4 noms précités, ceux-ci ne pourront pas être floutés.</p>
<p><strong>Export des métadonnées</strong></p>
<p>En plus des observations brutes, il est possible d’effectuer un export des métadonnées associées aux observations. L’export est au format CSV et est construit à partir de la vue <code class="docutils literal notranslate"><span class="pre">gn_synthese.v_metadata_for_export</span></code>.</p>
<p>Deux champs sont cependant obligatoires dans cette vue :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">jdd_id</span></code> (qui correspond à l’id du JDD de la table <code class="docutils literal notranslate"><span class="pre">gn_meta.t_datasets</span></code>). Le nom de ce champs est modifiable. Si vous le modifiez, éditez la variable <code class="docutils literal notranslate"><span class="pre">EXPORT_METADATA_ID_DATASET_COL</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">acteurs</span></code>:  Le nom de ce champs est modifiable. Si vous le modifiez, éditez la variable <code class="docutils literal notranslate"><span class="pre">EXPORT_METADATA_ACTOR_COL</span></code></p></li>
</ul>
<p><strong>Export des statuts taxonomiques (réglementations)</strong></p>
<p>Cet export n’est pas basé sur une vue.</p>
<p><strong>3.</strong> Configurer les seuils du nombre de données pour la recherche et les exports</p>
<p>Par défaut et pour des questions de performance (du navigateur et du serveur) on limite à 50000 le nombre de résultats affichés sur la carte et le nombre d’observations dans les exports.</p>
<p>Ces seuils sont modifiables respectivement par les variables <code class="docutils literal notranslate"><span class="pre">NB_MAX_OBS_MAP</span></code> et <code class="docutils literal notranslate"><span class="pre">NB_MAX_OBS_EXPORT</span></code> :</p>
<p>Le mode cluster activé par défaut peut être désactivé via le paramètre <code class="docutils literal notranslate"><span class="pre">ENABLE_LEAFLET_CLUSTER</span></code>. Dans ce cas, il est conseillé de repasser le paramètre <cite>NB_MAX_OBS_MAP</cite> à 10000.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
    <span class="c1"># Nombre d&#39;observation maximum à afficher sur la carte après une recherche</span>
    <span class="n">NB_MAX_OBS_MAP</span> <span class="o">=</span> <span class="mi">10000</span>
    <span class="c1"># Nombre max d&#39;observation dans les exports</span>
    <span class="n">NB_MAX_OBS_EXPORT</span> <span class="o">=</span> <span class="mi">40000</span>
</pre></div>
</div>
<p><strong>4.</strong> Désactiver des filtres génériques</p>
<p>L’interface de recherche de la synthèse permet de filtrer sur l’ensemble des nomenclatures de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese</span></code>, il est cependant possible de désactiver les filtres de certains champs.</p>
<p>Modifiez la variable <code class="docutils literal notranslate"><span class="pre">EXCLUDED_COLUMNS</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
    <span class="n">EXCLUDED_COLUMNS</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;non_digital_proof&#39;</span><span class="p">]</span> <span class="c1"># pour enlever le filtre &#39;preuve non numérique&#39;</span>
</pre></div>
</div>
<p><strong>5.</strong> Configurer les filtres des statuts de protection et des listes rouges</p>
<p>Il existe deux paramètres qui permettent de configurer les statuts de protection et les listes rouges à afficher dans la fenêtre avancée du module Synthese.</p>
<p>Il s’agit de :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">RED_LISTS_FILTERS</span></code> : pour configurer les listes rouges. Les listes déroulantes configurées affichent les codes et intitulés des valeurs des listes (<em>CR - En danger critique</em>, <em>DD - Données insuffisantes</em>, …).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">STATUS_FILTERS</span></code> : pour configurer les statuts de protection. Les listes déroulantes configurées affichent l’intitulé suivi du code des types de textes (<em>Protection départementale - PD</em>, <em>Protection nationale - PN</em>).</p></li>
</ul>
<p>Ces paramètres se présentent sous la forme d’une liste de dictionnaires. Il est possible d’ajouter de nouveaux filtres en ajoutant de nouveaux dictionnaires à la liste.</p>
<p>Voici un exemple :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
    <span class="n">RED_LISTS_FILTERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;worldwide&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Liste rouge mondiale&quot;</span><span class="p">,</span> <span class="s2">&quot;status_type&quot;</span> <span class="o">=</span> <span class="s2">&quot;LRM&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;european&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Liste rouge européenne&quot;</span><span class="p">,</span> <span class="s2">&quot;status_type&quot;</span> <span class="o">=</span> <span class="s2">&quot;LRE&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;national&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Liste rouge nationale&quot;</span><span class="p">,</span> <span class="s2">&quot;status_type&quot;</span> <span class="o">=</span> <span class="s2">&quot;LRN&quot;</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;regional&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Liste rouge régionale&quot;</span><span class="p">,</span> <span class="s2">&quot;status_type&quot;</span> <span class="o">=</span> <span class="s2">&quot;LRR&quot;</span> <span class="p">},</span>
    <span class="p">]</span>
    <span class="n">STATUS_FILTERS</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;protections&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Taxons protégés&quot;</span><span class="p">,</span> <span class="s2">&quot;status_types&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;PN&quot;</span><span class="p">,</span> <span class="s2">&quot;PR&quot;</span><span class="p">,</span> <span class="s2">&quot;PD&quot;</span><span class="p">]</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;regulations&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Taxons réglementés&quot;</span><span class="p">,</span> <span class="s2">&quot;status_types&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;REGLII&quot;</span><span class="p">,</span> <span class="s2">&quot;REGL&quot;</span><span class="p">,</span> <span class="s2">&quot;REGLSO&quot;</span><span class="p">]</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;invasive&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Espèces envahissantes&quot;</span><span class="p">,</span> <span class="s2">&quot;status_types&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;REGLLUTTE&quot;</span><span class="p">]</span> <span class="p">},</span>
        <span class="p">{</span> <span class="s2">&quot;id&quot;</span> <span class="o">=</span> <span class="s2">&quot;znief&quot;</span><span class="p">,</span> <span class="s2">&quot;show&quot;</span> <span class="o">=</span> <span class="n">true</span><span class="p">,</span> <span class="s2">&quot;display_name&quot;</span> <span class="o">=</span> <span class="s2">&quot;Espèces déterminantes ZNIEFF&quot;</span><span class="p">,</span> <span class="s2">&quot;status_types&quot;</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ZDET&quot;</span><span class="p">]</span> <span class="p">},</span>
    <span class="p">]</span>
</pre></div>
</div>
<p>Pour chaque dictionnaire, voici le détail des champs (ils sont tous obligatoires) :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">id</span></code> : correspond à un mot clé (sans caractères spéciaux ou accentués) qui doit être unique dans la liste.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">show</span></code> : permet de rapidement afficher (= <code class="docutils literal notranslate"><span class="pre">true</span></code>) ou cacher (= <code class="docutils literal notranslate"><span class="pre">false</span></code>) un filtre sur l’interface sans avoir à supprimer la ligne.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">display_name</span></code> : indique le texte de l’intitulé de la liste déroulante qui sera affiché sur l’interface.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">status_type</span></code> : pour les statuts de protection cela correspond à une liste des codes de types de statuts de protections à afficher dans la liste déroulante. Les codes existant sont consultables dans le champ <code class="docutils literal notranslate"><span class="pre">cd_type_statut</span></code> de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_type</span></code>. Pour les listes rouges, il faut seulement indiquer le code de la liste.</p></li>
</ul>
<p>Au niveau de la base de données, il est possible de limiter les recherches uniquement aux textes correspondant à la zone géographique des observations de votre installation.
Pour cela, il suffit de mettre une valeur <code class="docutils literal notranslate"><span class="pre">false</span></code> dans le champ <code class="docutils literal notranslate"><span class="pre">enable</span></code> de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_text</span></code> pour tous les textes que vous ne souhaitez pas prendre en compte. Si vous avez une grande quantité d’observations, cette étape est fortement recommandée !</p>
<p>Exemple de requête de mise à jour de la table <code class="docutils literal notranslate"><span class="pre">taxonomie.bdc_statut_text</span></code> pour désactiver les textes des DOM-TOM : :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">UPDATE</span> <span class="n">taxonomie</span><span class="o">.</span><span class="n">bdc_statut_text</span> <span class="n">SET</span> <span class="n">enable</span> <span class="o">=</span> <span class="n">false</span>
<span class="n">WHERE</span> <span class="n">cd_sig</span> <span class="n">IN</span> <span class="p">(</span><span class="s1">&#39;TER971&#39;</span><span class="p">,</span> <span class="s1">&#39;TER972&#39;</span><span class="p">,</span> <span class="s1">&#39;TER973&#39;</span><span class="p">,</span> <span class="s1">&#39;TER971&#39;</span><span class="p">,</span> <span class="s1">&#39;TER974&#39;</span> <span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
<p>Une commande dans TaxHub permet de désactiver automatiquement les textes en dehors d’une liste de départements (en passant leur <code class="docutils literal notranslate"><span class="pre">area_code</span></code>) :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">~/</span><span class="n">geonature</span><span class="o">/</span><span class="n">backend</span><span class="o">/</span><span class="n">venv</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">activate</span>
<span class="n">geonature</span> <span class="n">taxref</span> <span class="n">enable</span><span class="o">-</span><span class="n">bdc</span><span class="o">-</span><span class="n">statut</span><span class="o">-</span><span class="n">text</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">MON_DEP_1</span><span class="o">&gt;</span> <span class="o">-</span><span class="n">d</span> <span class="o">&lt;</span><span class="n">MON_DEP_2</span><span class="o">&gt;</span> <span class="o">--</span><span class="n">clean</span>
</pre></div>
</div>
<p><strong>6.</strong> Définir des filtres par défaut</p>
<p>Il s’agit du paramètre <code class="docutils literal notranslate"><span class="pre">DEFAULT_FILTERS</span></code>.
C’est un dictionnaire qui liste la valeur des champs par défaut.
Il faut fournir le code des nomenclature par défaut (liste de chaîne de caractère).
(On prend les champs en <code class="docutils literal notranslate"><span class="pre">id_nomenclature_...</span></code> et on remplace <code class="docutils literal notranslate"><span class="pre">id_nomenclature_</span></code> par <code class="docutils literal notranslate"><span class="pre">cd_nomenclature_</span></code>)</p>
<p>Exemple de filtres par défaut :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">SYNTHESE</span><span class="p">]</span>
<span class="o">...</span>

<span class="p">[</span><span class="n">SYNTHESE</span><span class="o">.</span><span class="n">DEFAULT_FILTERS</span><span class="p">]</span>
    <span class="c1"># Tous les statuts de validation sauf invalide &#39;4&#39;</span>
    <span class="c1"># Il faut bien les renseigner en tant que chaîne de caractère (et non en tant que nombre)</span>
    <span class="n">cd_nomenclature_valid_status</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">,</span> <span class="s1">&#39;3&#39;</span><span class="p">,</span> <span class="s1">&#39;5&#39;</span><span class="p">,</span> <span class="s1">&#39;6&#39;</span><span class="p">]</span>
    <span class="c1"># Seulement les données de présence</span>
    <span class="n">cd_nomenclature_observation_status</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Pr&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>D’autres élements sont paramètrables dans le module Synthese. La liste complète est disponible dans le fichier <code class="docutils literal notranslate"><span class="pre">config/default_config.toml.example</span></code> rubrique <code class="docutils literal notranslate"><span class="pre">SYNTHESE</span></code>.</p>
</section>
</section>
<section id="module-validation">
<h2>Module VALIDATION<a class="headerlink" href="#module-validation" title="Lien vers cette rubrique">#</a></h2>
<p>Le module VALIDATION, integré depuis la version 2.1.0 dans le coeur de GeoNature permet de valider des occurrences de taxon en s’appuyant sur les données présentes dans la SYNTHESE. Le module s’appuie sur le <a class="reference external" href="http://www.naturefrance.fr/la-reunion/protocole-de-validation">standard Validation</a> du SINP et sur ses <a class="reference external" href="http://standards-sinp.mnhn.fr/nomenclature/80-niveaux-de-validation-validation-manuelle-ou-combinee-2018-05-14/">nomenclatures officiels</a>.</p>
<p>Afin de valider une occurrence, celle-ci doit impérativement avoir un UUID. En effet, la validation est stockée en BDD dans la table transversale <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code>  (<a class="reference external" href="admin-manual.html#tables-transversales">voir doc</a> ) qui impose la présence de cet UUID.</p>
<p>La table <code class="docutils literal notranslate"><span class="pre">gn_commons.t_validations</span></code> contient l’ensemble de l’historique de validation des occurrences. Pour une même occurrence (identifiée par un UUID unique) on peut donc retrouver plusieurs lignes dans la table correspondant au différents statuts de validation attribués à cet occurrence dans le temps.</p>
<p>La vue <code class="docutils literal notranslate"><span class="pre">gn_commons.v_latest_validation</span></code> permet de récupérer le dernier statut de validation d’une occurrence.</p>
<p>NB : une donnée non présente dans la SYNTHESE, ne remontera pas dans l’interface du module VALIDATION. Cependant rien n’empêche un administrateur avancé d’utiliser la table de validation et son mécanisme pour des données qui ne seraient pas en SYNTHESE (du moment que les données disposent d’un UUID).</p>
<p>Au niveau de l’interface, le formulaire de recherche est commun avec le module SYNTHESE. Les paramètres de configuration du formulaire sont donc également partagés et administrables depuis le fichier <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>, rubrique SYNTHESE.</p>
<section id="id6">
<h3>Configuration<a class="headerlink" href="#id6" title="Lien vers cette rubrique">#</a></h3>
<p>Le paramétrage du module VALIDATION se fait en créant le fichier <code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code>, en s’inspirant du fichier d’exemple <code class="docutils literal notranslate"><span class="pre">contrib/gn_module_validation/validation_config.toml.example</span></code>
Reportez vous à la section <a class="reference internal" href="#configuration-d-un-gn-module">Configuration d’un gn_module</a> pour effectuer les opérations supplémentaires nécessaires pour la prise en compte des modifications.</p>
<section id="liste-des-champs-visibles">
<h4>Liste des champs visibles<a class="headerlink" href="#liste-des-champs-visibles" title="Lien vers cette rubrique">#</a></h4>
<p>Gestion de l’affichage des colonnes de la liste via le paramètre <code class="docutils literal notranslate"><span class="pre">COLUMN_LIST</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[[</span><span class="n">COLUMN_LIST</span><span class="p">]]</span>
<span class="n">column_label</span> <span class="o">=</span> <span class="s2">&quot;nomenclature_life_stage.label_default&quot;</span> <span class="c1"># Champs de la synthèse, éventuellement en suivant des relationships</span>
<span class="n">column_name</span> <span class="o">=</span> <span class="s2">&quot;Stade de vie&quot;</span> <span class="c1"># Titre de la colonne</span>
<span class="n">min_width</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Taille minimale de la colonne</span>
<span class="n">max_width</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># Taille maximale de la colonne</span>
</pre></div>
</div>
</section>
<section id="e-mail">
<h4>E-mail<a class="headerlink" href="#e-mail" title="Lien vers cette rubrique">#</a></h4>
<p>Il est possible de personnaliser le message du mail envoyé aux observateurs.
Pour ce faire il faut modifier les  paramètres <code class="docutils literal notranslate"><span class="pre">MAIL_BODY</span></code> et <code class="docutils literal notranslate"><span class="pre">MAIL_SUBJECT</span></code></p>
<p>Pour afficher dans le mail des données relatives à l’observation ou au taxon il faut respecter la syntaxe suivante:
<code class="docutils literal notranslate"><span class="pre">${</span> <span class="pre">d.NOM_PROPRIETE</span> <span class="pre">}</span></code></p>
<p>Liste des propriétés disponibles :</p>
<ul class="simple">
<li><p>communes : liste des communes</p></li>
<li><p>medias : Titre, auteur et lien vers le média associée</p></li>
<li><p>data_link : lien vers l’observation dans son module de saisie</p></li>
<li><p>tous les champs de la synthèse (acquisition_framework, altitude_max, altitude_min, bio_status, blurring, cd_hab, cd_nom, comment_context, comment_description, date_min, depth_max, depth_min, determiner, diffusion_level, digital_proof, entity_source_pk_value, exist_proof, grp_method, grp_typ, last_action, life_stage, meta_create_date, meta_update_date, meta_v_taxref, meta_validation_date, nat_obj_geo, naturalness, nom_cite, non_digital_proof, obj_count, obs_technique, observation_status, observers, occ_behaviour, occ_stat_biogeo, place_name, precision, sample_number_proof, sensitivity, sex, source, type_count, unique_id_sinp, unique_id_sinp_grp, valid_status, validation_comment)</p></li>
<li><p>tous les champs du taxon (cd_nom, cd_ref, cd_sup, cd_taxsup, regne, ordre, classe, famille, group1_inpn, group2_inpn, id_rang, nom_complet, nom_habitat, nom_rang, nom_statut, nom_valide, nom_vern)</p></li>
</ul>
</section>
</section>
<section id="validation-automatique">
<h3>Validation automatique<a class="headerlink" href="#validation-automatique" title="Lien vers cette rubrique">#</a></h3>
<p>Depuis la version 2.14, il est possible d’activer la validation automatique d’observations.</p>
<section id="activation">
<h4>Activation<a class="headerlink" href="#activation" title="Lien vers cette rubrique">#</a></h4>
<p>L’activation de la validation automatique s’effectue en ajoutant la ligne suivante dans le fichier de configuration du module de validation <code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AUTO_VALIDATION_ENABLED</span> <span class="o">=</span> <span class="n">true</span>
</pre></div>
</div>
</section>
<section id="conditions-de-validation-automatique">
<h4>Conditions de validation automatique<a class="headerlink" href="#conditions-de-validation-automatique" title="Lien vers cette rubrique">#</a></h4>
<p>Une observation sera validée automatiquement si elle rencontre les conditions suivantes :</p>
<blockquote>
<div><ul class="simple">
<li><p>Son statut de validation est <code class="docutils literal notranslate"><span class="pre">En</span> <span class="pre">attente</span> <span class="pre">de</span> <span class="pre">validation</span></code></p></li>
<li><p>Si le score calculé à partir du profil de taxons est de 3. Se référer à la section <a class="reference internal" href="#profils-de-taxons">Profils de taxons</a> pour plus d’informations.</p></li>
</ul>
</div></blockquote>
<p>Si ces conditions sont remplies, alors le statut de validation de l’observation est mis à <code class="docutils literal notranslate"><span class="pre">Probable</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Si le comportement de validation automatique ne vous correspond pas, il est possible de définir soi-même ce dernier dans la base de données sous forme d’une fonction. Reportez-vous à la section <a class="reference internal" href="#modification-de-la-fonction-de-validation-automatique">Modification de la fonction de validation automatique</a> pour plus d’informations.</p>
</div>
</section>
<section id="modification-de-la-periodicite-de-la-validation-automatique">
<h4>Modification de la périodicité de la validation automatique<a class="headerlink" href="#modification-de-la-periodicite-de-la-validation-automatique" title="Lien vers cette rubrique">#</a></h4>
<p>Le processus de validation automatique est exécuté à une fréquence définie, par défaut toutes les heures. Si toutefois, vous souhaitez diminuer ou augmenter la durée entre chaque validation automatique, définissez cette dernière dans le fichier de configuration (<code class="docutils literal notranslate"><span class="pre">config/validation_config.toml</span></code>) dans la variable <code class="docutils literal notranslate"><span class="pre">AUTO_VALIDATION_CRONTAB</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">AUTO_VALIDATION_CRONTAB</span> <span class="o">=</span><span class="s2">&quot;*/1 * * * *&quot;</span>
</pre></div>
</div>
<p>Ce paramètre est composé de cinq valeurs, chacune séparée par un espace: minute, heure, jour du mois, mois de l’année, journée de la semaine. Dans l’exemple ci-dessus, il est indiqué que le processus d’auto-validation sera répété toutes les minutes. Pour plus d’informations, vous pouvez consulter la documentation de Celery à ce sujet : <a class="reference external" href="https://docs.celeryq.dev/en/stable/userguide/periodic-tasks.html#crontab-schedules">https://docs.celeryq.dev/en/stable/userguide/periodic-tasks.html#crontab-schedules</a>.</p>
<p><strong>Note</strong> Si vous ne voulez pas définir un des paramètres de périodicité, utilisez un astérisque (<code class="docutils literal notranslate"><span class="pre">*</span></code>).</p>
</section>
<section id="modification-de-la-fonction-de-validation-automatique">
<h4>Modification de la fonction de validation automatique<a class="headerlink" href="#modification-de-la-fonction-de-validation-automatique" title="Lien vers cette rubrique">#</a></h4>
<p>Dans GeoNature, la validation automatique est effectuée par une fonction en <code class="docutils literal notranslate"><span class="pre">PL/pgSQL</span></code> déclarée dans le schéma <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>. Si toutefois, le fonctionnement de celle-ci ne correspond pas à vos besoins, indiquez le nom de la nouvelle fonction dans la variable <code class="docutils literal notranslate"><span class="pre">AUTO_VALIDATION_SQL_FUNCTION</span></code>. Attention, cette fonction doit aussi être stockée dans le schema <code class="docutils literal notranslate"><span class="pre">gn_profiles</span></code>. Pour vous aider, n’hésitez pas à regarder la définition de la fonction par défaut nommée <code class="docutils literal notranslate"><span class="pre">fct_auto_validation</span></code>.</p>
</section>
</section>
</section>
<section id="module-taxhub">
<h2>Module TaxHub<a class="headerlink" href="#module-taxhub" title="Lien vers cette rubrique">#</a></h2>
<p>Depuis la version 2.15 de GeoNature, TaxHub est integré comme un module de GeoNature. Il est disponible depuis le module « Admin » de GeoNature.</p>
<p>L’emplacement de stockage des médias est contrôlé par le paramètre <cite>MEDIA_FOLDER</cite>. Les médias de TaxHub seront à l’emplacement <cite>&lt;MEDIA_FOLDER&gt;/taxhub</cite>. Par défaut tous les médias de GeoNature sont stockés dans le répertoire de GeoNature : <cite>&lt;GEONATURE_DIR&gt;/backend/media</cite>. Via ce paramètre, il est possible de mettre un chemin absolu pour stocker les médias n’importe où ailleurs sur votre serveur.</p>
<section id="gestion-des-permissions">
<h3>Gestion des permissions<a class="headerlink" href="#gestion-des-permissions" title="Lien vers cette rubrique">#</a></h3>
<p>La gestion des permissions du module TaxHub est entierement gérée par le module de gestion de permissions de GeoNature. Dans le cas d’une installation standalone de TaxHub, se réferer à la documentation de TaxHub pour la gestion des permissions.</p>
<p>Les permissions du module TaxHub peuvent être reglées aux trois niveaux (objets) suivants :</p>
<ul class="simple">
<li><p>TAXONS : permet voir et modifier des taxons (ajout de médias, d’attributs et association de taxons à des listes)</p></li>
<li><p>THEMES : permet de voir / créer / modifier / supprimer des thèmes. Les thèmes sont des groupes d’attributs</p></li>
<li><p>LISTES : permet de voir / créer / modifier / supprimer des listes de taxons</p></li>
<li><p>ATTRIBUTS : permet de voir / créer / modifier / supprimer des attributs de taxons</p></li>
</ul>
</section>
<section id="commandes-taxhub">
<h3>Commandes TaxHub<a class="headerlink" href="#commandes-taxhub" title="Lien vers cette rubrique">#</a></h3>
<p>Depuis la version 2.15, les commandes de TaxHub sont maintenant acessibles depuis la commande <cite>geonature</cite>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">geonature</span> <span class="n">taxref</span> <span class="n">info</span> <span class="c1"># avant flask taxref info</span>
<span class="n">geonature</span> <span class="n">taxref</span> <span class="n">enable</span><span class="o">-</span><span class="n">bdc</span><span class="o">-</span><span class="n">statut</span><span class="o">-</span><span class="n">text</span> <span class="c1"># avant flask taxref enable-bdc-statut-text</span>
<span class="n">geonature</span> <span class="n">taxref</span> <span class="n">migrate</span><span class="o">-</span><span class="n">to</span><span class="o">-</span><span class="n">v17</span> <span class="c1"># flask taxref migrate-to-v17</span>
</pre></div>
</div>
</section>
</section>
<section id="module-import">
<h2>Module Import<a class="headerlink" href="#module-import" title="Lien vers cette rubrique">#</a></h2>
<p>Ce module permet d’importer des données depuis un fichier CSV dans GeoNature.</p>
<section id="concepts">
<h3>Concepts<a class="headerlink" href="#concepts" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Destination.</strong> Une destination est déterminée par le module dans lequel on souhaite importer des données (e.g. Occhab, Synthèse, etc.).</p>
<p><strong>Entités.</strong> Une entité correspond à un objet dans une destination (e.g. <em>station</em> est une entité de la destination <em>Occhab</em>)</p>
</section>
<section id="faire-un-import-le-minimum-requis">
<h3>Faire un import, le minimum requis<a class="headerlink" href="#faire-un-import-le-minimum-requis" title="Lien vers cette rubrique">#</a></h3>
<p>Pour qu’un utilisateur puisse mener au bout un import, il doit posséder à minima les permissions suivantes :</p>
<ul class="simple">
<li><p>Création d’un import (C)</p></li>
<li><p>Voir les imports (R)</p></li>
<li><p>Voir des mappings (R)</p></li>
<li><p>Droit de créer/saisir dans le module de destination (C dans OccHab par ex.)</p></li>
<li><p>Voir les méta-données (R)</p></li>
</ul>
<p><strong>Jeu de données.</strong> Un import s’effectue dans un jeu de données, par conséquent, ce dernier doit :</p>
<ul class="simple">
<li><p>être associé aux modules de destination de l’import (Voir champ dans l’édition/création d’un JDD : Module(s) GeoNature associé(s) au jeu de données)</p></li>
<li><p>être actif.</p></li>
</ul>
</section>
<section id="deroulement-dun-import">
<h3>Déroulement d’un import<a class="headerlink" href="#deroulement-dun-import" title="Lien vers cette rubrique">#</a></h3>
<p>Dans le module d’import, trois actions sont possibles : la création d’un import, la modification de ce dernier et la suppression d’un import.
Lors du lancement de la création d’un import, il faut sélectionner la destination. Une fois la destination choisie, la phase de préparation de l’import se déroule de la manière suivante :</p>
<ol class="arabic simple">
<li><p>Téléverser le fichier contenant les données et sélection du jeu de données. Le format de fichier accepté est le CSV.</p></li>
<li><p>Définir les paramètres de lecture du fichier téléversé. Les données du fichier source sont stockées en binaire dans la table des imports (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.source_file</span></code>).</p></li>
<li><p>Faire correspondre les colonnes de votre fichier avec les champs du modèle de données défini dans le module de destination. Pour aider l’utilisateur dans le remplissage du formulaire, il est possible de sauvegarder et réutiliser des  _mappings_. Plusieurs mappings sont disponibles avec l’installation de GeoNature. Ces mappings permettent notamment de faire la correspondance des  colonnes d’un fichier produit par un export GeoNature (Occhab et Synthèse). Les correspondances de champs sont stockées dans un champs JSON dans <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.fieldmapping</span></code>.</p></li>
<li><p>Si des champs correspondant à des types de nomenclatures sont indiqués dans l’étape 3, une mise en correspondance des valeurs du fichier source avec les nomenclatures dans la base doit être faite. Si le fichier source comprend des lignes vides, on propose en plus de mapper le cas « Pas de valeur ». Tout comme la correspondance des champs, la correspondance des valeurs de nomenclature est sauvegardée dans un champs JSONB <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.valuemapping</span></code>.</p></li>
<li><p>Contrôles des données du fichier source sélectionnées (<a class="reference internal" href="admin/import-admin.html#controle-donnees"><span class="std std-ref">c.f. Contrôles de données</span></a>:).</p></li>
</ol>
<p>Une fois, cette phase de préparation terminée, l’utilisateur se voit présenter les données jugées comme valides (resp. les données invalides). A cette étape, l’utilisateur a la choix de modifier les données invalides dans son fichier source et recommencer le processus de préparation de l’import OU lancer l’import des données dans la destination.
Une fois l’import de données terminé, l’utilisateur est redirigé vers un rapport récapitulant les paramètres de l’import et un affichage de quelques statistiques spécifiques au type de données importées.
Une fois les données importées, les données sont supprimées de la table temporaire (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_synthese</span></code> pour la Synthèse, <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_occhab</span></code> pour Occhab).</p>
<img alt="_images/import_etapes.png" src="_images/import_etapes.png" />
</section>
<section id="configuration-du-module-dimport">
<h3>Configuration du module d’import<a class="headerlink" href="#configuration-du-module-dimport" title="Lien vers cette rubrique">#</a></h3>
<p>Vous pouvez surcoucher ces différents paramètres en les ajoutant directement dans le fichier de configuration principal de GeoNature (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>).</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ENCODAGE</p></td>
<td><p>Liste des encodages</p></td>
</tr>
<tr class="row-odd"><td><p>acceptés</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>INSTANCE_BOUNDING_BOX</p></td>
<td><p>Zone rectangulaire dans laquelle les données doivent être localisées</p></td>
</tr>
<tr class="row-odd"><td><p>ENABLE_BOUNDING_BOX_CHECK</p></td>
<td><p>Activer la vérification de l’appartenance des données importées à la bounding box définie dans INSTANCE_BOUNDING_BOX</p></td>
</tr>
<tr class="row-even"><td><p>ENABLE_SYNTHESE_UUID_CHECK</p></td>
<td><p>Activer la vérification des UUID dans les données importées avec ceux de la Synthèse</p></td>
</tr>
<tr class="row-odd"><td><p>MAX_FILE_SIZE</p></td>
<td><p>Taille maximale du fichier chargé (en Mo)</p></td>
</tr>
<tr class="row-even"><td><p>SRID</p></td>
<td><p>SRID autorisés pour les fichiers en entrée</p></td>
</tr>
<tr class="row-odd"><td><p>ALLOWED_EXTENSIONS</p></td>
<td><p>Extensions autorisées (seul le format CSV est accepté actuellement)</p></td>
</tr>
<tr class="row-even"><td><p>ALLOW_VALUE_MAPPING</p></td>
<td><p>Activer ou non l’étape du mapping des valeurs</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_VALUE_MAPPING_ID</p></td>
<td><p>Si le mapping des valeurs est désactivé, specifier l’identifiant du mapping qui doit être utilisé</p></td>
</tr>
<tr class="row-even"><td><p>FILL_MISSING_NOMENCLATURE_WITH_DEFAULT_VALUE</p></td>
<td><p>Rempli les valeurs de nomenclature erronées par la valeur par défaut</p></td>
</tr>
<tr class="row-odd"><td><p>DISPLAY_CHECK_BOX_MAPPED_FIELD</p></td>
<td><p>Afficher le bouton pour afficher/masquer les champs déjà mappés</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_PRIVATE_JDD_BLURING</p></td>
<td><p>Active la vérification de l’existence du champs « floutage » si le JDD est privé</p></td>
</tr>
<tr class="row-odd"><td><p>CHECK_REF_BIBLIO_LITTERATURE</p></td>
<td><p>Active la vérification de la référence bibliographique fournie si la valeur du champs source = « litterature »</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_EXIST_PROOF</p></td>
<td><p>Active la vérification qu’une preuve d’existence est fournie si preuve existence = « oui »</p></td>
</tr>
<tr class="row-odd"><td><p>EXPORT_REPORT_PDF_FILENAME</p></td>
<td><p>Customiser le nom du fichier de rapport de l’import</p></td>
</tr>
<tr class="row-even"><td><p>DEFAULT_RANK</p></td>
<td><p>Paramètre pour définir le rang utilisé pour le diagramme camembert du rapport d’import.</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_GENERATE_MISSING_UUID</p></td>
<td><p>L’UUID d’une entité importée sera généré s’il n’est pas indiqué dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>ID_AREA_RESTRICTION</p></td>
<td><p>Identifiant d’une géométrie présente dans RefGeo. Si différent de -1, vérifie si les géométries des entités importées sont bien dans l’emprise spatiale de cette dernière.</p></td>
</tr>
<tr class="row-odd"><td><p>ID_LIST_TAXA_RESTRICTION</p></td>
<td><p>Identifiant d’une liste de taxons permettant de restreindre l’import d’observations dont les taxons appartiennent à cette dernière</p></td>
</tr>
<tr class="row-even"><td><p>MODULE_URL</p></td>
<td><p>URL d’accès au module d’import</p></td>
</tr>
<tr class="row-odd"><td><p>DATAFRAME_BATCH_SIZE</p></td>
<td><p>Taille des <cite>batch</cite> de données importées en même temps</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
</section>
<section id="permissions-de-limport">
<h3>Permissions de l’import<a class="headerlink" href="#permissions-de-limport" title="Lien vers cette rubrique">#</a></h3>
<p>Dans le module Import, il existe le jeu de permissions suivant :</p>
<ul class="simple">
<li><p>Création d’un import – C</p></li>
<li><p>Voir les imports – R</p></li>
<li><p>Modifier des imports – U (nécessaire d’avoir le C)</p></li>
<li><p>Supprimer des imports – D</p></li>
<li><p>Créer des mappings - C</p></li>
<li><p>Voir des mappings - R</p></li>
<li><p>Modifier des mappings - U</p></li>
<li><p>Supprimer des mappings - D</p></li>
</ul>
<p><strong>Scope.</strong> Similaire à d’autres permissions dans GeoNature, il est possible de limiter l’accès à l’utilisateur sur les données sur lesquelles il peut agir. L’ ajout de scope sur une permission de l’import limite  la visibilité des imports dans l’interface « Liste des Imports » ainsi que la possibilité (resp. impossbilité) de modifier ou supprimer un import. Par exemple,  un R2 sur « IMPORT » permet uniquement de voir les imports effectués par soi-même ou un utilisateur de son organisme.
A noter! La liste des jeux de données disponibles s’appuie bien sur les permissions de l’utilisateur dans ce dernier !</p>
<p><strong>Mapping.</strong> Certains mappings sont définis comme « public » et sont accessibles à tout le monde. Seuls les administrateurs (U=3) et les propriétaires de ces mappings peuvent les modifier. Si vous modifiez un mapping sur lequel vous n’avez pas les droits, il vous sera proposé de créer un nouveau mapping vous appartenant avec les modifications que vous avez faites, mais sans modifier le mapping initial.</p>
<p><strong>Jeu de données accessibles à l’import.</strong> Les jeux de données selectionnables par un utilisateur lors de la création d’un import sont eux controlés par les permissions sur le C de l’objet « import » (combiné au R du module « Métadonnées). Les mappings constituent un « objet » du module d’import disposant de droits paramétrables pour les différents utilisateurs, indépendamment des permissions sur les imports. Le réglage des permissions se fait dans le module « Admin » de GeoNature (« Admin » -&gt; « Permissions »).</p>
</section>
<section id="modification-et-suppression-d-un-import">
<h3>Modification et Suppression d’un import<a class="headerlink" href="#modification-et-suppression-d-un-import" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Comment sait-on qu’un import est terminé ?</strong> Si une date apparait dans la colonne « Fin import » de la liste des imports, alors l’import est terminé.</p>
<p><strong>Suppression d’un import</strong> La suppression d’un import implique : la supression de l’import (l’objet) et <strong>les données importées dans la table transitoire</strong>. Si l’import est terminé, les données importées dans la destination sont supprimées. Dans le cas d’une destination avec plusieurs entités, si l’entité mère est associée à des entités filles ajoutées en dehors de l’import (un habitat est rajouté sur un station importée par exemple), la supression est bloquée.</p>
<p><strong>Modification d’un import</strong> Lors de la modification d’un import, vous serez redirigez vers l’étape de « Correspondances de champs ». Si vous modifiez la correspondance des champs en cliquant sur « Suivant », cela entrainera la suppression des données dans la table transitoire et dans la destination si l’import est terminé.</p>
</section>
<section id="controles-de-donnees">
<h3>Contrôles de données<a class="headerlink" href="#controles-de-donnees" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Erreurs</strong></p>
<p>Le tableau ci-dessous liste les codes d’erreur et leur description.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Code Erreur</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DATASET_NOT_FOUND</p></td>
<td><p>L’identifiant ne correspond à aucun jeu de données existant.</p></td>
</tr>
<tr class="row-odd"><td><p>DATASET_NOT_AUTHORIZED</p></td>
<td><p>L’utilisateur ne peut pas importer de nouvelles entités dans le jeu de données.</p></td>
</tr>
<tr class="row-even"><td><p>DATASET_NOT_ACTIVE</p></td>
<td><p>Aucune donnée ne peut être importée dans le JDD indiqué car il n’est pas actif.</p></td>
</tr>
<tr class="row-odd"><td><p>MULTIPLE_ATTACHMENT_TYPE_CODE</p></td>
<td><p>Plusieurs géoréférencements sont indiqués dans les colonnes : codeCommune, codeMaille, codeDépartement (Erreur Synthèse)</p></td>
</tr>
<tr class="row-even"><td><p>MULTIPLE_CODE_ATTACHMENT</p></td>
<td><p>Plusieurs codes de rattachement fournis pour une même ligne. Une ligne doit avoir un seul code rattachement (code commune OU code maille OU code département)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_DATE</p></td>
<td><p>Format de date invalide (Voir formats de date autorisés)</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_UUID</p></td>
<td><p>Format de l’identifiant donné ne respecte pas le format UUID (<a class="reference external" href="https://fr.wikipedia.org/wiki/Universally_unique_identifier">https://fr.wikipedia.org/wiki/Universally_unique_identifier</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_INTEGER</p></td>
<td><p>La donnée indiquée ne correspond pas un nombre entier.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_NUMERIC</p></td>
<td><p>La donnée indiquée ne correspond pas à un nombre réel (float)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_WKT</p></td>
<td><p>La donnée indiquée ne respecte pas le format WKT <a class="reference external" href="https://fr.wikipedia.org/wiki/Well-known_text">https://fr.wikipedia.org/wiki/Well-known_text</a></p></td>
</tr>
<tr class="row-even"><td><p>INVALID_GEOMETRY</p></td>
<td><p>La géométrie de la donnée renseignée est invalide (c.f  ST_VALID)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_BOOL</p></td>
<td><p>La donnée fournie n’est pas un booléen</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_ATTACHMENT_CODE</p></td>
<td><p>Le code commune/maille/département indiqué ne fait pas partie du référentiel des géographique.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_CHAR_LENGTH</p></td>
<td><p>La chaine de caractère de la donnée est trop longue</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_TOO_HIGH</p></td>
<td><p>La date de début est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MAX_TOO_LOW</p></td>
<td><p>La date de fin est inférieure à 1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MAX_TOO_HIGH</p></td>
<td><p>La date de fin est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MIN_TOO_LOW</p></td>
<td><p>La date de début est inférieure à 1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_SUP_DATE_MAX</p></td>
<td><p>La date de début est supérieure à la date de fin</p></td>
</tr>
<tr class="row-odd"><td><p>DEPTH_MIN_SUP_ALTI_MAX</p></td>
<td><p>La profondeur minimum est supérieure à la profondeur maximale</p></td>
</tr>
<tr class="row-even"><td><p>ALTI_MIN_SUP_ALTI_MAX</p></td>
<td><p>L’altitude minimum est supérieure à l’altitude maximale</p></td>
</tr>
<tr class="row-odd"><td><p>ORPHAN_ROW</p></td>
<td><p>La ligne du fichier n’a pû être rattachée à aucune entité.</p></td>
</tr>
<tr class="row-even"><td><p>DUPLICATE_ROWS</p></td>
<td><p>Deux lignes du fichier sont identiques ; les lignes ne peuvent pas être dupliquées.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_UUID</p></td>
<td><p>L’identifiant UUID d’une entité n’est pas unique dans le fichier fournis</p></td>
</tr>
<tr class="row-even"><td><p>EXISTING_UUID</p></td>
<td><p>L’identifiant UUID d’une entité fournie existe déjà dans la base de données. Il faut en fournir un autre ou laisser la valeur vide pour une attribution automatique.</p></td>
</tr>
<tr class="row-odd"><td><p>SKIP_EXISTING_UUID</p></td>
<td><p>Les entités existantes selon UUID sont ignorées.</p></td>
</tr>
<tr class="row-even"><td><p>MISSING_VALUE</p></td>
<td><p>Valeur manquante dans un champs obligatoire</p></td>
</tr>
<tr class="row-odd"><td><p>MISSING_GEOM</p></td>
<td><p>Géoréférencement manquant ; un géoréférencement doit être fourni, c’est à dire qu’il faut livrer : soit une géométrie, soit une ou plusieurs commune(s), ou département(s), ou maille(s), dont le champ “typeInfoGeo” est indiqué à 1.</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUTSIDE</p></td>
<td><p>La géométrie se trouve à l’extérieur du territoire renseigné</p></td>
</tr>
<tr class="row-odd"><td><p>NO-GEOM</p></td>
<td><p>Aucune géometrie fournie (ni X/Y, WKT ou code)</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUT_OF_BOX</p></td>
<td><p>Coordonnées géographiques en dehors du périmètre géographique de l’instance</p></td>
</tr>
<tr class="row-odd"><td><p>ERRONEOUS_PARENT_ENTITY</p></td>
<td><p>L’entité parente est en erreur.</p></td>
</tr>
<tr class="row-even"><td><p>NO_PARENT_ENTITY</p></td>
<td><p>Aucune entité parente identifiée.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_ENTITY_SOURCE_PK</p></td>
<td><p>Deux lignes du fichier ont la même clé primaire d’origine ; les clés primaires du fichier source ne peuvent pas être dupliquées.</p></td>
</tr>
<tr class="row-even"><td><p>COUNT_MIN_SUP_COUNT_MAX</p></td>
<td><p>Incohérence entre les champs dénombrement. La valeur de denombrement_min est supérieure à celle de denombrement_max ou la valeur de denombrement_max est inférieure à denombrement_min.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE</p></td>
<td><p>Code nomenclature erroné ; La valeur du champ n’est pas dans la liste des codes attendus pour ce champ. Pour connaître la liste des codes autorisés, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_EXISTING_PROOF_VALUE</p></td>
<td><p>Incohérence entre les champs de preuve ; si le champ “preuveExistante” vaut oui, alors l’un des deux champs “preuveNumérique” ou “preuveNonNumérique” doit être rempli. A l’inverse, si l’un de ces deux champs est rempli, alors “preuveExistante” ne doit pas prendre une autre valeur que « oui » (code 1).</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE_WARNING</p></td>
<td><p>(Non bloquant) Code nomenclature erroné et remplacé par sa valeur par défaut ; La valeur du champ n’est pas dans la liste des codes attendus pour ce champ. Pour connaître la liste des codes autorisés, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>CONDITIONAL_MANDATORY_FIELD_ERROR</p></td>
<td><p>Champs obligatoires conditionnels manquants. Il existe des ensembles de champs liés à un concept qui sont “obligatoires conditionnels”, c’est à dire que si l’un des champs du concept est utilisé, alors d’autres champs du concept deviennent obligatoires.</p></td>
</tr>
<tr class="row-odd"><td><p>UNKNOWN_ERROR</p></td>
<td><p>Erreur inconnue</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_STATUT_SOURCE_VALUE</p></td>
<td><p>Référence bibliographique manquante ; si le champ “statutSource” a la valeur “Li” (Littérature), alors une référence bibliographique doit être indiquée.</p></td>
</tr>
<tr class="row-odd"><td><p>CONDITIONAL_INVALID_DATA</p></td>
<td><p>Erreur de valeur</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_URL_PROOF</p></td>
<td><p>PreuveNumerique n’est pas une url ; le champ “preuveNumérique” indique l’adresse web à laquelle on pourra trouver la preuve numérique ou l’archive contenant toutes les preuves numériques. Il doit commencer par “<a class="reference external" href="http://">http://</a>”, “<a class="reference external" href="https://">https://</a>”, ou “<a class="reference external" href="ftp://">ftp://</a>”.</p></td>
</tr>
<tr class="row-odd"><td><p>ROW_HAVE_TOO_MUCH_COLUMN</p></td>
<td><p>Une ligne du fichier source a plus de colonnes que l’en-tête.</p></td>
</tr>
<tr class="row-even"><td><p>ROW_HAVE_LESS_COLUMN</p></td>
<td><p>Une ligne du fichier source a moins de colonnes que l’en-tête.</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_ROW</p></td>
<td><p>Une ligne dans le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>HEADER_SAME_COLUMN_NAME</p></td>
<td><p>Au moins deux colonnes du fichier source possèdent des noms identiques</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_FILE</p></td>
<td><p>Le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>NO_FILE_SENDED</p></td>
<td><p>Aucun fichier source n’a été téléversé.</p></td>
</tr>
<tr class="row-odd"><td><p>ERROR_WHILE_LOADING_FILE</p></td>
<td><p>Une erreur s’est produite lors du chargement du fichier.</p></td>
</tr>
<tr class="row-even"><td><p>FILE_FORMAT_ERROR</p></td>
<td><p>Le format du fichier est incorrect.</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_EXTENSION_ERROR</p></td>
<td><p>L’extension de fichier source est incorrect</p></td>
</tr>
<tr class="row-even"><td><p>FILE_OVERSIZE</p></td>
<td><p>Volume du fichier source est trop important</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_NAME_TOO_LONG</p></td>
<td><p>Nom du fichier de données trop long</p></td>
</tr>
<tr class="row-even"><td><p>FILE_WITH_NO_DATA</p></td>
<td><p>Pas de données dans le fichier source</p></td>
</tr>
<tr class="row-odd"><td><p>INCOHERENT_DATA</p></td>
<td><p>Une même entité est déclaré avec différents attributs dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>CD_HAB_NOT_FOUND</p></td>
<td><p>CdHab n’existe pas dans le référentiel Habref installé</p></td>
</tr>
<tr class="row-odd"><td><p>CD_NOM_NOT_FOUND</p></td>
<td><p>CdNom n’existe pas dans le référentiel TaxRef installé</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p><strong>Format de dates autorisées</strong></p>
<p>Date :</p>
<ul class="simple">
<li><p>YYYY-MM-DD</p></li>
<li><p>DD-MM-YYYY</p></li>
<li><p>YYYY/MM/DD</p></li>
<li><p>DD/MM/YYYY</p></li>
</ul>
<p>Heure :</p>
<ul class="simple">
<li><p>H</p></li>
<li><p>H-M</p></li>
<li><p>H-M-S</p></li>
<li><p>H-M-S</p></li>
<li><p>H:M</p></li>
<li><p>H:M:S</p></li>
<li><p>H:M:S</p></li>
<li><p>Hh</p></li>
<li><p>HhM</p></li>
<li><p>HhMm</p></li>
<li><p>HhMmSs</p></li>
</ul>
</section>
<section id="configuration-avancee">
<h3>Configuration avancée<a class="headerlink" href="#configuration-avancee" title="Lien vers cette rubrique">#</a></h3>
<p>Une autre partie de la configuration se fait directement dans la base de données, dans les tables <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code>.</p>
<p>Dans <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, il est possible de :</p>
<ul class="simple">
<li><p>Ajouter de nouveau(x) champ(s) pour une entité (e.g. Station) dans une destination (e.g. Occhab).</p></li>
<li><p>Masquer des champs existants. Pour cela, modifier la valeur de l’attribut <code class="docutils literal notranslate"><span class="pre">display</span></code> d’un champ.</p></li>
<li><p>Rendre obligatoire un champ. Pour cela, modifier la valeur de l’attribut <code class="docutils literal notranslate"><span class="pre">mandatory</span></code> d’un champ.</p></li>
<li><p>Rendre obligatoire/optionnel un champ si d’autres champs sont remplis. Voir les champs <code class="docutils literal notranslate"><span class="pre">optional_conditions</span></code> et <code class="docutils literal notranslate"><span class="pre">mandatory_conditions</span></code>.</p></li>
</ul>
<p>Dans la table <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code> :</p>
<ul class="simple">
<li><p>Paramètrer l’ordre des champs dans l’interface du mapping de champs. Voir le champ <code class="docutils literal notranslate"><span class="pre">order_field</span></code>.</p></li>
<li><p>Changer le _tooltip_ d’un champ. Voir le champ <code class="docutils literal notranslate"><span class="pre">comment</span></code>.</p></li>
<li><p>Regrouper des champs dans <strong>thèmes</strong> (voir <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code>) à l’aide du champs <code class="docutils literal notranslate"><span class="pre">id_theme</span></code>.</p></li>
</ul>
</section>
<section id="controle-de-donnees-dans-les-destinations-venant-avec-geonature">
<span id="controle-donnees"></span><h3>Contrôle de données dans les destinations venant avec GeoNature<a class="headerlink" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature" title="Lien vers cette rubrique">#</a></h3>
<p>Dans cette section, nous présentons les contrôles de données effectuées pour les destinations intégrées dans GeoNature : Synthèse, Occhab.
L’ordre des contrôles dans ces listes correspond bien à celui du processus défini dans le code de GeoNature.
De manière générale, nous séparons les contrôles de données en deux catégories, ceux effectués en BDD avec PostgreSQL et ceux effectuée en Python à l’aide des DataFrame (donnée tableau)</p>
<p><strong>Listes des contrôles pour Occhab</strong></p>
<ol class="arabic simple">
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>Vérification de la cohérence des données des stations déclarées</p></li>
</ol>
</li>
<li><p>[DataFrame][Station]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la données</p></li>
<li><p>Vérification du jeu de données</p></li>
<li><p>Vérification des géométries présentes dans les données (WKT ou latitude/longitude)</p></li>
</ol>
</li>
<li><p>[DataFrame][Habitat]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la données</p></li>
</ol>
</li>
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>Conversion des données de géométrie dans le SRID de la BDD</p></li>
<li><p>Vérification de la cohérence des données altitudinale, de profondeur et les dates</p></li>
<li><p>Vérification de la validité des géométries</p></li>
</ol>
</li>
<li><p>[SQL][Habitat]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>Vérification des cdHab</p></li>
<li><p>Vérification des UUID (doublons dans le fichier, existence dans la destination)</p></li>
<li><p>Générer les UUID si manquante</p></li>
<li><p>Dans le cas d’habitats importés sur une station existante, vérifier les droits de l’utilisateur sur cette dernière.</p></li>
</ol>
</li>
</ol>
<p><strong>Listes des contrôles pour la Synthèse</strong></p>
<ol class="arabic simple">
<li><p>[DataFrame]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la donnée</p></li>
</ol>
</li>
<li><p>[SQL]</p>
<ol class="arabic simple">
<li><p>Vérification du jeu de données</p></li>
<li><p>Vérification des géométries présentes dans les données (WKT ou latitude/longitude)</p></li>
<li><p>Vérification des données de dénombrement</p></li>
<li><p>Mapping des nomenclatures</p></li>
<li><p>Vérification de l’existence des identifiants cdNom dans Taxref local</p></li>
<li><p>Vérification de l’existence des identifiants cdHab dans Habref local</p></li>
<li><p>Vérification de la cohérence des données altitudinale, de profondeur et les dates</p></li>
<li><p>Vérification des preuves numériques</p></li>
<li><p>Vérification de l’intersection entre chaque géométrie et la géométrie de la zone autorisée.</p></li>
</ol>
</li>
</ol>
</section>
<section id="modele-de-donnees">
<h3>Modèle de données<a class="headerlink" href="#modele-de-donnees" title="Lien vers cette rubrique">#</a></h3>
<p>Le diagramme ci-dessous présente le schéma de la base de données du module Import.</p>
<img alt="_images/import_modele.png" src="_images/import_modele.png" />
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="user-manual.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Manuel utilisateur</p>
      </div>
    </a>
    <a class="right-next"
       href="development.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">Développement</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#architecture">Architecture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#base-de-donnees">Base de données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#administration-avec-alembic">Administration avec Alembic</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#description-des-branches">Description des branches</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-droits">Gestion des droits</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-a-geonature-et-cruved">Accès à GeoNature et CRUVED</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#cas-particulier-de-l-action-c">Cas particulier de l’action « C »</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-d-administrateur">Permissions d’administrateur</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#recapitulatif">Récapitulatif</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#nomenclatures">Nomenclatures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#metadonnees">Métadonnées</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#donnees-sig">Données SIG</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#profils-de-taxons">Profils de taxons</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#usage">Usage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-et-parametrage">Configuration et paramétrage</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#calcul-des-phenologies">Calcul des phénologies</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fonctions">Fonctions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#tables-transversales">Tables transversales</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triggers-vers-la-synthese">Triggers vers la synthèse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#triggers-dans-la-synthese">Triggers dans la synthèse</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularite">Modularité</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-generale-de-l-application">Configuration générale de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-d-un-gn-module">Configuration d’un gn_module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exploitation">Exploitation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#logs">Logs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commandes-geonature">Commandes GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demarrer-arreter-les-api">Démarrer / arrêter les API</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#supervision-des-services">Supervision des services</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maintenance">Maintenance</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parametres-gunicorn">Paramètres Gunicorn</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sauvegarde-et-restauration">Sauvegarde et restauration</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#sauvegarde">Sauvegarde</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restauration">Restauration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#customisation">Customisation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integrer-son-logo">Intégrer son logo</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-le-contenu">Customiser le contenu</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-la-page-de-connexion">Customiser la page de connexion</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-l-aspect-esthetique">Customiser l’aspect esthétique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-les-noms-et-pictos-des-modules">Customiser les noms et pictos des modules</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#customiser-les-exports-pdf">Customiser les exports PDF</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrer-des-donnees">Intégrer des données</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#referentiel-geographique">Référentiel géographique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#affichage-des-referentiels-geographiques-dans-geonature">Affichage des référentiels géographiques dans GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#donnees-externes">Données externes</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-niveau-1">IMPORT NIVEAU 1</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#importer-la-donnee-source-dans-la-bdd-avec-qgis">Importer la donnée source dans la BDD avec QGIS</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creer-les-metadonnees">Créer les métadonnées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#insertion-des-donnees-dans-la-synthese">Insertion des données dans la Synthèse</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#insertion-depuis-un-shapefile">Insertion depuis un shapefile</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#import-niveau-2">IMPORT NIVEAU 2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#description">Description</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#import-du-fichier-csv">1 - Import du fichier CSV</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-de-la-nouvelle-table-contenant-les-donnees-importees">2 - Préparation de la nouvelle table contenant les données importées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-des-metadonnees">3 - Création des métadonnées</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#creation-du-mapping-source-cible">4 - Création du mapping (source –&gt; cible)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#construire-la-requete-d-import">5 - Construire la requête d’import</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#chargement-des-donnees-dans-la-table-de-destination-synthese-ici">6 - Chargement des données dans la table de destination (synthese ici)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#deplacement-de-la-table-importee-facultatif">7 - Déplacement de la table importée (facultatif)</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#resultat-final">RESULTAT FINAL</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#authentification">Authentification</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#demande-de-creation-de-compte">Demande de création de compte</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#customisation-du-formulaire">Customisation du formulaire</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#espace-utilisateur">Espace utilisateur</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-public">Accès public</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#acces-public-automatique">Accès public automatique</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-de-la-sensibilite">Gestion de la sensibilité</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#criteres-de-sensibilite">Critères de sensibilité</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#niveaux-de-sensibilite">Niveaux de sensibilité</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-plus-d-informations">Pour plus d’informations</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-dans-geonature">Intégration dans GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#stockage-des-regles-en-base">Stockage des règles en base</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution-aux-observations-de-la-synthese">Attribution aux observations de la synthèse</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-du-referentiel">Gestion du référentiel</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnalisation">Personnalisation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a><ul class="nav section-nav flex-column">
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h5 nav-item toc-entry"><a class="reference internal nav-link" href="#traitement-des-problematiques-lies-aux-zonages">Traitement des problématiques liés aux zonages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-occtax">Module OCCTAX</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installer-le-module">Installer le module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module">Configuration du module</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#afficher-masquer-des-champs-du-formulaire">Afficher/masquer des champs du formulaire</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modifier-le-champ-observateurs">Modifier le champ Observateurs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnaliser-la-liste-des-taxons-et-habitats-saisissables-dans-le-module">Personnaliser la liste des taxons et habitats saisissables dans le module</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#gerer-les-valeurs-par-defaut-des-nomenclatures">Gérer les valeurs par défaut des nomenclatures</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#personnaliser-l-interface-map-list">Personnaliser l’interface Map-list</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ajouter-une-contrainte-d-echelle-de-saisie-sur-la-carte">Ajouter une contrainte d’échelle de saisie sur la carte</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#supprimer-le-remplissage-automatique-de-la-date">Supprimer le remplissage automatique de la date</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-exports">Gestion des exports</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attribuer-des-permissions">Attribuer des permissions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dupliquer-le-module-occtax">Dupliquer le module Occtax</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#associer-des-jeux-de-donnees-et-des-champs-additionnels">Associer des jeux de données et des champs additionnels</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#ajouter-le-nouveau-module-dans-la-liste-des-modules-implementes">Ajouter le nouveau module dans la liste des modules implémentés</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-admin">Module Admin</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#administration-des-champs-additionnels">Administration des champs additionnels</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee-des-champs">Configuration avancée des champs</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#taxhub">TaxHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-occhab">Module OCCHAB</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Installer le module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Base de données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#formulaire">Formulaire</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-synthese">Module SYNTHESE</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Configuration</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-validation">Module VALIDATION</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">Configuration</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#liste-des-champs-visibles">Liste des champs visibles</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#e-mail">E-mail</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#validation-automatique">Validation automatique</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#activation">Activation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#conditions-de-validation-automatique">Conditions de validation automatique</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-de-la-periodicite-de-la-validation-automatique">Modification de la périodicité de la validation automatique</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-de-la-fonction-de-validation-automatique">Modification de la fonction de validation automatique</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-taxhub">Module TaxHub</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-des-permissions">Gestion des permissions</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#commandes-taxhub">Commandes TaxHub</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#module-import">Module Import</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts">Concepts</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#faire-un-import-le-minimum-requis">Faire un import, le minimum requis</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#deroulement-dun-import">Déroulement d’un import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module-dimport">Configuration du module d’import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-de-limport">Permissions de l’import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-et-suppression-d-un-import">Modification et Suppression d’un import</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controles-de-donnees">Contrôles de données</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee">Configuration avancée</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature">Contrôle de données dans les destinations venant avec GeoNature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#modele-de-donnees">Modèle de données</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par PnE, PnC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2024, Parc National des Écrins, Parc National des Cévennes.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>