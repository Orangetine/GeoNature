
<!DOCTYPE html>


<html lang="fr" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Installation &#8212; Documentation GeoNature 2.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=94f178cf"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/translations.js?v=041d0952"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'installation';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
    <link rel="next" title="Manuel utilisateur" href="user-manual.html" />
    <link rel="prev" title="Bienvenue dans la documentation de GeoNature" href="index.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="2.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/LogoGeonature.jpg" class="logo__image only-light" alt="Documentation GeoNature 2.0 - Home"/>
    <img src="_static/LogoGeonature.jpg" class="logo__image only-dark pst-js-only" alt="Documentation GeoNature 2.0 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PnX-SI/GeoNature" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">Manuel utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">Manuel administrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Développement</a></li>

<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Auteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-references.html">API REFERENCES</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Dépôt source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature/blob/master/docs/installation.rst?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/installation.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Installation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequis">Prérequis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-du-serveur">Préparation du serveur</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-globale">Installation globale</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-des-applications">Installation des applications</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#telechargement">Téléchargement</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-de-geonature-uniquement">Installation de GeoNature uniquement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-des-dependances">Installation des dépendances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recuperation-de-l-application">Récupération de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-de-l-application">Installation de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-apache">Configuration Apache</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependances">Dépendances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passer-en-mode-developpement">Passer en mode développement</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker">Docker</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-compose">Docker Compose</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-backend">Image backend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-frontend">Image frontend</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#https">HTTPS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-de-cerbot">Utilisation de Cerbot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-de-openssl-sur-un-environnement-de-test">Utilisation de OpenSSL sur un environnement de test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-de-l-application-geonature">Configuration de l’application GeoNature</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taches-planifiees">Taches planifiées</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-d-un-module-geonature">Installation d’un module GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Téléchargement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-automatique">Installation automatique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-manuelle">Installation manuelle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module">Configuration du module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mise-a-jour-du-module">Mise à jour du module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mise-a-jour-de-l-application">Mise à jour de l’application</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Lien vers cette rubrique">#</a></h1>
<p>GeoNature repose sur les composants suivants :</p>
<ul class="simple">
<li><p>PostgreSQL / PostGIS</p></li>
<li><p>Python 3 et dépendances Python nécessaires à l’application</p></li>
<li><p>Flask (framework web Python)</p></li>
<li><p>Apache</p></li>
<li><p>Angular 15, Angular CLI, NodeJS</p></li>
<li><p>Librairies javascript (Leaflet, ChartJS)</p></li>
<li><p>Librairies CSS (Bootstrap, Material Design)</p></li>
</ul>
<p>Deux méthodes d’installation existent :</p>
<ul class="simple">
<li><p><a class="reference internal" href="#installation-all"><span class="std std-ref">Installation globale</span></a> : Installation automatisée de GeoNature (incluant TaxHub) et UsersHub.</p></li>
<li><p><a class="reference internal" href="#installation-standalone"><span class="std std-ref">Installation de GeoNature uniquement</span></a> : UsersHub n’est pas installé (mais son schéma de BDD est tout de même créé dans la base de données de GeoNature).</p></li>
</ul>
<section id="prerequis">
<h2>Prérequis<a class="headerlink" href="#prerequis" title="Lien vers cette rubrique">#</a></h2>
<ul class="simple">
<li><p>Ressources minimum serveur :</p>
<ul>
<li><p>Un serveur Debian 11 ou 12, architecture 64-bits</p></li>
<li><p>4 Go RAM</p></li>
<li><p>20 Go d’espace disque</p></li>
</ul>
</li>
<li><p>GeoNature nécessite d’accéder à des ressources externes durant son installation et son fonctionnement. Si vous utilisez un serveur mandataire, celui-ci doit permettre l’accès aux domaines suivants :</p>
<ul>
<li><p><a class="reference external" href="https://pypi.python.org">https://pypi.python.org</a></p></li>
<li><p><a class="reference external" href="https://geonature.fr/">https://geonature.fr/</a></p></li>
<li><p><a class="reference external" href="https://codeload.github.com/">https://codeload.github.com/</a></p></li>
<li><p><a class="reference external" href="https://nodejs.org/dist">https://nodejs.org/dist</a></p></li>
<li><p><a class="reference external" href="https://registry.npmjs.org">https://registry.npmjs.org</a></p></li>
<li><p><a class="reference external" href="https://www.npmjs.com">https://www.npmjs.com</a></p></li>
<li><p><a class="reference external" href="https://raw.githubusercontent.com/">https://raw.githubusercontent.com/</a></p></li>
<li><p><a class="reference external" href="https://data.geopf.fr/">https://data.geopf.fr/</a></p></li>
</ul>
</li>
</ul>
</section>
<section id="preparation-du-serveur">
<span id="preparation-server"></span><h2>Préparation du serveur<a class="headerlink" href="#preparation-du-serveur" title="Lien vers cette rubrique">#</a></h2>
<p>Commencer la procédure en se connectant au serveur en SSH avec l’utilisateur linux <code class="docutils literal notranslate"><span class="pre">root</span></code>.</p>
<ul>
<li><p>Mettre à jour de la liste des dépôts Linux :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt<span class="w"> </span>update
<span class="gp"># </span>apt<span class="w"> </span>upgrade
</pre></div>
</div>
</li>
<li><p>Configuration de la locale du serveur</p>
<p>Certains serveurs sont livrés sans « locale » (langue par défaut). Pour l’installation de GeoNature, il est nécessaire de bien configurer la locale. Si la commande <code class="docutils literal notranslate"><span class="pre">locale</span></code> renvoie ceci :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">LANG=fr_FR.UTF-8</span>
<span class="go">LANGUAGE=fr_FR.UTF-8</span>
<span class="go">LC_CTYPE=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_NUMERIC=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_TIME=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_COLLATE=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_MONETARY=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_MESSAGES=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_PAPER=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_NAME=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_ADDRESS=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_TELEPHONE=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_MEASUREMENT=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_IDENTIFICATION=&quot;fr_FR.UTF-8&quot;</span>
<span class="go">LC_ALL=fr_FR.UTF-8</span>
</pre></div>
</div>
<p>Vous pouvez alors passer cette étape de configuration des locales.</p>
<p>Sinon exécuter la commande <code class="docutils literal notranslate"><span class="pre">dpkg-reconfigure</span> <span class="pre">locales</span></code>. Une fenêtre s’affiche dans votre console. Dans la liste déroulante, sélectionnez <code class="docutils literal notranslate"><span class="pre">fr_FR.UTF-8</span> <span class="pre">UTF-8</span></code> avec <code class="docutils literal notranslate"><span class="pre">Espace</span></code>, puis cliquez sur OK. Une 2ème fenêtre s’affiche avec une liste de locale activées (<code class="docutils literal notranslate"><span class="pre">fr_FR.UTF-8</span></code> doit être présent dans la liste), confirmez votre choix, en cliquant sur OK, puis attendez que la locale s’installe.</p>
</li>
<li><p>Installer l’utilitaire <code class="docutils literal notranslate"><span class="pre">sudo</span></code> :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>apt<span class="w"> </span>install<span class="w"> </span>sudo
</pre></div>
</div>
</li>
<li><p>Créer un utilisateur Linux dédié (nommé <code class="docutils literal notranslate"><span class="pre">geonatureadmin</span></code> dans notre cas) pour ne pas travailler en <code class="docutils literal notranslate"><span class="pre">root</span></code> :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>adduser<span class="w"> </span>geonatureadmin
</pre></div>
</div>
</li>
<li><p>Lui donner ensuite les droits administrateur en l’ajoutant au groupe <code class="docutils literal notranslate"><span class="pre">sudo</span></code> :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>adduser<span class="w"> </span>geonatureadmin<span class="w"> </span>sudo
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Vérifier les droits du répertoire HOME de l’utilisateur</p>
<blockquote>
<div><p>Il doit être en <code class="docutils literal notranslate"><span class="pre">7XX</span></code> soit <code class="docutils literal notranslate"><span class="pre">drwxr-xr-x</span></code>. Si ce n’est pas le cas, exécuter la commande suivante :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>chmod<span class="w"> </span><span class="m">755</span><span class="w"> </span>/home/geonatureadmin
</pre></div>
</div>
</div></blockquote>
</div>
<ul>
<li><p>Pour la suite du processus d’installation, on utilisera l’utilisateur non privilégié nouvellement créé. Si besoin d’éxecuter des commandes avec les droits d’administrateur, on les précèdera de <code class="docutils literal notranslate"><span class="pre">sudo</span></code>.</p>
<p>Il est d’ailleurs possible renforcer la sécurité du serveur en bloquant la connexion SSH au serveur avec <code class="docutils literal notranslate"><span class="pre">root</span></code>. Voir <a class="reference external" href="https://docs.ovh.com/fr/vps/conseils-securisation-vps/">https://docs.ovh.com/fr/vps/conseils-securisation-vps/</a> pour plus d’informations sur le sécurisation du serveur.</p>
<p>Pour passer de l’utilisateur <code class="docutils literal notranslate"><span class="pre">root</span></code> à <code class="docutils literal notranslate"><span class="pre">geonatureadmin</span></code>, vous pouvez aussi utiliser la commande :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>su<span class="w"> </span>-<span class="w"> </span>geonatureadmin
</pre></div>
</div>
</li>
</ul>
</section>
<section id="installation-globale">
<span id="installation-all"></span><h2>Installation globale<a class="headerlink" href="#installation-globale" title="Lien vers cette rubrique">#</a></h2>
<p>Ce document décrit une procédure d’installation packagée de GeoNature.</p>
<p>En lançant le script d’installation ci-dessous, l’application GeoNature ainsi que ses dépendances seront installées sur un seul et même serveur au sein d’une seule base de données.</p>
<p>Les applications suivantes seront installées :</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/PnX-SI/GeoNature">GeoNature</a> (incluant <a class="reference external" href="https://github.com/PnX-SI/TaxHub">TaxHub</a> qui pilote le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code>)</p></li>
<li><p><a class="reference external" href="https://github.com/PnX-SI/UsersHub">UsersHub</a> qui pilote le schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> (le paramètre <code class="docutils literal notranslate"><span class="pre">install_usershub_app</span></code> du fichier de configuration <code class="docutils literal notranslate"><span class="pre">install_all.ini</span></code> permet de désactiver l’installation de l’application. Il est cependant recommandé d’installer l’application pour disposer d’une interface pour gérer les utilisateurs dans GeoNature)</p></li>
</ul>
<p>Si vous disposez déjà de UsersHub sur un autre serveur ou une autre base de données et que vous souhaitez installer simplement GeoNature, veuillez suivre la documentation <a class="reference internal" href="#installation-standalone"><span class="std std-ref">Installation de GeoNature uniquement</span></a>.</p>
<section id="installation-des-applications">
<h3>Installation des applications<a class="headerlink" href="#installation-des-applications" title="Lien vers cette rubrique">#</a></h3>
<p>Commencer la procédure en se connectant au serveur en SSH avec l’utilisateur dédié précédemment créé lors de l’étape de <a class="reference internal" href="#preparation-server"><span class="std std-ref">Préparation du serveur</span></a> (usuellement <code class="docutils literal notranslate"><span class="pre">geonatureadmin</span></code>).</p>
<section id="telechargement">
<h4>Téléchargement<a class="headerlink" href="#telechargement" title="Lien vers cette rubrique">#</a></h4>
<ul>
<li><p>Se placer à la racine du <code class="docutils literal notranslate"><span class="pre">home</span></code> de l’utilisateur puis récupérer les scripts d’installation (X.Y.Z à remplacer par le numéro de la <a class="reference external" href="https://github.com/PnEcrins/GeoNature/releases">dernière version stable de GeoNature</a>). Ces scripts installent les applications GeoNature (incluant TaxHub) et UsersHub (en option) ainsi que leurs bases de données (uniquement les schémas du coeur) :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>wget<span class="w"> </span>https://raw.githubusercontent.com/PnX-SI/GeoNature/X.Y.Z/install/install_all/install_all.ini
<span class="gp">$ </span>wget<span class="w"> </span>https://raw.githubusercontent.com/PnX-SI/GeoNature/X.Y.Z/install/install_all/install_all.sh
</pre></div>
</div>
</li>
</ul>
<p><em>Attention</em> : l’installation globale fonctionne uniquement si les scripts sont placés à la racine du <code class="docutils literal notranslate"><span class="pre">home</span></code> de l’utilisateur courant.</p>
</section>
<section id="configuration">
<h4>Configuration<a class="headerlink" href="#configuration" title="Lien vers cette rubrique">#</a></h4>
<ul>
<li><p>Configurez votre installation en adaptant le fichier <code class="docutils literal notranslate"><span class="pre">install_all.ini</span></code> :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>nano<span class="w"> </span>install_all.ini
</pre></div>
</div>
</li>
<li><p>Renseignez à minima :</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">my_url</span></code> : l’URL (ou IP) de votre serveur (avec un <code class="docutils literal notranslate"><span class="pre">/</span></code> à la fin)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_pg</span></code> : l’utilisateur PostgreSQL que vous souhaitez voir créé</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">user_pg_pass</span></code> : mot de passe de l’utilisateur PostgreSQL</p></li>
</ul>
<p>Le script se chargera d’installer PostgreSQL, de crééer la base de donnée et de créer l’utilisateur que vous avez renseigné.</p>
</div></blockquote>
</li>
<li><p>Variable <code class="docutils literal notranslate"><span class="pre">mode</span></code></p></li>
</ul>
<p>Pour l’installation d’une instance de production ou de test <code class="docutils literal notranslate"><span class="pre">mode=prod</span></code>, pour une installation de développement <code class="docutils literal notranslate"><span class="pre">mode=dev</span></code>.</p>
<p><strong>Il est déconseillé de modifier les numéros de version des dépendances, chaque nouvelle version de GeoNature étant fournie avec les versions adaptées de ses dépendances.</strong></p>
</section>
<section id="id1">
<h4>Installation<a class="headerlink" href="#id1" title="Lien vers cette rubrique">#</a></h4>
<ul>
<li><p>Lancer l’installation :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>touch<span class="w"> </span>install_all.log
<span class="gp">$ </span>chmod<span class="w"> </span>+x<span class="w"> </span>install_all.sh
<span class="gp">$ </span>./install_all.sh<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>install_all.log
</pre></div>
</div>
</li>
</ul>
<p>Une fois l’installation terminée, lancez la commande suivante:</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">exec</span><span class="w"> </span>bash
</pre></div>
</div>
</div></blockquote>
<p>Les applications sont disponibles aux adresses suivantes :</p>
<ul class="simple">
<li><p><a class="reference external" href="http://monip.com/geonature/">http://monip.com/geonature/</a></p></li>
<li><p><a class="reference external" href="http://monip.com/usershub/">http://monip.com/usershub/</a> (en option)</p></li>
</ul>
<p>Vous pouvez vous connecter avec l’utilisateur intégré par défaut (admin/admin).</p>
<dl class="field-list simple">
<dt class="field-odd">Note<span class="colon">:</span></dt>
<dd class="field-odd"><p>Pour en savoir plus TaxHub, sa configuration et son utilisation, reportez-vous à sa documentation : <a class="reference external" href="https://taxhub.readthedocs.io">https://taxhub.readthedocs.io</a>. Idem pour UsersHub et sa documentation : <a class="reference external" href="https://usershub.readthedocs.io">https://usershub.readthedocs.io</a></p>
</dd>
<dt class="field-even">Note<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p>GeoNature-atlas compatible avec GeoNature V2 est disponible sur <a class="github reference external" href="https://github.com/PnX-SI/GeoNature-atlas">PnX-SI/GeoNature-atlas</a></p></li>
<li><p>Vous pouvez utiliser le schéma <code class="docutils literal notranslate"><span class="pre">ref_geo</span></code> de GeoNature pour votre territoire, les communes et les mailles.</p></li>
</ul>
</dd>
</dl>
<p>Si vous rencontrez une erreur, se reporter aux fichiers de logs <code class="docutils literal notranslate"><span class="pre">/home/`whoami`/install_all.log</span></code>.</p>
<dl class="field-list">
<dt class="field-odd">Note<span class="colon">:</span></dt>
<dd class="field-odd"><p>Si vous souhaitez que GeoNature soit à la racine du serveur, ou à une autre adresse, editez le fichier de configuration Apache (<code class="docutils literal notranslate"><span class="pre">/etc/apache2/sites-available/geonature.conf</span></code>) en modifiant l’alias :</p>
<ul class="simple">
<li><p>Pour <code class="docutils literal notranslate"><span class="pre">/</span></code>: <code class="docutils literal notranslate"><span class="pre">Alias</span> <span class="pre">/</span> <span class="pre">/home/test/geonature/frontend/dist</span></code></p></li>
<li><p>Pour <code class="docutils literal notranslate"><span class="pre">/saisie</span></code> : <code class="docutils literal notranslate"><span class="pre">Alias</span> <span class="pre">/saisie</span> <span class="pre">/home/test/geonature/frontend/dist</span></code></p></li>
</ul>
</dd>
<dt class="field-even">Note<span class="colon">:</span></dt>
<dd class="field-even"><p>Par défaut et par mesure de sécurité, la base de données est accessible uniquement localement par la machine où elle est installée. Pour accéder à la BDD depuis une autre machine (pour s’y connecter avec QGIS, pgAdmin ou autre), vous pouvez consulter cette documentation <a class="github reference external" href="https://github.com/PnX-SI/Ressources-techniques/blob/master/PostgreSQL/acces-bdd.rst">PnX-SI/Ressources-techniques</a>.
Attention, exposer la base de données sur internet n’est pas recommandé. Il est préférable de se connecter via un tunnel SSH. QGIS et la plupart des outils d’administration de base de données permettent d’établir une connexion à la base de cette manière.
Attention si vous redémarrez PostgreSQL (<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">postgresql</span> <span class="pre">restart</span></code>), il faut ensuite redémarrer les API de GeoNature et UsersHub :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature
<span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature-worker
<span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>usershub
</pre></div>
</div>
</dd>
<dt class="field-odd">Note<span class="colon">:</span></dt>
<dd class="field-odd"><p>Il est aussi important de configurer l’accès au serveur en HTTPS plutôt qu’en HTTP pour chiffrer le contenu des échanges entre le navigateur et le serveur (<a class="reference external" href="https://docs.ovh.com/fr/hosting/les-certificats-ssl-sur-les-hebergements-web/">https://docs.ovh.com/fr/hosting/les-certificats-ssl-sur-les-hebergements-web/</a>).</p>
</dd>
</dl>
</section>
</section>
</section>
<section id="installation-de-geonature-uniquement">
<span id="installation-standalone"></span><h2>Installation de GeoNature uniquement<a class="headerlink" href="#installation-de-geonature-uniquement" title="Lien vers cette rubrique">#</a></h2>
<p>Cette procédure détaille l’installation de GeoNature (incluant TaxHub) sans UsersHub.
Si vous souhaitez installer GeoNature avec UsersHub, reportez-vous à la section <a class="reference internal" href="#installation-all"><span class="std std-ref">Installation globale</span></a>.</p>
<section id="installation-des-dependances">
<h3>Installation des dépendances<a class="headerlink" href="#installation-des-dependances" title="Lien vers cette rubrique">#</a></h3>
<p>Installer les paquets suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt install unzip git postgresql-postgis postgis python3-pip python3-venv python3-dev libpq-dev libgdal-dev libffi-dev libpangocairo-1.0-0 apache2 redis
</pre></div>
</div>
</section>
<section id="recuperation-de-l-application">
<h3>Récupération de l’application<a class="headerlink" href="#recuperation-de-l-application" title="Lien vers cette rubrique">#</a></h3>
<ul>
<li><p>Se placer dans le répertoire de l’utilisateur (<code class="docutils literal notranslate"><span class="pre">/home/geonatureadmin/</span></code> dans notre cas)</p></li>
<li><p>Récupérer l’application (<code class="docutils literal notranslate"><span class="pre">X.Y.Z</span></code> à remplacer par le numéro de la <a class="reference external" href="https://github.com/PnEcrins/GeoNature/releases">dernière version stable de GeoNature</a>).</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ wget https://github.com/PnX-SI/GeoNature/archive/X.Y.Z.zip
</pre></div>
</div>
</li>
<li><p>Dézipper l’archive de l’application</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ unzip X.Y.Z.zip
$ rm X.Y.Z.zip
</pre></div>
</div>
</li>
<li><p>Renommer le répertoire de l’application puis placez-vous dedans :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mv GeoNature-X.Y.Z /home/`whoami`/geonature/
$ cd geonature
</pre></div>
</div>
</li>
<li><p>Copier puis mettre à jour le fichier de configuration (<code class="docutils literal notranslate"><span class="pre">config/settings.ini</span></code>) comportant les informations relatives à votre environnement serveur :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cp config/settings.ini.sample config/settings.ini
$ nano config/settings.ini
</pre></div>
</div>
</li>
</ul>
</section>
<section id="installation-de-l-application">
<h3>Installation de l’application<a class="headerlink" href="#installation-de-l-application" title="Lien vers cette rubrique">#</a></h3>
<p>Rendez vous dans le dossier <code class="docutils literal notranslate"><span class="pre">install</span></code> et lancez successivement dans l’ordre les scripts suivants :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">01_install_backend.sh</span></code> : Création du virtualenv python, installation des dépendances et du backend de GeoNature dans celui-ci.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">02_configure_systemd.sh</span></code> : Création des services systemd <code class="docutils literal notranslate"><span class="pre">geonature</span></code> et <code class="docutils literal notranslate"><span class="pre">geonature-worker</span></code>, configuration de <code class="docutils literal notranslate"><span class="pre">logrotate</span></code>, création des dossiers <code class="docutils literal notranslate"><span class="pre">/run/geonature</span></code> et <code class="docutils literal notranslate"><span class="pre">/var/log/geonature</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">03_create_db.sh</span></code> : Création du role PostgreSQL, de la base de données, ajout des extensions nécessaires (PostGIS, …), création des schémas nécessaires à GeoNature et ajout des données métiers.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">04_install_gn_modules.sh</span></code> : Installation des modules Occtax, Occhab et Validation (si activé dans le fichier <cite>settings.ini</cite>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">05_install_frontend.sh</span></code> : Création des dossiers et liens symboliques nécessaires, création des fichiers custom à partir des fichiers d’exemple, génération des fichiers de configuration grâce à la commande <code class="docutils literal notranslate"><span class="pre">geonature</span></code>, installation de nvm, npm et node ainsi que toutes les dépendances javascript nécessaires puis build du frontend, génération du fichier <code class="docutils literal notranslate"><span class="pre">src/assets/config.json</span></code> qui permet de connecter le frontend au backend.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">06_configure_apache.sh</span></code> : Installation du fichier de configuration Apache <code class="docutils literal notranslate"><span class="pre">/etc/apache2/conf-available/geonature.conf</span></code> et activation des modules Apache nécessaires.</p></li>
</ul>
<p>Vous pouvez alors démarrer le backend de GeoNature : <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">start</span> <span class="pre">geonature</span></code></p>
</section>
<section id="configuration-apache">
<h3>Configuration Apache<a class="headerlink" href="#configuration-apache" title="Lien vers cette rubrique">#</a></h3>
<ul>
<li><p>Le script <code class="docutils literal notranslate"><span class="pre">install/06_configure_apache.sh</span></code> copie le fichier de configuration de référence <code class="docutils literal notranslate"><span class="pre">install/assets/geonature_apache.conf</span></code>, le place dans <code class="docutils literal notranslate"><span class="pre">/etc/apache2/conf-available/geonature.conf</span></code> et remplace ses variables à partir de votre configuration de GeoNature.</p>
<p>Relancez ce script si vous changez l’URL de votre GeoNature ou les paramètres liés aux chemins et URL des fichiers statiques et des médias.</p>
</li>
<li><p>Créez la configuration du vhost, incluant la configuration par défaut créée précédemment :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>install/assets/vhost_apache.conf<span class="w"> </span>/etc/apache2/sites-available/geonature.conf<span class="w"> </span><span class="c1"># Copier le vhost</span>
<span class="gp">$ </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/apache2/sites-available/geonature.conf<span class="w"> </span><span class="c1"># Modifier la variable ``${DOMAIN_NAME}``</span>
</pre></div>
</div>
</li>
<li><p>Activez la nouvelle configuration :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>a2ensite<span class="w"> </span>geonature.conf
</pre></div>
</div>
</li>
<li><p>et redémarrez Apache :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>apache2
</pre></div>
</div>
</li>
<li><p>L’application est disponible à l’adresse suivante : <a class="reference external" href="http://monurl.fr/geonature">http://monurl.fr/geonature</a></p></li>
</ul>
<p>Une page HTML de maintenance et un vhost dédié sont aussi disponibles. Pour les mettre en place :</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>install/assets/vhost_apache_maintenance.conf<span class="w"> </span>/etc/apache2/sites-available/geonature_maintenance.conf<span class="w"> </span><span class="c1"># Copier le vhost</span>
<span class="gp">$ </span>sudo<span class="w"> </span>nano<span class="w"> </span>/etc/apache2/sites-available/geonature_maintenance.conf<span class="w"> </span><span class="c1"># Modifier la variable ``${DOMAIN_NAME}``</span>
<span class="gp">$ </span>sudo<span class="w"> </span>cp<span class="w"> </span>install/assets/maintenance.html<span class="w"> </span>/var/www/geonature_maintenance/index.html
</pre></div>
</div>
</div></blockquote>
<p>Pour passer votre GeoNature en maintenance, vous pouvez alors désactiver le vhost de GeoNature et activer celui de la page de maintenance :</p>
<blockquote>
<div><div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>sudo<span class="w"> </span>a2dissite<span class="w"> </span>geonature.conf
<span class="gp">$ </span>sudo<span class="w"> </span>a2ensite<span class="w"> </span>geonature_maintenance.conf
</pre></div>
</div>
</div></blockquote>
</section>
<section id="dependances">
<h3>Dépendances<a class="headerlink" href="#dependances" title="Lien vers cette rubrique">#</a></h3>
<p>Lors de l’installation de la BDD (<code class="docutils literal notranslate"><span class="pre">02_create_db.sh</span></code>), le schéma <code class="docutils literal notranslate"><span class="pre">utilisateurs</span></code> de UsersHub et le schéma <code class="docutils literal notranslate"><span class="pre">taxonomie</span></code> de TaxHub sont intégrés automatiquement dans la BDD de GeoNature.</p>
<p>UsersHub n’est pas nécessaire au fonctionnement de GeoNature mais il sera utile pour avoir une interface de gestion des utilisateurs, des groupes et de leurs droits.</p>
<p>TaxHub v2 est intégré à GeoNature depuis sa version 2.15.0</p>
<p>Voir la documentation de TaxHub : <a class="reference external" href="https://taxhub.readthedocs.io/">https://taxhub.readthedocs.io/</a></p>
<p>Voir la doc d’installation de UsersHub : <a class="reference external" href="https://usershub.readthedocs.io/">https://usershub.readthedocs.io/</a></p>
</section>
<section id="passer-en-mode-developpement">
<h3>Passer en mode développement<a class="headerlink" href="#passer-en-mode-developpement" title="Lien vers cette rubrique">#</a></h3>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Consultez le guide <a class="reference internal" href="development.html#mode-dev"><span class="std std-ref">Passer en mode développement</span></a> de GeoNature.</p>
</div>
</section>
</section>
<section id="docker">
<h2>Docker<a class="headerlink" href="#docker" title="Lien vers cette rubrique">#</a></h2>
<p>L’installation de GeoNature avec Docker est la manière la plus simple de déployer GeoNature, ses 4 modules externes principaux (Import, Export, Dashboard, Monitoring) et UsersHub, mais aussi de les mettre à jour, avec seulement quelques lignes de commandes.</p>
<p>Elle permet aussi d’installer GeoNature sur différents systèmes, et pas uniquement sur Debian, comme c’est le cas avec l’installation classique.</p>
<p>Elle peut néanmoins nécessiter de connaitre le fonctionnement de Docker pour ceux qui souhaitent aller plus loin et mettre en place une installation plus spécifique.</p>
<section id="docker-compose">
<h3>Docker Compose<a class="headerlink" href="#docker-compose" title="Lien vers cette rubrique">#</a></h3>
<p>Pour déployer facilement GeoNature avec Docker, utilisez le Docker Compose proposé et documenté dans le dépôt <a class="reference external" href="https://github.com/PnX-SI/Geonature-Docker-services/">GeoNature-Docker-services</a>.</p>
<p>Pour des déploiements Docker plus avancés et spécifiques, des images Docker des différents outils (GeoNature, UsersHub, GeoNature et ses 4 modules externes principaux) sont automatiquement construites et publiées à chaque nouvelle version publiée.</p>
</section>
<section id="image-backend">
<h3>Image backend<a class="headerlink" href="#image-backend" title="Lien vers cette rubrique">#</a></h3>
<p>Des images pré-construites automatiquement sont présentes sur <a class="reference external" href="https://github.com/PnX-SI/GeoNature/pkgs/container/geonature-backend/versions?filters%5Bversion_type%5D=tagged">Github</a>.</p>
<p>Les images tagguées <cite>-wheels</cite> contiennent les wheels Python de GeoNature, de ses dépendances et modules contrib, de manière à pouvoir être enrichies avec vos wheels provenant de vos propres modules (images de type « builder »).</p>
<p>Construction manuelle de l’image :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-f<span class="w"> </span>backend/Dockerfile<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--target<span class="o">=</span>prod<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--tag<span class="o">=</span>ghcr.io/pnx-si/geonature-backend:develop
</pre></div>
</div>
<p>Fonctionnement de l’image :</p>
<ul class="simple">
<li><p>GeoNature attend sa configuration dans le dossier <code class="docutils literal notranslate"><span class="pre">/dist/config</span></code> (à monter dans un volume afin de pouvoir la modifier).
L’emplacement du fichier de configuration peut également être précisé via la variable d’environnement <code class="docutils literal notranslate"><span class="pre">GEONATURE_CONFIG_FILE</span></code>.</p></li>
<li><p>Il est également possible de fournir une configuration Python via la variable d’environnement <code class="docutils literal notranslate"><span class="pre">GEONATURE_SETTINGS</span></code>.</p></li>
<li><p>Les médias seront stockés dans le dossier <code class="docutils literal notranslate"><span class="pre">/dist/media</span></code> (à monter dans un volume afin de les sauvegarder).</p></li>
<li><p>Toute variable d’environnement préfixée par <code class="docutils literal notranslate"><span class="pre">GEONATURE_</span></code> se verra traduite par un paramètre de configuration homonyme
(<a class="reference external" href="https://flask.palletsprojects.com/en/2.2.x/api/#flask.Config.from_prefixed_env">documentation Flask</a>).
Si vous souhaitez définir une variable de configuration se trouvant dans une section, utilisez deux <em>underscore</em>.
Par exemple, pour définir le paramètre <code class="docutils literal notranslate"><span class="pre">NB_LAST_OBS</span></code> de la section <code class="docutils literal notranslate"><span class="pre">[SYNTHESE]</span></code>, on définira une variable d’environnement <code class="docutils literal notranslate"><span class="pre">GEONATURE_SYNTHESE__NB_LAST_OBS</span></code>.</p></li>
<li><p>Pour peupler la base de données, référez-vous au script <code class="docutils literal notranslate"><span class="pre">install/03_create_db.sh</span></code>.</p></li>
</ul>
</section>
<section id="image-frontend">
<h3>Image frontend<a class="headerlink" href="#image-frontend" title="Lien vers cette rubrique">#</a></h3>
<p>Des images pré-construites automatiquement sont présentes sur <a class="reference external" href="https://github.com/PnX-SI/GeoNature/pkgs/container/geonature-frontend/versions?filters%5Bversion_type%5D=tagged">Github</a>.</p>
<p>Les images tagguées <cite>-source</cite> contiennent uniquement les sources de GeoNature et des modules contrib, et attendent d’être enrichies avec les sources de vos propres modules tandis que les images tagguées <cite>-nginx</cite> contiennent la configuration NGINX prête à l’emploi pour GeoNature (images de type « builder »).</p>
<p>Construction manuelle de l’image :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nv">DOCKER_BUILDKIT</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>-f<span class="w"> </span>frontend/Dockerfile<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--target<span class="o">=</span>prod<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--tag<span class="o">=</span>ghcr.io/pnx-si/geonature-frontend:develop
</pre></div>
</div>
<p>Fonctionnement de l’image :</p>
<ul class="simple">
<li><p>La configuration NGINX de l’image est générée dynamiquement à son démarrage, à partir des variables d’environnement suivantes :</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">NGINX_PORT</span></code> (défaut : 80)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NGINX_HOST</span></code> (défaut : localhost)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">NGINX_LOCATION</span></code> (défaut : /, à modifier pour servir GeoNature sur un préfixe)</p></li>
</ul>
</li>
<li><p>La variable d’environnement <code class="docutils literal notranslate"><span class="pre">API_ENDPOINT</span></code> est lue au démarrage de l’image afin de mettre à jour le fichier de configuration du frontend <code class="docutils literal notranslate"><span class="pre">assets/config.json</span></code>.</p></li>
</ul>
</section>
</section>
<section id="https">
<h2>HTTPS<a class="headerlink" href="#https" title="Lien vers cette rubrique">#</a></h2>
<p>Cette documentation est indicative car non-spécifique à GeoNature. Elle donne des indications sur la mise en place d’un certificat SSL pour une application web servie par Apache.</p>
<section id="utilisation-de-cerbot">
<h3>Utilisation de Cerbot<a class="headerlink" href="#utilisation-de-cerbot" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Source.</strong> <a class="reference external" href="https://korben.info/securiser-facilement-gratuitement-site-https.html">Sécuriser facilement et gratuitement un site avec HTTPS</a></p>
<p>La procédure décrit une méthode de certification HTTPS de votre domaine, grâce au service <a class="reference external" href="https://letsencrypt.org/">Let’s Encrypt</a>. Les manipulations ont été effectuées sur un serveur Debian 9 avec Apache2 installé, et un utilisateur bénéficiant des droits sudo.</p>
<p>Cerbot ne peut pas être utilisé pour la création d’un certificat sur une adresse IP (Exemple d’instances de test sans nom de domaine). Pour celà utiliser OpenSSL présenté rapidement ci-dessous.
Installation :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python3</span><span class="o">-</span><span class="n">certbot</span><span class="o">-</span><span class="n">apache</span>
</pre></div>
</div>
<p>Lancer la commande suivante pour générer des certificats et des clés pour le nom de domaine que vous souhaitez mettre en HTTPS.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">certbot</span> <span class="o">--</span><span class="n">apache</span> <span class="o">--</span><span class="n">email</span> <span class="n">monemail</span><span class="nd">@mondomaine</span><span class="o">.</span><span class="n">fr</span>
</pre></div>
</div>
<p>Activer les modules <code class="docutils literal notranslate"><span class="pre">ssl</span></code>, <code class="docutils literal notranslate"><span class="pre">headers</span></code> et <code class="docutils literal notranslate"><span class="pre">rewrite</span></code> puis redémarrer Apache :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">ssl</span>
<span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">rewrite</span>
<span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">headers</span>
<span class="n">sudo</span> <span class="n">apachectl</span> <span class="n">restart</span>
</pre></div>
</div>
<p>Les fichiers de configuration du site UsersHub n’est pas à modifier, il sera automatiquement associé à la configuration HTTPS. En revanche, la configuration de GeoNature doit être mise à jour.</p>
</section>
<section id="utilisation-de-openssl-sur-un-environnement-de-test">
<h3>Utilisation de OpenSSL sur un environnement de test<a class="headerlink" href="#utilisation-de-openssl-sur-un-environnement-de-test" title="Lien vers cette rubrique">#</a></h3>
<p>Cette procédure a été testée sur Debian 12 et Apache2 avec l’utilisation d’un certificat auto-signé. Cela signifie qu’une alerte sera envoyée aux navigateurs indiquant un manque de sécurisation du serveur.
Cette méthode fonctionne avec un serveur sans nom de domaine.</p>
<p>Création d’un nouveau certificat de 365 jours (30 jours par défaut), de type X509 avec l’emplacement des fichiers de certificat et de clé privé.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">openssl</span> <span class="n">req</span> <span class="o">-</span><span class="n">new</span> <span class="o">-</span><span class="n">x509</span> <span class="o">-</span><span class="n">days</span> <span class="mi">365</span> <span class="o">-</span><span class="n">nodes</span> <span class="o">-</span><span class="n">out</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">certs</span><span class="o">/</span><span class="n">mailserver</span><span class="o">.</span><span class="n">crt</span> <span class="o">-</span><span class="n">keyout</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">mailserver</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
<p>Sécurisation de la clé</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">chmod</span> <span class="mi">440</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">ssl</span><span class="o">/</span><span class="n">private</span><span class="o">/</span><span class="n">mailserver</span><span class="o">.</span><span class="n">key</span>
</pre></div>
</div>
<p>Chargement du module ssl dans Apache</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">a2enmod</span> <span class="n">ssl</span>
</pre></div>
</div>
<p>Modification de la configuration du VirtualHost en éditant le fichier <code class="docutils literal notranslate"><span class="pre">/etc/apache2/sites-available/geonature.conf</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;VirtualHost *:443&gt;
    ServerName x.x.x.x
    […]
    SSLEngine on
    SSLCertificateFile /etc/ssl/certs/mailserver.crt
    SSLCertificateKeyFile /etc/ssl/private/mailserver.key
&lt;/VirtualHost&gt;
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apachectl</span> <span class="n">restart</span>
</pre></div>
</div>
</section>
<section id="configuration-de-l-application-geonature">
<h3>Configuration de l’application GeoNature<a class="headerlink" href="#configuration-de-l-application-geonature" title="Lien vers cette rubrique">#</a></h3>
<p>Il est nécessaire de mettre à jour le fichier de configuration <code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code> situé dans le répertoire <code class="docutils literal notranslate"><span class="pre">geonature/config</span></code> :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">geonature</span><span class="o">/</span><span class="n">config</span>
<span class="n">nano</span> <span class="n">geonature_config</span><span class="o">.</span><span class="n">toml</span>
</pre></div>
</div>
<p>Modifier les éléments suivants :</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">URL_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;https://mondomaine.fr/geonature&#39;</span>
<span class="n">API_ENDPOINT</span> <span class="o">=</span> <span class="s1">&#39;https://mondomaine.fr/geonature/api&#39;</span>
</pre></div>
</div>
<p>Pour que ces modifications soient prises en compte, exécuter les <a class="reference internal" href="admin-manual.html#post-config-change"><span class="std std-ref">actions à effecture après modification de la configuration</span></a>.</p>
<p>Les applications sont désormais accessibles sur votre domaine sécurisé en HTTPS !</p>
</section>
</section>
<section id="taches-planifiees">
<span id="cron"></span><h2>Taches planifiées<a class="headerlink" href="#taches-planifiees" title="Lien vers cette rubrique">#</a></h2>
<p>Depuis sa version 2.12.0, les taches planifiées gérées par des crons ont été remplacées par des taches lancées automatiquement par Celery Beat, pour être mis en place automatiquement lors de l’installation de GeoNature et être plus facilement administrables.</p>
</section>
<section id="installation-d-un-module-geonature">
<span id="install-gn-module"></span><h2>Installation d’un module GeoNature<a class="headerlink" href="#installation-d-un-module-geonature" title="Lien vers cette rubrique">#</a></h2>
<p>L’installation de GeoNature n’est livrée qu’avec les modules du coeur par défaut : Occtax, Occhab et Validation. Pour ajouter un module GeoNature externe, il est nécessaire de l’installer :</p>
<section id="id4">
<h3>Téléchargement<a class="headerlink" href="#id4" title="Lien vers cette rubrique">#</a></h3>
<p>Téléchargez le module depuis son dépôt Github puis dézippez-le dans le repertoire utilisateur, au même niveau que le dossier de GeoNature.</p>
</section>
<section id="installation-automatique">
<span id="install-gn-module-auto"></span><h3>Installation automatique<a class="headerlink" href="#installation-automatique" title="Lien vers cette rubrique">#</a></h3>
<p>Installation avec la sous-commande <code class="docutils literal notranslate"><span class="pre">install-gn-module</span></code> :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>&lt;dossier<span class="w"> </span>GeoNature&gt;/backend/venv/bin/activate
geonature<span class="w"> </span>install-gn-module<span class="w"> </span>&lt;dossier<span class="w"> </span>du<span class="w"> </span>module&gt;<span class="w"> </span>&lt;code<span class="w"> </span>du<span class="w"> </span>module&gt;
</pre></div>
</div>
<p>Exemple pour le module Import :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/GeoNature/backend/venv/bin/activate
geonature<span class="w"> </span>install-gn-module<span class="w"> </span>~/gn_module_import/<span class="w"> </span>IMPORT
</pre></div>
</div>
<p>Puis relancer GeoNature et son worker :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature-worker
</pre></div>
</div>
<p>Aucune permission n’est définie par défaut lors de l’installation d’un module. En tant qu’administrateur, vous pouvez exécuter une commande ajoutant tous les droits sur tous les modules à un groupe ou utilisateur. Cette commande peut être relancée après l’installation d’un module pour automatiquement attribuer toutes les permissions à un groupe ou utilisateur administrateur :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># changer &quot;Grp_Admin&quot; par le nom de votre groupe d&#39;administrateur si vous l&#39;avez changé</span>
geonature<span class="w"> </span>permissions<span class="w"> </span>supergrant<span class="w"> </span>--group<span class="w"> </span>--nom<span class="w"> </span><span class="s2">&quot;Grp_admin&quot;</span>
</pre></div>
</div>
<p>Vous devrez ensuite définir des droits à vos utilisateurs pour le nouveau module installé.</p>
</section>
<section id="installation-manuelle">
<h3>Installation manuelle<a class="headerlink" href="#installation-manuelle" title="Lien vers cette rubrique">#</a></h3>
<p><strong>Installation du backend</strong></p>
<p>Installer le module avec <code class="docutils literal notranslate"><span class="pre">pip</span></code> en mode éditable après avoir activé le venv de GeoNature, puis relancer GeoNature :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/geonature/backend/venv/bin/activate
pip<span class="w"> </span>install<span class="w"> </span>--editable<span class="w"> </span>&lt;dossier<span class="w"> </span>du<span class="w"> </span>module&gt;
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature
</pre></div>
</div>
<p id="module-install-frontend"><strong>Installation du frontend</strong></p>
<ul class="simple">
<li><p>Créer un lien symbolique dans le dossier <code class="docutils literal notranslate"><span class="pre">frontend/external_modules</span></code> de GeoNature vers le dossier <code class="docutils literal notranslate"><span class="pre">frontend</span></code> du module.
Le lien symbolique doit être nommé suivant le code du module en minuscule :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/geonature/frontend/external_modules/
ln<span class="w"> </span>-s<span class="w"> </span>&lt;dossier<span class="w"> </span>du<span class="w"> </span>module&gt;/frontend<span class="w"> </span>&lt;code<span class="w"> </span>du<span class="w"> </span>module<span class="w"> </span>en<span class="w"> </span>minuscule&gt;
</pre></div>
</div>
<p>Exemple pour le module Import :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/geonature/frontend/external_modules/
ln<span class="w"> </span>-s<span class="w"> </span>~/gn_module_import/frontend<span class="w"> </span>import
</pre></div>
</div>
<ul class="simple">
<li><p>Re-builder le frontend :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/geonature/frontend/
nvm<span class="w"> </span>use
npm<span class="w"> </span>run<span class="w"> </span>build
</pre></div>
</div>
<p><strong>Installation de la base de données</strong></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span><span class="w"> </span>~/geonature/backend/venv/bin/activate
geonature<span class="w"> </span>upgrade-modules-db<span class="w"> </span>&lt;code<span class="w"> </span>du<span class="w"> </span>module&gt;
</pre></div>
</div>
</section>
<section id="configuration-du-module">
<span id="module-config"></span><h3>Configuration du module<a class="headerlink" href="#configuration-du-module" title="Lien vers cette rubrique">#</a></h3>
<p>De manière facultative, vous pouvez modifier la configuration du module.
Pour cela, vous pouvez créer un fichier de configuration dans le dossier <code class="docutils literal notranslate"><span class="pre">config</span></code> de GeoNature en le nommant <code class="docutils literal notranslate"><span class="pre">&lt;code</span> <span class="pre">du</span> <span class="pre">module</span> <span class="pre">en</span> <span class="pre">minuscule&gt;_config.toml</span></code>.
La plupart des modules fournissent un fichier d’exemple <code class="docutils literal notranslate"><span class="pre">&lt;module-code&gt;_config.toml.example</span></code> dans leur dossier racine dont vous pouvez vous inspirer.</p>
<p>Après création de ce fichier, activez le rechargement automatique de GeoNature lors des modifications du fichier en lançant les commandes suivantes :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
sudo<span class="w"> </span>systemctl<span class="w"> </span>restart<span class="w"> </span>geonature
</pre></div>
</div>
<p>Avant la version 2.12.0 de GeoNature, après chaque modification de la configuration du module, vous devez recharger GeoNature manuellement :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo<span class="w"> </span>systemctl<span class="w"> </span>reload<span class="w"> </span>geonature
</pre></div>
</div>
</section>
<section id="mise-a-jour-du-module">
<h3>Mise à jour du module<a class="headerlink" href="#mise-a-jour-du-module" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Déplacer le code de l’ancienne version du module : <code class="docutils literal notranslate"><span class="pre">mv</span> <span class="pre">gn_module_xxx</span> <span class="pre">gn_module_xxx_old</span></code></p></li>
<li><p>Télécharger et désarchiver la nouvelle version du module, et renommer son dossier afin qu’il porte le même nom qu’avant (<em>e.g.</em> <code class="docutils literal notranslate"><span class="pre">gn_module_xxx</span></code>)</p></li>
<li><p>(Optionnel) Si le fichier de configuration du module est encore placé avec celui-ci, le déplacer dans la dossier de configuration centralisée de GeoNature : <code class="docutils literal notranslate"><span class="pre">cp</span> <span class="pre">gn_module_xxx_old/config/conf_gn_module.toml</span> <span class="pre">geonature/config/&lt;mode-code&gt;_config.toml</span></code></p></li>
<li><p>Relancer l’<a class="reference internal" href="#install-gn-module-auto"><span class="std std-ref">installation du module</span></a> : <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">install-gn-module</span> <span class="pre">gn_module_xxx</span> <span class="pre">XXX</span> <span class="pre">&amp;&amp;</span> <span class="pre">sudo</span> <span class="pre">systemctl</span> <span class="pre">reload</span> <span class="pre">geonature</span></code></p></li>
</ul>
</section>
</section>
<section id="mise-a-jour-de-l-application">
<h2>Mise à jour de l’application<a class="headerlink" href="#mise-a-jour-de-l-application" title="Lien vers cette rubrique">#</a></h2>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Avant chaque mise à jour de GeoNature, il est important de sauvegarder l’application et sa base de données, ou de faire un snapshot du serveur pour pouvoir revenir à son état antérieure avant mise à jour, en cas de problème.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>Vérifiez préalablement la compatibilité des modules que vous utilisez avant de mettre GeoNature à jour.
S’il est nécessaire de les mettre à jour, arrêtez vous après le remplacement du dossier par le nouveau code source
(et la récupération éventuelle de la configuration); le script de migration de GeoNature s’occupera automatiquement
d’installer la nouvelle version du module.</p>
</div>
<p>La mise à jour de GeoNature consiste à télécharger sa nouvelle version dans un nouveau répertoire, récupérer les fichiers de configuration et de surcouche, ainsi que les médias depuis la version actuelle et de relancer l’installation dans le répertoire de la nouvelle version.</p>
<p>La mise à jour doit être réalisée avec votre utilisateur linux courant (<code class="docutils literal notranslate"><span class="pre">geonatureadmin</span></code> par exemple) et non pas le super-utilisateur <code class="docutils literal notranslate"><span class="pre">root</span></code>.</p>
<ul class="simple">
<li><p>Télécharger la dernière version de GeoNature :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>wget<span class="w"> </span>https://github.com/PnX-SI/GeoNature/archive/X.Y.Z.zip
unzip<span class="w"> </span>X.Y.Z.zip
rm<span class="w"> </span>X.Y.Z.zip
</pre></div>
</div>
<ul class="simple">
<li><p>Renommer l’ancien repertoire de l’application, ainsi que le nouveau :</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>mv<span class="w"> </span>~/geonature/<span class="w"> </span>~/geonature_old/
mv<span class="w"> </span>~/GeoNature-X.Y.Z<span class="w"> </span>~/geonature/
<span class="nb">cd</span><span class="w"> </span>~/geonature
</pre></div>
</div>
<ul class="simple">
<li><p>Suivez les éventuelles notes de version spécifiques décrites au niveau de chaque version : <a class="github reference external" href="https://github.com/PnX-SI/GeoNature/releases">PnX-SI/GeoNature</a>.</p></li>
</ul>
<p>Sauf mentions contraires dans les notes de version, vous pouvez sauter des versions mais en suivant bien les différentes notes de versions intermédiaires.</p>
<ul class="simple">
<li><p>Si vous devez aussi mettre à jour UsersHub, suivez ses notes de version et sa documentation (<a class="reference external" href="https://usershub.readthedocs.io">https://usershub.readthedocs.io</a>).</p></li>
<li><p>Lancez le script de <code class="docutils literal notranslate"><span class="pre">migration.sh</span></code> à la racine du dossier <code class="docutils literal notranslate"><span class="pre">geonature</span></code>:</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./install/migration/migration.sh<span class="w"> </span><span class="m">2</span>&gt;<span class="p">&amp;</span><span class="m">1</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>install/migration/migration.log
</pre></div>
</div>
<p>Depuis la version 2.12, le script <cite>migration.sh</cite> peut prendre en argument le chemin vers l’ancien dossier d’installation de GeoNature. Il peut s’agir du même dossier que la nouvelle installation de GeoNature. Cela permet d’utiliser ce script si la nouvelle version de GeoNature est dans le même dossier et donc de gérer le cas où GeoNature est installé et mis à jour avec git.</p>
<p>Dans ce cas, les commandes à exécuter sont :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span><span class="w"> </span>~/GeoNature
git<span class="w"> </span>status<span class="w"> </span><span class="c1"># optionnel, pour connaitre l&#39;état et la version ou branche actuellement utilisée</span>
git<span class="w"> </span>fetch
git<span class="w"> </span>checkout<span class="w"> </span>X.Y.Z<span class="w"> </span><span class="c1"># où X.Y.Z est le numéro du tag de la version vers laquelle faire la mise à jour, ou le nom de la branche à utiliser</span>
git<span class="w"> </span>submodule<span class="w"> </span>update<span class="w"> </span><span class="c1"># ou &quot;git config submodule.recurse true&quot; lancé une seule fois, pour que la mise à jour des sous-modules soit relancée automatiquement à chaque &quot;git pull&quot;</span>
./install/migration/migration.sh<span class="w"> </span>.
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="index.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">précédent</p>
        <p class="prev-next-title">Bienvenue dans la documentation de GeoNature</p>
      </div>
    </a>
    <a class="right-next"
       href="user-manual.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">suivant</p>
        <p class="prev-next-title">Manuel utilisateur</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prerequis">Prérequis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#preparation-du-serveur">Préparation du serveur</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-globale">Installation globale</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-des-applications">Installation des applications</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#telechargement">Téléchargement</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration">Configuration</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Installation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-de-geonature-uniquement">Installation de GeoNature uniquement</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-des-dependances">Installation des dépendances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recuperation-de-l-application">Récupération de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-de-l-application">Installation de l’application</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-apache">Configuration Apache</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#dependances">Dépendances</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#passer-en-mode-developpement">Passer en mode développement</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#docker">Docker</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#docker-compose">Docker Compose</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-backend">Image backend</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#image-frontend">Image frontend</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#https">HTTPS</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-de-cerbot">Utilisation de Cerbot</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation-de-openssl-sur-un-environnement-de-test">Utilisation de OpenSSL sur un environnement de test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-de-l-application-geonature">Configuration de l’application GeoNature</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#taches-planifiees">Taches planifiées</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-d-un-module-geonature">Installation d’un module GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">Téléchargement</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-automatique">Installation automatique</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#installation-manuelle">Installation manuelle</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module">Configuration du module</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mise-a-jour-du-module">Mise à jour du module</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mise-a-jour-de-l-application">Mise à jour de l’application</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par PnE, PnC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2024, Parc National des Écrins, Parc National des Cévennes.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>