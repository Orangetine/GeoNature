
<!DOCTYPE html>


<html lang="fr" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Gestion de la sensibilité &#8212; Documentation GeoNature 2.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css?v=fd3f3429" />
  
  <!-- So that users can add custom icons -->
  <script src="_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="_static/documentation_options.js?v=94f178cf"></script>
    <script src="_static/doctools.js?v=9a2dae69"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="_static/translations.js?v=041d0952"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'sensitivity';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Recherche" href="search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="2.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/LogoGeonature.jpg" class="logo__image only-light" alt="Documentation GeoNature 2.0 - Home"/>
    <img src="_static/LogoGeonature.jpg" class="logo__image only-dark pst-js-only" alt="Documentation GeoNature 2.0 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PnX-SI/GeoNature" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="user-manual.html">Manuel utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="admin-manual.html">Manuel administrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="development.html">Développement</a></li>

<li class="toctree-l1"><a class="reference internal" href="FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">Auteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="CHANGELOG.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-references.html">API REFERENCES</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Dépôt source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature/blob/master/docs/sensitivity.rst?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/sensitivity.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Gestion de la sensibilité</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criteres-de-sensibilite">Critères de sensibilité</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#niveaux-de-sensibilite">Niveaux de sensibilité</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-plus-d-informations">Pour plus d’informations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-dans-geonature">Intégration dans GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stockage-des-regles-en-base">Stockage des règles en base</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution-aux-observations-de-la-synthese">Attribution aux observations de la synthèse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-du-referentiel">Gestion du référentiel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#personnalisation">Personnalisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#traitement-des-problematiques-lies-aux-zonages">Traitement des problématiques liés aux zonages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="gestion-de-la-sensibilite">
<h1>Gestion de la sensibilité<a class="headerlink" href="#gestion-de-la-sensibilite" title="Lien vers cette rubrique">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Lien vers cette rubrique">#</a></h2>
<p>Les régles de sensibilité définies par défaut sont issues des règles du SINP.
Elles dépendent de l’espèce et de l’observation. C’est-à-dire que pour une espèce donnée,
plusieurs niveaux de sensibilité sont possibles selon l’observation.</p>
<section id="criteres-de-sensibilite">
<h3>Critères de sensibilité<a class="headerlink" href="#criteres-de-sensibilite" title="Lien vers cette rubrique">#</a></h3>
<ul class="simple">
<li><p>Taxon</p></li>
<li><p>Emplacement</p></li>
<li><p>Ancienneté</p></li>
<li><p>Période de l’année</p></li>
<li><p>Statut biologique</p></li>
<li><p>Comportement de l’occurence</p></li>
</ul>
<p>Certaines règles de sensibilité peuvent porter uniquement sur l’espèce,
rendant l’entiereté des observations d’une espèce (et donc une espèce) sensible.</p>
</section>
<section id="niveaux-de-sensibilite">
<h3>Niveaux de sensibilité<a class="headerlink" href="#niveaux-de-sensibilite" title="Lien vers cette rubrique">#</a></h3>
<p>Voici les 5 niveaux de sensibilité définis par le SINP :</p>
<ul class="simple">
<li><p>Sensible - Aucune diffusion</p></li>
<li><p>Sensible - Diffusion au département</p></li>
<li><p>Sensible - Diffusion à la maille 10km</p></li>
<li><p>Sensible - Diffusion à la Commune ou Znieff</p></li>
<li><p>Non sensible - Diffusion précise</p></li>
</ul>
</section>
<section id="pour-plus-d-informations">
<h3>Pour plus d’informations<a class="headerlink" href="#pour-plus-d-informations" title="Lien vers cette rubrique">#</a></h3>
<p>Vous pouvez consulter :</p>
<ul class="simple">
<li><p>La page du site du <a class="reference external" href="https://inpn.mnhn.fr/programme/donnees-observations-especes/references/sensibilite">SINP traitant de la sensibilité</a>.</p></li>
<li><p>Le rapport de 2020 sur <a class="reference external" href="https://inpn.mnhn.fr/docs-web/docs/download/355449">La sensibilité des données du système  d’information  de l’inventaire  du  patrimoine naturel : méthodes, pratiques et usages (J. Ichter et S. Robert)</a>.</p></li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Avertissement</p>
<p>L’objectif de ce document n’est pas de modifier les règles établies par
le SINP. Il est donc conseillé de respecter ces règles définies au niveau
régional et national et donc de ne pas ajouter de règles locales.</p>
</div>
</section>
</section>
<section id="integration-dans-geonature">
<h2>Intégration dans GeoNature<a class="headerlink" href="#integration-dans-geonature" title="Lien vers cette rubrique">#</a></h2>
<section id="stockage-des-regles-en-base">
<h3>Stockage des règles en base<a class="headerlink" href="#stockage-des-regles-en-base" title="Lien vers cette rubrique">#</a></h3>
<p>Les règles de sensibilité sont stockées dans le schéma <code class="docutils literal notranslate"><span class="pre">gn_sensitivity</span></code>
qui contient 3 tables :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> qui relie notamment une espèce à un niveau de
sensibilité</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> qui permet de restreindre une règle de
sensibilité en fonction d’un critère (par exemple, statut biologique)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code> qui permet de restreindre une règle de
sensibilité à une zone géographique</p></li>
</ul>
<p>S’il n’y a aucune entrée dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code>, le niveau de
sensibilité défini dans <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code> est appliqué peu importe
le statut biologique ou le comportement de l’occurence.
De même, s’il n’y a aucune entrée dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_area</span></code>, le niveau
de sensibilité est appliqué peu importe la localisation de l’observation.
À l’inverse, s’il y a plusieurs entrées, la sensibilité est appliqué dès
que l’un des critères ou l’une des zones correspond à l’observation.</p>
<p>Certaines règles sont définies non pas pour une espèce donnée mais pour un
rang supérieur. Ces règles sont artificiellement dupliquées pour chaques espèces
sous-jacentes dans la vue matérialisée <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules_cd_ref</span></code>.
Il est nécessaire de la rafraichir lors de l’évolution du référentiel
de sensibilité.</p>
</section>
<section id="attribution-aux-observations-de-la-synthese">
<h3>Attribution aux observations de la synthèse<a class="headerlink" href="#attribution-aux-observations-de-la-synthese" title="Lien vers cette rubrique">#</a></h3>
<p>La sensibilité des observations de la synthèse est stockée dans la
colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code>.</p>
<p>A chaque insertion d’une donnée dans la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code>,
un trigger (<code class="docutils literal notranslate"><span class="pre">tri_insert_calculate_sensitivity</span></code>) fait appel à une
fonction (<code class="docutils literal notranslate"><span class="pre">fct_tri_cal_sensitivity_on_each_statement</span></code>) qui appelle
elle-même la fonction <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.get_id_nomenclature_sensitivity</span></code>
pour le calcul de la sensibilité.</p>
</section>
<section id="gestion-du-referentiel">
<h3>Gestion du référentiel<a class="headerlink" href="#gestion-du-referentiel" title="Lien vers cette rubrique">#</a></h3>
<p>GeoNature fournit la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span></code> pour gérer son référentiel
de sensibilité :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">info</span></code> : statistiques sur les règles présentes</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">add-referential</span></code> : import de nouvelles règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">remove-referential</span></code> : suppression de règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code> : mise à jour de la vue matérialisées des règles</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">update-synthese</span></code> : recalcul de la sensibilité des observations de la synthèse</p></li>
</ul>
<p>Le référentiel de sensibilité fourni par le SINP est normalement intégré
à GeoNature lors de son installation. Sinon, il peut être manuellement
intégré ou mis à jour avec l’une ou l’autre des commandes suivantes (selon votre version de Taxref) :</p>
<p>Taxref v17 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v17 20240325&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV17_20240325.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_17.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>utf-8
</pre></div>
</div>
<p>Taxref v16 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v16 20230203&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://geonature.fr/data/inpn/sensitivity/RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV16_20230203.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibiliteV16_20230203/RefSensibilite_16.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Taxref v15 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v15 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401875<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV15_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_V15_31032022/RefSensibilite_15.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Taxref v14 :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>add-referential<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--source-name<span class="w"> </span><span class="s2">&quot;Référentiel sensibilité TAXREF v14 20220331&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--url<span class="w"> </span>https://inpn.mnhn.fr/docs-web/docs/download/401876<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--zipfile<span class="w"> </span>RefSensibiliteV14_20220331.zip<span class="w"> </span><span class="se">\</span>
<span class="w">        </span>--csvfile<span class="w"> </span>RefSensibilite_V14_31032022/RefSensibilite_14.csv<span class="w">  </span><span class="se">\</span>
<span class="w">        </span>--encoding<span class="o">=</span>iso-8859-15
</pre></div>
</div>
<p>Le jeu de règles est fourni pour chaque version précise de Taxref, certaines
espèces sensibles pouvant voir leur <em>cd_nom</em> changé d’une version à l’autre.</p>
<p>Si vous mettez à jour votre version du référentiel de sensibilité, il faut ensuite relancer
le calcul des règles de sensibilité avec la commande <code class="docutils literal notranslate"><span class="pre">geonature</span> <span class="pre">sensitivity</span> <span class="pre">refresh-rules-cache</span></code>.</p>
</section>
<section id="personnalisation">
<h3>Personnalisation<a class="headerlink" href="#personnalisation" title="Lien vers cette rubrique">#</a></h3>
<p>Pour l’instant, seule la personnalisation de la sensibilité pour
une espèce donnée (peu importe l’observation) est abordée ici.</p>
<ol class="arabic">
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">gn_sensitivity.t_sensitivity_rules</span></code> : Changez le niveau de
sensibilité <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> par celui désiré. Pour la
valeur à renseigner, voir dans <code class="docutils literal notranslate"><span class="pre">t_nomenclature</span></code> en filtrant avec
<code class="docutils literal notranslate"><span class="pre">id_type=ref_nomenclatures.get_id_nomenclature_type('SENSIBILITE')</span></code>.</p></li>
<li><p>Dans <code class="docutils literal notranslate"><span class="pre">cor_sensitivity_criteria</span></code> : s’il y a une correspondance
d”<code class="docutils literal notranslate"><span class="pre">id_sensitivity</span></code> avec <code class="docutils literal notranslate"><span class="pre">t_sensitivity_rules</span></code>, modifiez ou supprimez cette ligne.</p></li>
<li><p>Rafraichissez le cache des règles extrapolées aux espèces :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>refresh-rules-cache
</pre></div>
</div>
<p>Ceci est équivalent à lancer manuellement la commande SQL suivante :</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="n">REFRESH</span><span class="w"> </span><span class="n">MATERIALIZED</span><span class="w"> </span><span class="k">VIEW</span><span class="w"> </span><span class="n">gn_sensitivity</span><span class="p">.</span><span class="n">t_sensitivity_rules_cd_ref</span>
</pre></div>
</div>
</li>
<li><p>Il est maintenant nécessaire de mettre à jour la sensibilité de vos
observations présentes dans la synthèse. Pour cela, lancez la commande suivante :</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>geonature<span class="w"> </span>sensitivity<span class="w"> </span>update-synthese
</pre></div>
</div>
</li>
</ol>
<p>Les valeurs dans la colonne <code class="docutils literal notranslate"><span class="pre">id_nomenclature_sensitivity</span></code> des observations sensibles
de la table <code class="docutils literal notranslate"><span class="pre">gn_synthese.synthese</span></code> auront alors
changé. Vous pouvez le vérifier en navigant dans le module Synthèse
puis dans les détails d’une observation de votre/vos espèce(s).</p>
</section>
<section id="utilisation">
<h3>Utilisation<a class="headerlink" href="#utilisation" title="Lien vers cette rubrique">#</a></h3>
<p>Un lien entre la synthèse et la sensibilité a été mis en place : le floutage des données sensibles.</p>
<p>L’objectif et de pouvoir donner accès aux utilisateurs à des données sensibles mais pas de façon précise.
C’est à dire, en fonction du niveau de sensibilité de l’observation, un utilisateur pourra voir uniquement
l’observation à la maille de 10km par exemple.</p>
<p>Comme décrit ci-dessous, un paramètre en configuration a été ajoutée pour donner l’a possibilité d’exclure
toutes les données sensibles plutôt que de les flouter.</p>
<section id="implementation">
<h4>Implementation<a class="headerlink" href="#implementation" title="Lien vers cette rubrique">#</a></h4>
<p>Basée sur le nouveau système de permissions (v2.13), l’implémentation dans ce système se résout à
l’ajout d’un filtre : exlure/flouter les données sensibles.
Le choix entre l’exclusion et le floutage est décidé par le paramètre en configuration :</p>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[SYNTHESE]</span>
<span class="n">BLUR_SENSITIVE_OBSERVATIONS</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
</pre></div>
</div>
<p>Si <cite>BLUR_SENSITIVE_OBSERVATIONS=true</cite> alors les observations seront floutées. Sinon exclues.</p>
<p>L’exclusion des données sensibles est simple : si le filtre « exclure les données sensibles » est coché,
l’utilisateur n’aura pas accès (pour un scope défini) aux données sensibles quelque soit leur niveau
de sensibilité soit :
- Sensible - Diffusion à la Commune ou Znieff
- Sensible - Diffusion à la maille 10km
- Sensible - Diffusion au département
- Sensible - Aucune diffusion</p>
<p>Pour la suite de la documentation, le paramètre est considéré comme le suivant : <cite>BLUR_SENSITIVE_OBSERVATIONS=true</cite>.
Donc toute donnée sensible avec restriction d’accès sera floutée.</p>
<p>Si ce filtre n’est pas activé, la récupération des données de la synthèse en backend reste inchangée.
En effet, l’ajout du floutage des données nuit forcément aux performances.</p>
<p>S’il est activé, une requête SQL est construite comme suit :</p>
<img alt="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" src="https://raw.githubusercontent.com/PnX-SI/GeoNature/develop/docs/images/blurring_query.svg" />
<p>Le but est d’ajouter à la requête principale une sous-requête exécutant deux requêtes <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> dans
la table de synthèse afin de séparer les données précises des données floutées. Ensuite un <code class="docutils literal notranslate"><span class="pre">UNION</span></code>
est fait afin de rassembler les données avec priorité sur les données précises.</p>
<p>Dans ces deux requêtes, les permissions ainsi que les filtres utilisateurs sont pris en comptes, donc
l’utilisateur n’a pas obligatoirement accès à toutes les données, c’est à la charge de l’administrateur.
Le fait de prendre en compte les filtres dans chacune des deux requêtes permet une cohérence dans les
résultats renvoyés par ces deux requêtes (car un <code class="docutils literal notranslate"><span class="pre">LIMIT</span></code> est souvent présent).</p>
<p>Ce floutage des données a été implémenté sur 3 routes de la synthèse :</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">/for_web</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/vsynthese/&lt;id_synthese&gt;</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">/export_observations</span></code></p></li>
</ul>
<p>Des tests unitaires ont également été écrits.</p>
</section>
<section id="traitement-des-problematiques-lies-aux-zonages">
<h4>Traitement des problématiques liés aux zonages<a class="headerlink" href="#traitement-des-problematiques-lies-aux-zonages" title="Lien vers cette rubrique">#</a></h4>
<p><strong>Traitement de l’affichage en mode maille</strong></p>
<p>Il a été décidé d’exclure les données sensibles dont la géométrie floutée est plus grande que la
maille affichée en mode maille dans la synthèse.</p>
<p>C’est à dire que si une observation est dégradée/floutée à la maille M10 (10km²) et que le mode maille
affiche les observations regroupées dans les mailles de type M5 (5km), l’observation n’apparaitra dans
aucune maille mais dans seulement dans la liste des observations.</p>
<p>Pour rappel la maille de regroupement pour affichage dans le mode maille est définie par le paramètre
suivant :</p>
<p>Pour que ce filtrage soit effectué, il était nécessaire d’introduire une nouvelle colonne dans la table
<code class="docutils literal notranslate"><span class="pre">ref_geo.bib_area_types</span></code> : <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> qui permet d’ordonner les types de zones par leur
taille moyenne. Pour les mailles cela est simple, pour les départements et les communes notamment
utilisées pour flouter la donnée, cela est plus complexe. Leur taille a donc été donnée arbitrairement.
Le floutage des données est censé évoluer vers des zones de floutages basées exclusivement sur des
mailles. Le problème de la taille arbitraire ne sera alors plus d’actualité.</p>
<p><strong>Traitement des zonages associés</strong></p>
<p>L’introduction de la nouvelle colone <code class="docutils literal notranslate"><span class="pre">size_hierarchy</span></code> permet également d’afficher uniquement les
zonages plus grands que la géométrie floutée dans l’onglet Zonage des détails d’une observation en
synthèse. Par exemple, les mailles M1 (1km²) et M5 (5km²) d’une observation floutée à la maille M10
(10km²) n’apparaitront pas.</p>
<p><strong>Traitement du filtre de type « zonage »</strong></p>
<p>Pour rappel, ce filtre permet de rechercher si des observations intersectent des zones choisies par
l’utilisateur. Ces zones sont disponibles dans la section « Où » dans le module Synthèse.</p>
<p>En backend, quand l’utilisateur voit les données précisément, le filtre fonctionne grâce à la
table <code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code>, évitant de procéder à l’appel de <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> plus lent.</p>
<p>Ce filtre fonctionne différemment quand l’utilisateur dispose de permissions floutant les
données. En effet, un <code class="docutils literal notranslate"><span class="pre">ST_Intersects</span></code> est effectué sur la géométrie floutée car l’utilisation de
<code class="docutils literal notranslate"><span class="pre">gn_synthese.cor_area_synthese</span></code> pourrait donner trop d’informations à l’utilisateur et ce dernier
pourrait obtenir des données plus précises que souhaité par recherche sur différentes communes alors
que l’observation est floutée au département par exemple.</p>
</section>
</section>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#criteres-de-sensibilite">Critères de sensibilité</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#niveaux-de-sensibilite">Niveaux de sensibilité</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pour-plus-d-informations">Pour plus d’informations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integration-dans-geonature">Intégration dans GeoNature</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stockage-des-regles-en-base">Stockage des règles en base</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#attribution-aux-observations-de-la-synthese">Attribution aux observations de la synthèse</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#gestion-du-referentiel">Gestion du référentiel</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#personnalisation">Personnalisation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#utilisation">Utilisation</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">Implementation</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#traitement-des-problematiques-lies-aux-zonages">Traitement des problématiques liés aux zonages</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par PnE, PnC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2024, Parc National des Écrins, Parc National des Cévennes.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>