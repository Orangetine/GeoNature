
<!DOCTYPE html>


<html lang="fr" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Module Import &#8212; Documentation GeoNature 2.0</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!-- 
    this give us a css class that will be invisible only if js is disabled 
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=26a4bc78f4c0ddb94549" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=fd3f3429" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=26a4bc78f4c0ddb94549"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549" />

    <script src="../_static/documentation_options.js?v=94f178cf"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script src="../_static/translations.js?v=041d0952"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'admin/import-admin';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="fr"/>
  <meta name="docsearch:version" content="2.0" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/LogoGeonature.jpg" class="logo__image only-light" alt="Documentation GeoNature 2.0 - Home"/>
    <img src="../_static/LogoGeonature.jpg" class="logo__image only-dark pst-js-only" alt="Documentation GeoNature 2.0 - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/PnX-SI/GeoNature" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Recherche</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-manual.html">Manuel utilisateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="../admin-manual.html">Manuel administrateur</a></li>
<li class="toctree-l1"><a class="reference internal" href="../development.html">Développement</a></li>

<li class="toctree-l1"><a class="reference internal" href="../FAQ.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Auteurs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CHANGELOG.html">CHANGELOG</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-references.html">API REFERENCES</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Dépôt source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/PnX-SI/GeoNature/blob/master/docs/admin/import-admin.rst?plain=1" target="_blank"
   class="btn btn-sm btn-source-file-button dropdown-item"
   title="Show source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">Show source</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Téléchargez cette page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/admin/import-admin.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Télécharger le fichier source"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Imprimer au format PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Mode plein écran"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Recherche" aria-label="Recherche" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module Import</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contenu </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts">Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faire-un-import-le-minimum-requis">Faire un import, le minimum requis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deroulement-dun-import">Déroulement d’un import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module-dimport">Configuration du module d’import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-de-limport">Permissions de l’import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-et-suppression-d-un-import">Modification et Suppression d’un import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controles-de-donnees">Contrôles de données</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee">Configuration avancée</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature">Contrôle de données dans les destinations venant avec GeoNature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modele-de-donnees">Modèle de données</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="module-import">
<h1>Module Import<a class="headerlink" href="#module-import" title="Lien vers cette rubrique">#</a></h1>
<p>Ce module permet d’importer des données depuis un fichier CSV dans GeoNature.</p>
<section id="concepts">
<h2>Concepts<a class="headerlink" href="#concepts" title="Lien vers cette rubrique">#</a></h2>
<p><strong>Destination.</strong> Une destination est déterminée par le module dans lequel on souhaite importer des données (e.g. Occhab, Synthèse, etc.).</p>
<p><strong>Entités.</strong> Une entité correspond à un objet dans une destination (e.g. <em>station</em> est une entité de la destination <em>Occhab</em>)</p>
</section>
<section id="faire-un-import-le-minimum-requis">
<h2>Faire un import, le minimum requis<a class="headerlink" href="#faire-un-import-le-minimum-requis" title="Lien vers cette rubrique">#</a></h2>
<p>Pour qu’un utilisateur puisse mener au bout un import, il doit posséder à minima les permissions suivantes :</p>
<ul class="simple">
<li><p>Création d’un import (C)</p></li>
<li><p>Voir les imports (R)</p></li>
<li><p>Voir des mappings (R)</p></li>
<li><p>Droit de créer/saisir dans le module de destination (C dans OccHab par ex.)</p></li>
<li><p>Voir les méta-données (R)</p></li>
</ul>
<p><strong>Jeu de données.</strong> Un import s’effectue dans un jeu de données, par conséquent, ce dernier doit :</p>
<ul class="simple">
<li><p>être associé aux modules de destination de l’import (Voir champ dans l’édition/création d’un JDD : Module(s) GeoNature associé(s) au jeu de données)</p></li>
<li><p>être actif.</p></li>
</ul>
</section>
<section id="deroulement-dun-import">
<h2>Déroulement d’un import<a class="headerlink" href="#deroulement-dun-import" title="Lien vers cette rubrique">#</a></h2>
<p>Dans le module d’import, trois actions sont possibles : la création d’un import, la modification de ce dernier et la suppression d’un import.
Lors du lancement de la création d’un import, il faut sélectionner la destination. Une fois la destination choisie, la phase de préparation de l’import se déroule de la manière suivante :</p>
<ol class="arabic simple">
<li><p>Téléverser le fichier contenant les données et sélection du jeu de données. Le format de fichier accepté est le CSV.</p></li>
<li><p>Définir les paramètres de lecture du fichier téléversé. Les données du fichier source sont stockées en binaire dans la table des imports (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.source_file</span></code>).</p></li>
<li><p>Faire correspondre les colonnes de votre fichier avec les champs du modèle de données défini dans le module de destination. Pour aider l’utilisateur dans le remplissage du formulaire, il est possible de sauvegarder et réutiliser des  _mappings_. Plusieurs mappings sont disponibles avec l’installation de GeoNature. Ces mappings permettent notamment de faire la correspondance des  colonnes d’un fichier produit par un export GeoNature (Occhab et Synthèse). Les correspondances de champs sont stockées dans un champs JSON dans <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.fieldmapping</span></code>.</p></li>
<li><p>Si des champs correspondant à des types de nomenclatures sont indiqués dans l’étape 3, une mise en correspondance des valeurs du fichier source avec les nomenclatures dans la base doit être faite. Si le fichier source comprend des lignes vides, on propose en plus de mapper le cas « Pas de valeur ». Tout comme la correspondance des champs, la correspondance des valeurs de nomenclature est sauvegardée dans un champs JSONB <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports.valuemapping</span></code>.</p></li>
<li><p>Contrôles des données du fichier source sélectionnées (<a class="reference internal" href="#controle-donnees"><span class="std std-ref">c.f. Contrôles de données</span></a>:).</p></li>
</ol>
<p>Une fois, cette phase de préparation terminée, l’utilisateur se voit présenter les données jugées comme valides (resp. les données invalides). A cette étape, l’utilisateur a la choix de modifier les données invalides dans son fichier source et recommencer le processus de préparation de l’import OU lancer l’import des données dans la destination.
Une fois l’import de données terminé, l’utilisateur est redirigé vers un rapport récapitulant les paramètres de l’import et un affichage de quelques statistiques spécifiques au type de données importées.
Une fois les données importées, les données sont supprimées de la table temporaire (<code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_synthese</span></code> pour la Synthèse, <code class="docutils literal notranslate"><span class="pre">gn_imports.t_imports_occhab</span></code> pour Occhab).</p>
<img alt="admin/images/import/import_etapes.png" src="admin/images/import/import_etapes.png" />
</section>
<section id="configuration-du-module-dimport">
<h2>Configuration du module d’import<a class="headerlink" href="#configuration-du-module-dimport" title="Lien vers cette rubrique">#</a></h2>
<p>Vous pouvez surcoucher ces différents paramètres en les ajoutant directement dans le fichier de configuration principal de GeoNature (<code class="docutils literal notranslate"><span class="pre">geonature_config.toml</span></code>).</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Variable</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ENCODAGE</p></td>
<td><p>Liste des encodages</p></td>
</tr>
<tr class="row-odd"><td><p>acceptés</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p>INSTANCE_BOUNDING_BOX</p></td>
<td><p>Zone rectangulaire dans laquelle les données doivent être localisées</p></td>
</tr>
<tr class="row-odd"><td><p>ENABLE_BOUNDING_BOX_CHECK</p></td>
<td><p>Activer la vérification de l’appartenance des données importées à la bounding box définie dans INSTANCE_BOUNDING_BOX</p></td>
</tr>
<tr class="row-even"><td><p>ENABLE_SYNTHESE_UUID_CHECK</p></td>
<td><p>Activer la vérification des UUID dans les données importées avec ceux de la Synthèse</p></td>
</tr>
<tr class="row-odd"><td><p>MAX_FILE_SIZE</p></td>
<td><p>Taille maximale du fichier chargé (en Mo)</p></td>
</tr>
<tr class="row-even"><td><p>SRID</p></td>
<td><p>SRID autorisés pour les fichiers en entrée</p></td>
</tr>
<tr class="row-odd"><td><p>ALLOWED_EXTENSIONS</p></td>
<td><p>Extensions autorisées (seul le format CSV est accepté actuellement)</p></td>
</tr>
<tr class="row-even"><td><p>ALLOW_VALUE_MAPPING</p></td>
<td><p>Activer ou non l’étape du mapping des valeurs</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_VALUE_MAPPING_ID</p></td>
<td><p>Si le mapping des valeurs est désactivé, specifier l’identifiant du mapping qui doit être utilisé</p></td>
</tr>
<tr class="row-even"><td><p>FILL_MISSING_NOMENCLATURE_WITH_DEFAULT_VALUE</p></td>
<td><p>Rempli les valeurs de nomenclature erronées par la valeur par défaut</p></td>
</tr>
<tr class="row-odd"><td><p>DISPLAY_CHECK_BOX_MAPPED_FIELD</p></td>
<td><p>Afficher le bouton pour afficher/masquer les champs déjà mappés</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_PRIVATE_JDD_BLURING</p></td>
<td><p>Active la vérification de l’existence du champs « floutage » si le JDD est privé</p></td>
</tr>
<tr class="row-odd"><td><p>CHECK_REF_BIBLIO_LITTERATURE</p></td>
<td><p>Active la vérification de la référence bibliographique fournie si la valeur du champs source = « litterature »</p></td>
</tr>
<tr class="row-even"><td><p>CHECK_EXIST_PROOF</p></td>
<td><p>Active la vérification qu’une preuve d’existence est fournie si preuve existence = « oui »</p></td>
</tr>
<tr class="row-odd"><td><p>EXPORT_REPORT_PDF_FILENAME</p></td>
<td><p>Customiser le nom du fichier de rapport de l’import</p></td>
</tr>
<tr class="row-even"><td><p>DEFAULT_RANK</p></td>
<td><p>Paramètre pour définir le rang utilisé pour le diagramme camembert du rapport d’import.</p></td>
</tr>
<tr class="row-odd"><td><p>DEFAULT_GENERATE_MISSING_UUID</p></td>
<td><p>L’UUID d’une entité importée sera généré s’il n’est pas indiqué dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>ID_AREA_RESTRICTION</p></td>
<td><p>Identifiant d’une géométrie présente dans RefGeo. Si différent de -1, vérifie si les géométries des entités importées sont bien dans l’emprise spatiale de cette dernière.</p></td>
</tr>
<tr class="row-odd"><td><p>ID_LIST_TAXA_RESTRICTION</p></td>
<td><p>Identifiant d’une liste de taxons permettant de restreindre l’import d’observations dont les taxons appartiennent à cette dernière</p></td>
</tr>
<tr class="row-even"><td><p>MODULE_URL</p></td>
<td><p>URL d’accès au module d’import</p></td>
</tr>
<tr class="row-odd"><td><p>DATAFRAME_BATCH_SIZE</p></td>
<td><p>Taille des <cite>batch</cite> de données importées en même temps</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
</section>
<section id="permissions-de-limport">
<h2>Permissions de l’import<a class="headerlink" href="#permissions-de-limport" title="Lien vers cette rubrique">#</a></h2>
<p>Dans le module Import, il existe le jeu de permissions suivant :</p>
<ul class="simple">
<li><p>Création d’un import – C</p></li>
<li><p>Voir les imports – R</p></li>
<li><p>Modifier des imports – U (nécessaire d’avoir le C)</p></li>
<li><p>Supprimer des imports – D</p></li>
<li><p>Créer des mappings - C</p></li>
<li><p>Voir des mappings - R</p></li>
<li><p>Modifier des mappings - U</p></li>
<li><p>Supprimer des mappings - D</p></li>
</ul>
<p><strong>Scope.</strong> Similaire à d’autres permissions dans GeoNature, il est possible de limiter l’accès à l’utilisateur sur les données sur lesquelles il peut agir. L’ ajout de scope sur une permission de l’import limite  la visibilité des imports dans l’interface « Liste des Imports » ainsi que la possibilité (resp. impossbilité) de modifier ou supprimer un import. Par exemple,  un R2 sur « IMPORT » permet uniquement de voir les imports effectués par soi-même ou un utilisateur de son organisme.
A noter! La liste des jeux de données disponibles s’appuie bien sur les permissions de l’utilisateur dans ce dernier !</p>
<p><strong>Mapping.</strong> Certains mappings sont définis comme « public » et sont accessibles à tout le monde. Seuls les administrateurs (U=3) et les propriétaires de ces mappings peuvent les modifier. Si vous modifiez un mapping sur lequel vous n’avez pas les droits, il vous sera proposé de créer un nouveau mapping vous appartenant avec les modifications que vous avez faites, mais sans modifier le mapping initial.</p>
<p><strong>Jeu de données accessibles à l’import.</strong> Les jeux de données selectionnables par un utilisateur lors de la création d’un import sont eux controlés par les permissions sur le C de l’objet « import » (combiné au R du module « Métadonnées). Les mappings constituent un « objet » du module d’import disposant de droits paramétrables pour les différents utilisateurs, indépendamment des permissions sur les imports. Le réglage des permissions se fait dans le module « Admin » de GeoNature (« Admin » -&gt; « Permissions »).</p>
</section>
<section id="modification-et-suppression-d-un-import">
<h2>Modification et Suppression d’un import<a class="headerlink" href="#modification-et-suppression-d-un-import" title="Lien vers cette rubrique">#</a></h2>
<p><strong>Comment sait-on qu’un import est terminé ?</strong> Si une date apparait dans la colonne « Fin import » de la liste des imports, alors l’import est terminé.</p>
<p><strong>Suppression d’un import</strong> La suppression d’un import implique : la supression de l’import (l’objet) et <strong>les données importées dans la table transitoire</strong>. Si l’import est terminé, les données importées dans la destination sont supprimées. Dans le cas d’une destination avec plusieurs entités, si l’entité mère est associée à des entités filles ajoutées en dehors de l’import (un habitat est rajouté sur un station importée par exemple), la supression est bloquée.</p>
<p><strong>Modification d’un import</strong> Lors de la modification d’un import, vous serez redirigez vers l’étape de « Correspondances de champs ». Si vous modifiez la correspondance des champs en cliquant sur « Suivant », cela entrainera la suppression des données dans la table transitoire et dans la destination si l’import est terminé.</p>
</section>
<section id="controles-de-donnees">
<h2>Contrôles de données<a class="headerlink" href="#controles-de-donnees" title="Lien vers cette rubrique">#</a></h2>
<p><strong>Erreurs</strong></p>
<p>Le tableau ci-dessous liste les codes d’erreur et leur description.</p>
<blockquote>
<div><div class="pst-scrollable-table-container"><table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Code Erreur</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>DATASET_NOT_FOUND</p></td>
<td><p>L’identifiant ne correspond à aucun jeu de données existant.</p></td>
</tr>
<tr class="row-odd"><td><p>DATASET_NOT_AUTHORIZED</p></td>
<td><p>L’utilisateur ne peut pas importer de nouvelles entités dans le jeu de données.</p></td>
</tr>
<tr class="row-even"><td><p>DATASET_NOT_ACTIVE</p></td>
<td><p>Aucune donnée ne peut être importée dans le JDD indiqué car il n’est pas actif.</p></td>
</tr>
<tr class="row-odd"><td><p>MULTIPLE_ATTACHMENT_TYPE_CODE</p></td>
<td><p>Plusieurs géoréférencements sont indiqués dans les colonnes : codeCommune, codeMaille, codeDépartement (Erreur Synthèse)</p></td>
</tr>
<tr class="row-even"><td><p>MULTIPLE_CODE_ATTACHMENT</p></td>
<td><p>Plusieurs codes de rattachement fournis pour une même ligne. Une ligne doit avoir un seul code rattachement (code commune OU code maille OU code département)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_DATE</p></td>
<td><p>Format de date invalide (Voir formats de date autorisés)</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_UUID</p></td>
<td><p>Format de l’identifiant donné ne respecte pas le format UUID (<a class="reference external" href="https://fr.wikipedia.org/wiki/Universally_unique_identifier">https://fr.wikipedia.org/wiki/Universally_unique_identifier</a>)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_INTEGER</p></td>
<td><p>La donnée indiquée ne correspond pas un nombre entier.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_NUMERIC</p></td>
<td><p>La donnée indiquée ne correspond pas à un nombre réel (float)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_WKT</p></td>
<td><p>La donnée indiquée ne respecte pas le format WKT <a class="reference external" href="https://fr.wikipedia.org/wiki/Well-known_text">https://fr.wikipedia.org/wiki/Well-known_text</a></p></td>
</tr>
<tr class="row-even"><td><p>INVALID_GEOMETRY</p></td>
<td><p>La géométrie de la donnée renseignée est invalide (c.f  ST_VALID)</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_BOOL</p></td>
<td><p>La donnée fournie n’est pas un booléen</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_ATTACHMENT_CODE</p></td>
<td><p>Le code commune/maille/département indiqué ne fait pas partie du référentiel des géographique.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_CHAR_LENGTH</p></td>
<td><p>La chaine de caractère de la donnée est trop longue</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_TOO_HIGH</p></td>
<td><p>La date de début est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MAX_TOO_LOW</p></td>
<td><p>La date de fin est inférieure à 1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MAX_TOO_HIGH</p></td>
<td><p>La date de fin est dans le futur</p></td>
</tr>
<tr class="row-odd"><td><p>DATE_MIN_TOO_LOW</p></td>
<td><p>La date de début est inférieure à 1900</p></td>
</tr>
<tr class="row-even"><td><p>DATE_MIN_SUP_DATE_MAX</p></td>
<td><p>La date de début est supérieure à la date de fin</p></td>
</tr>
<tr class="row-odd"><td><p>DEPTH_MIN_SUP_ALTI_MAX</p></td>
<td><p>La profondeur minimum est supérieure à la profondeur maximale</p></td>
</tr>
<tr class="row-even"><td><p>ALTI_MIN_SUP_ALTI_MAX</p></td>
<td><p>L’altitude minimum est supérieure à l’altitude maximale</p></td>
</tr>
<tr class="row-odd"><td><p>ORPHAN_ROW</p></td>
<td><p>La ligne du fichier n’a pû être rattachée à aucune entité.</p></td>
</tr>
<tr class="row-even"><td><p>DUPLICATE_ROWS</p></td>
<td><p>Deux lignes du fichier sont identiques ; les lignes ne peuvent pas être dupliquées.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_UUID</p></td>
<td><p>L’identifiant UUID d’une entité n’est pas unique dans le fichier fournis</p></td>
</tr>
<tr class="row-even"><td><p>EXISTING_UUID</p></td>
<td><p>L’identifiant UUID d’une entité fournie existe déjà dans la base de données. Il faut en fournir un autre ou laisser la valeur vide pour une attribution automatique.</p></td>
</tr>
<tr class="row-odd"><td><p>SKIP_EXISTING_UUID</p></td>
<td><p>Les entités existantes selon UUID sont ignorées.</p></td>
</tr>
<tr class="row-even"><td><p>MISSING_VALUE</p></td>
<td><p>Valeur manquante dans un champs obligatoire</p></td>
</tr>
<tr class="row-odd"><td><p>MISSING_GEOM</p></td>
<td><p>Géoréférencement manquant ; un géoréférencement doit être fourni, c’est à dire qu’il faut livrer : soit une géométrie, soit une ou plusieurs commune(s), ou département(s), ou maille(s), dont le champ “typeInfoGeo” est indiqué à 1.</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUTSIDE</p></td>
<td><p>La géométrie se trouve à l’extérieur du territoire renseigné</p></td>
</tr>
<tr class="row-odd"><td><p>NO-GEOM</p></td>
<td><p>Aucune géometrie fournie (ni X/Y, WKT ou code)</p></td>
</tr>
<tr class="row-even"><td><p>GEOMETRY_OUT_OF_BOX</p></td>
<td><p>Coordonnées géographiques en dehors du périmètre géographique de l’instance</p></td>
</tr>
<tr class="row-odd"><td><p>ERRONEOUS_PARENT_ENTITY</p></td>
<td><p>L’entité parente est en erreur.</p></td>
</tr>
<tr class="row-even"><td><p>NO_PARENT_ENTITY</p></td>
<td><p>Aucune entité parente identifiée.</p></td>
</tr>
<tr class="row-odd"><td><p>DUPLICATE_ENTITY_SOURCE_PK</p></td>
<td><p>Deux lignes du fichier ont la même clé primaire d’origine ; les clés primaires du fichier source ne peuvent pas être dupliquées.</p></td>
</tr>
<tr class="row-even"><td><p>COUNT_MIN_SUP_COUNT_MAX</p></td>
<td><p>Incohérence entre les champs dénombrement. La valeur de denombrement_min est supérieure à celle de denombrement_max ou la valeur de denombrement_max est inférieure à denombrement_min.</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE</p></td>
<td><p>Code nomenclature erroné ; La valeur du champ n’est pas dans la liste des codes attendus pour ce champ. Pour connaître la liste des codes autorisés, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_EXISTING_PROOF_VALUE</p></td>
<td><p>Incohérence entre les champs de preuve ; si le champ “preuveExistante” vaut oui, alors l’un des deux champs “preuveNumérique” ou “preuveNonNumérique” doit être rempli. A l’inverse, si l’un de ces deux champs est rempli, alors “preuveExistante” ne doit pas prendre une autre valeur que « oui » (code 1).</p></td>
</tr>
<tr class="row-odd"><td><p>INVALID_NOMENCLATURE_WARNING</p></td>
<td><p>(Non bloquant) Code nomenclature erroné et remplacé par sa valeur par défaut ; La valeur du champ n’est pas dans la liste des codes attendus pour ce champ. Pour connaître la liste des codes autorisés, reportez-vous au Standard en cours.</p></td>
</tr>
<tr class="row-even"><td><p>CONDITIONAL_MANDATORY_FIELD_ERROR</p></td>
<td><p>Champs obligatoires conditionnels manquants. Il existe des ensembles de champs liés à un concept qui sont “obligatoires conditionnels”, c’est à dire que si l’un des champs du concept est utilisé, alors d’autres champs du concept deviennent obligatoires.</p></td>
</tr>
<tr class="row-odd"><td><p>UNKNOWN_ERROR</p></td>
<td><p>Erreur inconnue</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_STATUT_SOURCE_VALUE</p></td>
<td><p>Référence bibliographique manquante ; si le champ “statutSource” a la valeur “Li” (Littérature), alors une référence bibliographique doit être indiquée.</p></td>
</tr>
<tr class="row-odd"><td><p>CONDITIONAL_INVALID_DATA</p></td>
<td><p>Erreur de valeur</p></td>
</tr>
<tr class="row-even"><td><p>INVALID_URL_PROOF</p></td>
<td><p>PreuveNumerique n’est pas une url ; le champ “preuveNumérique” indique l’adresse web à laquelle on pourra trouver la preuve numérique ou l’archive contenant toutes les preuves numériques. Il doit commencer par “<a class="reference external" href="http://">http://</a>”, “<a class="reference external" href="https://">https://</a>”, ou “<a class="reference external" href="ftp://">ftp://</a>”.</p></td>
</tr>
<tr class="row-odd"><td><p>ROW_HAVE_TOO_MUCH_COLUMN</p></td>
<td><p>Une ligne du fichier source a plus de colonnes que l’en-tête.</p></td>
</tr>
<tr class="row-even"><td><p>ROW_HAVE_LESS_COLUMN</p></td>
<td><p>Une ligne du fichier source a moins de colonnes que l’en-tête.</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_ROW</p></td>
<td><p>Une ligne dans le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>HEADER_SAME_COLUMN_NAME</p></td>
<td><p>Au moins deux colonnes du fichier source possèdent des noms identiques</p></td>
</tr>
<tr class="row-odd"><td><p>EMPTY_FILE</p></td>
<td><p>Le fichier source est vide</p></td>
</tr>
<tr class="row-even"><td><p>NO_FILE_SENDED</p></td>
<td><p>Aucun fichier source n’a été téléversé.</p></td>
</tr>
<tr class="row-odd"><td><p>ERROR_WHILE_LOADING_FILE</p></td>
<td><p>Une erreur s’est produite lors du chargement du fichier.</p></td>
</tr>
<tr class="row-even"><td><p>FILE_FORMAT_ERROR</p></td>
<td><p>Le format du fichier est incorrect.</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_EXTENSION_ERROR</p></td>
<td><p>L’extension de fichier source est incorrect</p></td>
</tr>
<tr class="row-even"><td><p>FILE_OVERSIZE</p></td>
<td><p>Volume du fichier source est trop important</p></td>
</tr>
<tr class="row-odd"><td><p>FILE_NAME_TOO_LONG</p></td>
<td><p>Nom du fichier de données trop long</p></td>
</tr>
<tr class="row-even"><td><p>FILE_WITH_NO_DATA</p></td>
<td><p>Pas de données dans le fichier source</p></td>
</tr>
<tr class="row-odd"><td><p>INCOHERENT_DATA</p></td>
<td><p>Une même entité est déclaré avec différents attributs dans le fichier source</p></td>
</tr>
<tr class="row-even"><td><p>CD_HAB_NOT_FOUND</p></td>
<td><p>CdHab n’existe pas dans le référentiel Habref installé</p></td>
</tr>
<tr class="row-odd"><td><p>CD_NOM_NOT_FOUND</p></td>
<td><p>CdNom n’existe pas dans le référentiel TaxRef installé</p></td>
</tr>
</tbody>
</table>
</div>
</div></blockquote>
<p><strong>Format de dates autorisées</strong></p>
<p>Date :</p>
<ul class="simple">
<li><p>YYYY-MM-DD</p></li>
<li><p>DD-MM-YYYY</p></li>
<li><p>YYYY/MM/DD</p></li>
<li><p>DD/MM/YYYY</p></li>
</ul>
<p>Heure :</p>
<ul class="simple">
<li><p>H</p></li>
<li><p>H-M</p></li>
<li><p>H-M-S</p></li>
<li><p>H-M-S</p></li>
<li><p>H:M</p></li>
<li><p>H:M:S</p></li>
<li><p>H:M:S</p></li>
<li><p>Hh</p></li>
<li><p>HhM</p></li>
<li><p>HhMm</p></li>
<li><p>HhMmSs</p></li>
</ul>
</section>
<section id="configuration-avancee">
<h2>Configuration avancée<a class="headerlink" href="#configuration-avancee" title="Lien vers cette rubrique">#</a></h2>
<p>Une autre partie de la configuration se fait directement dans la base de données, dans les tables <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code> et <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code>.</p>
<p>Dans <code class="docutils literal notranslate"><span class="pre">bib_fields</span></code>, il est possible de :</p>
<ul class="simple">
<li><p>Ajouter de nouveau(x) champ(s) pour une entité (e.g. Station) dans une destination (e.g. Occhab).</p></li>
<li><p>Masquer des champs existants. Pour cela, modifier la valeur de l’attribut <code class="docutils literal notranslate"><span class="pre">display</span></code> d’un champ.</p></li>
<li><p>Rendre obligatoire un champ. Pour cela, modifier la valeur de l’attribut <code class="docutils literal notranslate"><span class="pre">mandatory</span></code> d’un champ.</p></li>
<li><p>Rendre obligatoire/optionnel un champ si d’autres champs sont remplis. Voir les champs <code class="docutils literal notranslate"><span class="pre">optional_conditions</span></code> et <code class="docutils literal notranslate"><span class="pre">mandatory_conditions</span></code>.</p></li>
</ul>
<p>Dans la table <code class="docutils literal notranslate"><span class="pre">cor_entity_field</span></code> :</p>
<ul class="simple">
<li><p>Paramètrer l’ordre des champs dans l’interface du mapping de champs. Voir le champ <code class="docutils literal notranslate"><span class="pre">order_field</span></code>.</p></li>
<li><p>Changer le _tooltip_ d’un champ. Voir le champ <code class="docutils literal notranslate"><span class="pre">comment</span></code>.</p></li>
<li><p>Regrouper des champs dans <strong>thèmes</strong> (voir <code class="docutils literal notranslate"><span class="pre">bib_themes</span></code>) à l’aide du champs <code class="docutils literal notranslate"><span class="pre">id_theme</span></code>.</p></li>
</ul>
</section>
<section id="controle-de-donnees-dans-les-destinations-venant-avec-geonature">
<span id="controle-donnees"></span><h2>Contrôle de données dans les destinations venant avec GeoNature<a class="headerlink" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature" title="Lien vers cette rubrique">#</a></h2>
<p>Dans cette section, nous présentons les contrôles de données effectuées pour les destinations intégrées dans GeoNature : Synthèse, Occhab.
L’ordre des contrôles dans ces listes correspond bien à celui du processus défini dans le code de GeoNature.
De manière générale, nous séparons les contrôles de données en deux catégories, ceux effectués en BDD avec PostgreSQL et ceux effectuée en Python à l’aide des DataFrame (donnée tableau)</p>
<p><strong>Listes des contrôles pour Occhab</strong></p>
<ol class="arabic simple">
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>Vérification de la cohérence des données des stations déclarées</p></li>
</ol>
</li>
<li><p>[DataFrame][Station]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la données</p></li>
<li><p>Vérification du jeu de données</p></li>
<li><p>Vérification des géométries présentes dans les données (WKT ou latitude/longitude)</p></li>
</ol>
</li>
<li><p>[DataFrame][Habitat]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la données</p></li>
</ol>
</li>
<li><p>[SQL][Station]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>Conversion des données de géométrie dans le SRID de la BDD</p></li>
<li><p>Vérification de la cohérence des données altitudinale, de profondeur et les dates</p></li>
<li><p>Vérification de la validité des géométries</p></li>
</ol>
</li>
<li><p>[SQL][Habitat]</p>
<ol class="arabic simple">
<li><p>Mapping des valeurs de nomenclatures</p></li>
<li><p>Vérification des cdHab</p></li>
<li><p>Vérification des UUID (doublons dans le fichier, existence dans la destination)</p></li>
<li><p>Générer les UUID si manquante</p></li>
<li><p>Dans le cas d’habitats importés sur une station existante, vérifier les droits de l’utilisateur sur cette dernière.</p></li>
</ol>
</li>
</ol>
<p><strong>Listes des contrôles pour la Synthèse</strong></p>
<ol class="arabic simple">
<li><p>[DataFrame]</p>
<ol class="arabic simple">
<li><p>Vérification de l’existence de données pour les champs obligatoires</p></li>
<li><p>Vérification de la concordance entre le type d’un champ et la donnée</p></li>
</ol>
</li>
<li><p>[SQL]</p>
<ol class="arabic simple">
<li><p>Vérification du jeu de données</p></li>
<li><p>Vérification des géométries présentes dans les données (WKT ou latitude/longitude)</p></li>
<li><p>Vérification des données de dénombrement</p></li>
<li><p>Mapping des nomenclatures</p></li>
<li><p>Vérification de l’existence des identifiants cdNom dans Taxref local</p></li>
<li><p>Vérification de l’existence des identifiants cdHab dans Habref local</p></li>
<li><p>Vérification de la cohérence des données altitudinale, de profondeur et les dates</p></li>
<li><p>Vérification des preuves numériques</p></li>
<li><p>Vérification de l’intersection entre chaque géométrie et la géométrie de la zone autorisée.</p></li>
</ol>
</li>
</ol>
</section>
<section id="modele-de-donnees">
<h2>Modèle de données<a class="headerlink" href="#modele-de-donnees" title="Lien vers cette rubrique">#</a></h2>
<p>Le diagramme ci-dessous présente le schéma de la base de données du module Import.</p>
<img alt="admin/images/import/import_modele.png" src="admin/images/import/import_modele.png" />
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contenu
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#concepts">Concepts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#faire-un-import-le-minimum-requis">Faire un import, le minimum requis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#deroulement-dun-import">Déroulement d’un import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-du-module-dimport">Configuration du module d’import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#permissions-de-limport">Permissions de l’import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modification-et-suppression-d-un-import">Modification et Suppression d’un import</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controles-de-donnees">Contrôles de données</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#configuration-avancee">Configuration avancée</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#controle-de-donnees-dans-les-destinations-venant-avec-geonature">Contrôle de données dans les destinations venant avec GeoNature</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modele-de-donnees">Modèle de données</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
Par PnE, PnC
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2018-2024, Parc National des Écrins, Parc National des Cévennes.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=26a4bc78f4c0ddb94549"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=26a4bc78f4c0ddb94549"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>